const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-GpLGME15.js","assets/react-vendor-RxPattl9.js","assets/index-SnXRF_kC.js"])))=>i.map(i=>d[i]);
var t,e=Object.defineProperty,s=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{a as i,S as r,J as n,_ as a}from"./index-BYAPVeao.js";import{r as o,ad as l,x as h,C as c,X as u,U as d,c as p,D as g,b as f,S as m,a as x}from"./ui-vendor-Ct0kQXbb.js";import{a as y}from"./pdf-CVlQhOZd.js";import b from"./pdf.worker.min-CElaEpGn.js";import{r as w,R as k,p as S,_ as v}from"./stackblur-es-CLEoY5ef.js";import{D as P}from"./DxfParser-CWA0JAgF.js";import"./react-vendor-RxPattl9.js";import"./___vite-browser-external_commonjs-proxy-C1hm88sc.js";import"./__vite-browser-external-CfyHAoLP.js";function _(t){return t.replace(/(?!\u3000)\s+/gm," ")}function C(t){const e=t.match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm);return e?e.map(parseFloat):[]}const A=/^[A-Z-]+$/;function I(t){const e=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(t);return e&&(e[2]||e[3]||e[4])||""}const T=/(\[[^\]]+\])/g,D=/(#[^\s+>~.[:]+)/g,R=/(\.[^\s+>~.[:]+)/g,N=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,M=/(:[\w-]+\([^)]*\))/gi,L=/(:[^\s+>~.[:]+)/g,E=/([^\s+>~.[:]+)/g;function j(t,e){const s=e.exec(t);return s?[t.replace(e," "),s.length]:[t,0]}const z=1e-8;function V(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}function B(t,e){return(t[0]*e[0]+t[1]*e[1])/(V(t)*V(e))}function F(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(B(t,e))}function O(t){return t*t*t}function $(t){return 3*t*t*(1-t)}function U(t){return 3*t*(1-t)*(1-t)}function H(t){return(1-t)*(1-t)*(1-t)}function Z(t){return t*t}function G(t){return 2*t*(1-t)}function W(t){return(1-t)*(1-t)}class X{static empty(t){return new X(t,"EMPTY","")}split(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:" ";const{document:e,name:s}=this;return _(this.getString()).trim().split(t).map(t=>new X(e,s,t))}hasValue(t){const e=this.value;return null!==e&&""!==e&&(t||0!==e)&&void 0!==e}isString(t){const{value:e}=this,s="string"==typeof e;return s&&t?t.test(e):s}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;const t=this.getString();switch(!0){case t.endsWith("px"):case/^[0-9]+$/.test(t):return!0;default:return!1}}setValue(t){return this.value=t,this}getValue(t){return void 0===t||this.hasValue()?this.value:t}getNumber(t){if(!this.hasValue())return void 0===t?0:parseFloat(t);const{value:e}=this;let s=parseFloat(e);return this.isString(/%$/)&&(s/=100),s}getString(t){return void 0===t||this.hasValue()?void 0===this.value?"":String(this.value):String(t)}getColor(t){let e=this.getString(t);return this.isNormalizedColor||(this.isNormalizedColor=!0,e=function(t){if(!t.startsWith("rgb"))return t;let e=3;return t.replace(/\d+(\.\d+)?/g,(t,s)=>e--&&s?String(Math.round(parseFloat(t))):t)}(e),this.value=e),e}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasValue())return 0;const[s,i]="boolean"==typeof t?[void 0,t]:[t],{viewPort:r}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(r.computeSize("x"),r.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(r.computeSize("x"),r.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*r.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*r.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return 15*this.getNumber();case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case this.isString(/%$/)&&i:return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*r.computeSize(s);default:{const t=this.getNumber();return e&&t<1?t*r.computeSize(s):t}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():1e3*this.getNumber():0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){const t=this.getString(),e=/#([^)'"]+)/.exec(t),s=(null==e?void 0:e[1])||t;return this.document.definitions.get(s)}getFillStyleDefinition(t,e){let s=this.getDefinition();if(!s)return null;if("function"==typeof s.createGradient&&"getBoundingBox"in t)return s.createGradient(this.document.ctx,t,e);if("function"==typeof s.createPattern){if(s.getHrefAttribute().hasValue()){const t=s.getAttribute("patternTransform");s=s.getHrefAttribute().getDefinition(),s&&t.hasValue()&&s.getAttribute("patternTransform",!0).setValue(t.value)}if(s)return s.createPattern(this.document.ctx,t,e)}return null}getTextBaseline(){if(!this.hasValue())return null;const t=this.getString();return X.textBaselineMapping[t]||null}addOpacity(t){let e=this.getColor();const s=e.length;let i=0;for(let r=0;r<s&&(","===e[r]&&i++,3!==i);r++);if(t.hasValue()&&this.isString()&&3!==i){const s=new k(e);s.ok&&(s.alpha=t.getNumber(),e=s.toRGBA())}return new X(this.document,this.name,e)}constructor(t,e,s){this.document=t,this.name=e,this.value=s,this.isNormalizedColor=!1}}X.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class q{clear(){this.viewPorts=[]}setCurrent(t,e){this.viewPorts.push({width:t,height:e})}removeCurrent(){this.viewPorts.pop()}getRoot(){const[t]=this.viewPorts;return t||Y()}getCurrent(){const{viewPorts:t}=this,e=t[t.length-1];return e||Y()}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(t){return"number"==typeof t?t:"x"===t?this.width:"y"===t?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}constructor(){this.viewPorts=[]}}function Y(){return{width:q.DEFAULT_VIEWPORT_WIDTH,height:q.DEFAULT_VIEWPORT_HEIGHT}}q.DEFAULT_VIEWPORT_WIDTH=800,q.DEFAULT_VIEWPORT_HEIGHT=600;class Q{static parse(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const[s=e,i=e]=C(t);return new Q(s,i)}static parseScale(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const[s=e,i=s]=C(t);return new Q(s,i)}static parsePath(t){const e=C(t),s=e.length,i=[];for(let r=0;r<s;r+=2)i.push(new Q(e[r],e[r+1]));return i}angleTo(t){return Math.atan2(t.y-this.y,t.x-this.x)}applyTransform(t){const{x:e,y:s}=this,i=e*t[0]+s*t[2]+t[4],r=e*t[1]+s*t[3]+t[5];this.x=i,this.y=r}constructor(t,e){this.x=t,this.y=e}}class K{isWorking(){return this.working}start(){if(this.working)return;const{screen:t,onClick:e,onMouseMove:s}=this,i=t.ctx.canvas;i.onclick=e,i.onmousemove=s,this.working=!0}stop(){if(!this.working)return;const t=this.screen.ctx.canvas;this.working=!1,t.onclick=null,t.onmousemove=null}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(!this.working)return;const{screen:t,events:e,eventElements:s}=this,{style:i}=t.ctx.canvas;let r;i&&(i.cursor=""),e.forEach((t,e)=>{let{run:i}=t;for(r=s[e];r;)i(r),r=r.parent}),this.events=[],this.eventElements=[]}checkPath(t,e){if(!this.working||!e)return;const{events:s,eventElements:i}=this;s.forEach((s,r)=>{let{x:n,y:a}=s;!i[r]&&e.isPointInPath&&e.isPointInPath(n,a)&&(i[r]=t)})}checkBoundingBox(t,e){if(!this.working||!e)return;const{events:s,eventElements:i}=this;s.forEach((s,r)=>{let{x:n,y:a}=s;!i[r]&&e.isPointInBox(n,a)&&(i[r]=t)})}mapXY(t,e){const{window:s,ctx:i}=this.screen,r=new Q(t,e);let n=i.canvas;for(;n;)r.x-=n.offsetLeft,r.y-=n.offsetTop,n=n.offsetParent;return(null==s?void 0:s.scrollX)&&(r.x+=s.scrollX),(null==s?void 0:s.scrollY)&&(r.y+=s.scrollY),r}onClick(t){const{x:e,y:s}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onclick",x:e,y:s,run(t){t.onClick&&t.onClick()}})}onMouseMove(t){const{x:e,y:s}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onmousemove",x:e,y:s,run(t){t.onMouseMove&&t.onMouseMove()}})}constructor(t){this.screen=t,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}}const J="undefined"!=typeof window?window:null,tt="undefined"!=typeof fetch?fetch.bind(void 0):void 0;class et{wait(t){this.waits.push(t)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;const t=this.waits.every(t=>t());return t&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=t,t}setDefaults(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4}setViewBox(t){let{document:e,ctx:s,aspectRatio:i,width:r,desiredWidth:n,height:a,desiredHeight:o,minX:l=0,minY:h=0,refX:c,refY:u,clip:d=!1,clipX:p=0,clipY:g=0}=t;const f=_(i).replace(/^defer\s/,""),[m,x]=f.split(" "),y=m||"xMidYMid",b=x||"meet",w=r/n,k=a/o,S=Math.min(w,k),v=Math.max(w,k);let P=n,C=o;"meet"===b&&(P*=S,C*=S),"slice"===b&&(P*=v,C*=v);const A=new X(e,"refX",c),I=new X(e,"refY",u),T=A.hasValue()&&I.hasValue();if(T&&s.translate(-S*A.getPixels("x"),-S*I.getPixels("y")),d){const t=S*p,e=S*g;s.beginPath(),s.moveTo(t,e),s.lineTo(r,e),s.lineTo(r,a),s.lineTo(t,a),s.closePath(),s.clip()}if(!T){const t="meet"===b&&S===k,e="slice"===b&&v===k,i="meet"===b&&S===w,n="slice"===b&&v===w;y.startsWith("xMid")&&(t||e)&&s.translate(r/2-P/2,0),y.endsWith("YMid")&&(i||n)&&s.translate(0,a/2-C/2),y.startsWith("xMax")&&(t||e)&&s.translate(r-P,0),y.endsWith("YMax")&&(i||n)&&s.translate(0,a-C)}switch(!0){case"none"===y:s.scale(w,k);break;case"meet"===b:s.scale(S,S);break;case"slice"===b:s.scale(v,v)}s.translate(-l,-h)}start(t){let{enableRedraw:e=!1,ignoreMouse:s=!1,ignoreAnimation:i=!1,ignoreDimensions:r=!1,ignoreClear:n=!1,forceRedraw:a,scaleWidth:o,scaleHeight:l,offsetX:h,offsetY:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{mouse:u}=this,d=1e3/et.FRAMERATE;if(this.isReadyLock=!1,this.frameDuration=d,this.readyPromise=new Promise(t=>{this.resolveReady=t}),this.isReady()&&this.render(t,r,n,o,l,h,c),!e)return;let p=Date.now(),g=p,f=0;const m=()=>{p=Date.now(),f=p-g,f>=d&&(g=p-f%d,this.shouldUpdate(i,a)&&(this.render(t,r,n,o,l,h,c),u.runEvents())),this.intervalId=w(m)};s||u.start(),this.intervalId=w(m)}stop(){this.intervalId&&(w.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(t,e){if(!t){const{frameDuration:t}=this;if(this.animations.reduce((e,s)=>s.update(t)||e,!1))return!0}return!("function"!=typeof e||!e())||(!(this.isReadyLock||!this.isReady())||!!this.mouse.hasEvents())}render(t,e,s,i,r,n,a){const{viewPort:o,ctx:l,isFirstRender:h}=this,c=l.canvas;o.clear(),c.width&&c.height&&o.setCurrent(c.width,c.height);const u=t.getStyle("width"),d=t.getStyle("height");!e&&(h||"number"!=typeof i&&"number"!=typeof r)&&(u.hasValue()&&(c.width=u.getPixels("x"),c.style&&(c.style.width="".concat(c.width,"px"))),d.hasValue()&&(c.height=d.getPixels("y"),c.style&&(c.style.height="".concat(c.height,"px"))));let p=c.clientWidth||c.width,g=c.clientHeight||c.height;if(e&&u.hasValue()&&d.hasValue()&&(p=u.getPixels("x"),g=d.getPixels("y")),o.setCurrent(p,g),"number"==typeof n&&t.getAttribute("x",!0).setValue(n),"number"==typeof a&&t.getAttribute("y",!0).setValue(a),"number"==typeof i||"number"==typeof r){const e=C(t.getAttribute("viewBox").getString());let s=0,n=0;if("number"==typeof i){const r=t.getStyle("width");r.hasValue()?s=r.getPixels("x")/i:e[2]&&!isNaN(e[2])&&(s=e[2]/i)}if("number"==typeof r){const s=t.getStyle("height");s.hasValue()?n=s.getPixels("y")/r:e[3]&&!isNaN(e[3])&&(n=e[3]/r)}s||(s=n),n||(n=s),t.getAttribute("width",!0).setValue(i),t.getAttribute("height",!0).setValue(r);const a=t.getStyle("transform",!0,!0);a.setValue("".concat(a.getString()," scale(").concat(1/s,", ").concat(1/n,")"))}s||l.clearRect(0,0,p,g),t.render(l),h&&(this.isFirstRender=!1)}constructor(t,{fetch:e=tt,window:s=J}={}){if(this.ctx=t,this.viewPort=new q,this.mouse=new K(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=s,!e)throw new Error("Can't find 'fetch' in 'globalThis', please provide it via options");this.fetch=e}}et.defaultWindow=J,et.defaultFetch=tt,et.FRAMERATE=30,et.MAX_VIRTUAL_PIXELS=3e4;const{defaultFetch:st}=et,it="undefined"!=typeof DOMParser?DOMParser:void 0;class rt{async parse(t){return t.startsWith("<")?this.parseFromString(t):this.load(t)}parseFromString(t){const e=new this.DOMParser;try{return this.checkDocument(e.parseFromString(t,"image/svg+xml"))}catch(s){return this.checkDocument(e.parseFromString(t,"text/xml"))}}checkDocument(t){const e=t.getElementsByTagName("parsererror")[0];if(e)throw new Error(e.textContent||"Unknown parse error");return t}async load(t){const e=await this.fetch(t),s=await e.text();return this.parseFromString(s)}constructor({fetch:t=st,DOMParser:e=it}={}){if(!t)throw new Error("Can't find 'fetch' in 'globalThis', please provide it via options");if(!e)throw new Error("Can't find 'DOMParser' in 'globalThis', please provide it via options");this.fetch=t,this.DOMParser=e}}class nt{apply(t){const{originX:e,originY:s,matrix:i}=this,r=e.getPixels("x"),n=s.getPixels("y");t.translate(r,n),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),t.translate(-r,-n)}unapply(t){const{originX:e,originY:s,matrix:i}=this,r=i[0],n=i[2],a=i[4],o=i[1],l=i[3],h=i[5],c=1/(r*(1*l-0*h)-n*(1*o-0*h)+a*(0*o-0*l)),u=e.getPixels("x"),d=s.getPixels("y");t.translate(u,d),t.transform(c*(1*l-0*h),c*(0*h-1*o),c*(0*a-1*n),c*(1*r-0*a),c*(n*h-a*l),c*(a*o-r*h)),t.translate(-u,-d)}applyToPoint(t){t.applyTransform(this.matrix)}constructor(t,e,s){this.type="matrix",this.matrix=function(t){const e=C(t);return[e[0]||0,e[1]||0,e[2]||0,e[3]||0,e[4]||0,e[5]||0]}(e),this.originX=s[0],this.originY=s[1]}}class at extends nt{constructor(t,e,s){super(t,e,s),this.type="skew",this.angle=new X(t,"angle",e)}}class ot{static fromElement(t,e){const s=e.getStyle("transform",!1,!0);if(s.hasValue()){const[i,r=i]=e.getStyle("transform-origin",!1,!0).split();if(i&&r){const e=[i,r];return new ot(t,s.getString(),e)}}return null}apply(t){this.transforms.forEach(e=>e.apply(t))}unapply(t){this.transforms.forEach(e=>e.unapply(t))}applyToPoint(t){this.transforms.forEach(e=>e.applyToPoint(t))}constructor(t,e,s){this.document=t,this.transforms=[];_(e).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/).forEach(t=>{if("none"===t)return;const[e,i]=function(t){const[e="",s=""]=t.split("(");return[e.trim(),s.trim().replace(")","")]}(t),r=ot.transformTypes[e];r&&this.transforms.push(new r(this.document,i,s))})}}ot.transformTypes={translate:class{apply(t){const{x:e,y:s}=this.point;t.translate(e||0,s||0)}unapply(t){const{x:e,y:s}=this.point;t.translate(-1*e||0,-1*s||0)}applyToPoint(t){const{x:e,y:s}=this.point;t.applyTransform([1,0,0,1,e||0,s||0])}constructor(t,e){this.type="translate",this.point=Q.parse(e)}},rotate:class{apply(t){const{cx:e,cy:s,originX:i,originY:r,angle:n}=this,a=e+i.getPixels("x"),o=s+r.getPixels("y");t.translate(a,o),t.rotate(n.getRadians()),t.translate(-a,-o)}unapply(t){const{cx:e,cy:s,originX:i,originY:r,angle:n}=this,a=e+i.getPixels("x"),o=s+r.getPixels("y");t.translate(a,o),t.rotate(-1*n.getRadians()),t.translate(-a,-o)}applyToPoint(t){const{cx:e,cy:s,angle:i}=this,r=i.getRadians();t.applyTransform([1,0,0,1,e||0,s||0]),t.applyTransform([Math.cos(r),Math.sin(r),-Math.sin(r),Math.cos(r),0,0]),t.applyTransform([1,0,0,1,-e||0,-s||0])}constructor(t,e,s){this.type="rotate";const i=C(e);this.angle=new X(t,"angle",i[0]),this.originX=s[0],this.originY=s[1],this.cx=i[1]||0,this.cy=i[2]||0}},scale:class{apply(t){const{scale:{x:e,y:s},originX:i,originY:r}=this,n=i.getPixels("x"),a=r.getPixels("y");t.translate(n,a),t.scale(e,s||e),t.translate(-n,-a)}unapply(t){const{scale:{x:e,y:s},originX:i,originY:r}=this,n=i.getPixels("x"),a=r.getPixels("y");t.translate(n,a),t.scale(1/e,1/s||e),t.translate(-n,-a)}applyToPoint(t){const{x:e,y:s}=this.scale;t.applyTransform([e||0,0,0,s||0,0,0])}constructor(t,e,s){this.type="scale";const i=Q.parseScale(e);0!==i.x&&0!==i.y||(i.x=z,i.y=z),this.scale=i,this.originX=s[0],this.originY=s[1]}},matrix:nt,skewX:class extends at{constructor(t,e,s){super(t,e,s),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}},skewY:class extends at{constructor(t,e,s){super(t,e,s),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}};class lt{getAttribute(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=this.attributes.get(t);if(!s&&e){const e=new X(this.document,t,"");return this.attributes.set(t,e),e}return s||X.empty(this.document)}getHrefAttribute(){let t;for(const[e,s]of this.attributes)if("href"===e||e.endsWith(":href")){t=s;break}return t||X.empty(this.document)}getStyle(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this.styles.get(t);if(i)return i;const r=this.getAttribute(t);if(r.hasValue())return this.styles.set(t,r),r;if(!s){const{parent:e}=this;if(e){const s=e.getStyle(t);if(s.hasValue())return s}}if(e){const e=new X(this.document,t,"");return this.styles.set(t,e),e}return X.empty(this.document)}render(t){if("none"!==this.getStyle("display").getString()&&"hidden"!==this.getStyle("visibility").getString()){if(t.save(),this.getStyle("mask").hasValue()){const e=this.getStyle("mask").getDefinition();e&&(this.applyEffects(t),e.apply(t,this))}else if("none"!==this.getStyle("filter").getValue("none")){const e=this.getStyle("filter").getDefinition();e&&(this.applyEffects(t),e.apply(t,this))}else this.setContext(t),this.renderChildren(t),this.clearContext(t);t.restore()}}setContext(t){}applyEffects(t){const e=ot.fromElement(this.document,this);e&&e.apply(t);const s=this.getStyle("clip-path",!1,!0);if(s.hasValue()){const e=s.getDefinition();e&&e.apply(t)}}clearContext(t){}renderChildren(t){this.children.forEach(e=>{e.render(t)})}addChild(t){const e=t instanceof lt?t:this.document.createElement(t);e.parent=this,lt.ignoreChildTypes.includes(e.type)||this.children.push(e)}matchesSelector(t){var e;const{node:s}=this;if("function"==typeof s.matches)return s.matches(t);const i=null===(e=s.getAttribute)||void 0===e?void 0:e.call(s,"class");return!(!i||""===i)&&i.split(" ").some(e=>".".concat(e)===t)}addStylesFromStyleDefinition(){const{styles:t,stylesSpecificity:e}=this.document;for(const[s,i]of t)if(!s.startsWith("@")&&this.matchesSelector(s)){const t=e.get(s);if(i)for(const[e,s]of i){let i=this.stylesSpecificity.get(e);void 0===i&&(i="000"),t&&t>=i&&(s&&this.styles.set(e,s),this.stylesSpecificity.set(e,t))}}}removeStyles(t,e){return e.reduce((e,s)=>{const i=t.getStyle(s);if(!i.hasValue())return e;const r=i.getString();return i.setValue(""),[...e,[s,r]]},[])}restoreStyles(t,e){e.forEach(e=>{let[s,i]=e;t.getStyle(s,!0).setValue(i)})}isFirstChild(){var t;return 0===(null===(t=this.parent)||void 0===t?void 0:t.children.indexOf(this))}constructor(t,e,s=!1){if(this.document=t,this.node=e,this.captureTextNodes=s,this.type="",this.attributes=new Map,this.styles=new Map,this.stylesSpecificity=new Map,this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!e||1!==e.nodeType)return;if(Array.from(e.attributes).forEach(e=>{const s=(i=e.nodeName,A.test(i)?i.toLowerCase():i);var i;this.attributes.set(s,new X(t,s,e.value))}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){this.getAttribute("style").getString().split(";").map(t=>t.trim()).forEach(e=>{if(!e)return;const[s,i]=e.split(":").map(t=>t.trim());s&&this.styles.set(s,new X(t,s,i))})}const{definitions:i}=t,r=this.getAttribute("id");r.hasValue()&&(i.has(r.getString())||i.set(r.getString(),this)),Array.from(e.childNodes).forEach(e=>{if(1===e.nodeType)this.addChild(e);else if(s&&(3===e.nodeType||4===e.nodeType)){const s=t.createTextNode(e);s.getText().length>0&&this.addChild(s)}})}}lt.ignoreChildTypes=["title"];class ht extends lt{constructor(t,e,s){super(t,e,s)}}function ct(t){const e=t.trim();return/^('|")/.test(e)?e:'"'.concat(e,'"')}function ut(t){if(!t)return"";const e=t.trim().toLowerCase();switch(e){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return e;default:return/^oblique\s+(-|)\d+deg$/.test(e)?e:""}}function dt(t){if(!t)return"";const e=t.trim().toLowerCase();switch(e){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return e;default:return/^[\d.]+$/.test(e)?e:""}}class pt{static parse(){let t=arguments.length>1?arguments[1]:void 0,e="",s="",i="",r="",n="";const a=_(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").trim().split(" "),o={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return a.forEach(t=>{switch(!0){case!o.fontStyle&&pt.styles.includes(t):"inherit"!==t&&(e=t),o.fontStyle=!0;break;case!o.fontVariant&&pt.variants.includes(t):"inherit"!==t&&(s=t),o.fontStyle=!0,o.fontVariant=!0;break;case!o.fontWeight&&pt.weights.includes(t):"inherit"!==t&&(i=t),o.fontStyle=!0,o.fontVariant=!0,o.fontWeight=!0;break;case!o.fontSize:"inherit"!==t&&(r=t.split("/")[0]||""),o.fontStyle=!0,o.fontVariant=!0,o.fontWeight=!0,o.fontSize=!0;break;default:"inherit"!==t&&(n+=t)}}),new pt(e,s,i,r,n,t)}toString(){return[ut(this.fontStyle),this.fontVariant,dt(this.fontWeight),this.fontSize,(t=this.fontFamily,"undefined"==typeof process?t:t.trim().split(",").map(ct).join(","))].join(" ").trim();var t}constructor(t,e,s,i,r,n){const a=n?"string"==typeof n?pt.parse(n):n:{};this.fontFamily=r||a.fontFamily,this.fontSize=i||a.fontSize,this.fontStyle=t||a.fontStyle,this.fontWeight=s||a.fontWeight,this.fontVariant=e||a.fontVariant}}pt.styles="normal|italic|oblique|inherit",pt.variants="normal|small-caps|inherit",pt.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class gt{get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(t,e){void 0!==t&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),void 0!==e&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))}addX(t){this.addPoint(t,0)}addY(t){this.addPoint(0,t)}addBoundingBox(t){if(!t)return;const{x1:e,y1:s,x2:i,y2:r}=t;this.addPoint(e,s),this.addPoint(i,r)}sumCubic(t,e,s,i,r){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*s+3*(1-t)*Math.pow(t,2)*i+Math.pow(t,3)*r}bezierCurveAdd(t,e,s,i,r){const n=6*e-12*s+6*i,a=-3*e+9*s-9*i+3*r,o=3*s-3*e;if(0===a){if(0===n)return;const a=-o/n;return void(0<a&&a<1&&(t?this.addX(this.sumCubic(a,e,s,i,r)):this.addY(this.sumCubic(a,e,s,i,r))))}const l=Math.pow(n,2)-4*o*a;if(l<0)return;const h=(-n+Math.sqrt(l))/(2*a);0<h&&h<1&&(t?this.addX(this.sumCubic(h,e,s,i,r)):this.addY(this.sumCubic(h,e,s,i,r)));const c=(-n-Math.sqrt(l))/(2*a);0<c&&c<1&&(t?this.addX(this.sumCubic(c,e,s,i,r)):this.addY(this.sumCubic(c,e,s,i,r)))}addBezierCurve(t,e,s,i,r,n,a,o){this.addPoint(t,e),this.addPoint(a,o),this.bezierCurveAdd(!0,t,s,r,a),this.bezierCurveAdd(!1,e,i,n,o)}addQuadraticCurve(t,e,s,i,r,n){const a=t+2/3*(s-t),o=e+2/3*(i-e),l=a+1/3*(r-t),h=o+1/3*(n-e);this.addBezierCurve(t,e,a,l,o,h,r,n)}isPointInBox(t,e){const{x1:s,y1:i,x2:r,y2:n}=this;return s<=t&&t<=r&&i<=e&&e<=n}constructor(t=Number.NaN,e=Number.NaN,s=Number.NaN,i=Number.NaN){this.x1=t,this.y1=e,this.x2=s,this.y2=i,this.addPoint(t,e),this.addPoint(s,i)}}class ft extends lt{calculateOpacity(){let t=1,e=this;for(;e;){const s=e.getStyle("opacity",!1,!0);s.hasValue(!0)&&(t*=s.getNumber()),e=e.parent}return t}setContext(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e){const e=this.getStyle("fill"),s=this.getStyle("fill-opacity"),i=this.getStyle("stroke"),r=this.getStyle("stroke-opacity");if(e.isUrlDefinition()){const i=e.getFillStyleDefinition(this,s);i&&(t.fillStyle=i)}else if(e.hasValue()){"currentColor"===e.getString()&&e.setValue(this.getStyle("color").getColor());const s=e.getColor();"inherit"!==s&&(t.fillStyle="none"===s?"rgba(0,0,0,0)":s)}if(s.hasValue()){const e=new X(this.document,"fill",t.fillStyle).addOpacity(s).getColor();t.fillStyle=e}if(i.isUrlDefinition()){const e=i.getFillStyleDefinition(this,r);e&&(t.strokeStyle=e)}else if(i.hasValue()){"currentColor"===i.getString()&&i.setValue(this.getStyle("color").getColor());const e=i.getString();"inherit"!==e&&(t.strokeStyle="none"===e?"rgba(0,0,0,0)":e)}if(r.hasValue()){const e=new X(this.document,"stroke",t.strokeStyle).addOpacity(r).getString();t.strokeStyle=e}const n=this.getStyle("stroke-width");if(n.hasValue()){const e=n.getPixels();t.lineWidth=e||z}const a=this.getStyle("stroke-linecap"),o=this.getStyle("stroke-linejoin"),l=this.getStyle("stroke-miterlimit"),h=this.getStyle("stroke-dasharray"),c=this.getStyle("stroke-dashoffset");if(a.hasValue()&&(t.lineCap=a.getString()),o.hasValue()&&(t.lineJoin=o.getString()),l.hasValue()&&(t.miterLimit=l.getNumber()),h.hasValue()&&"none"!==h.getString()){const e=C(h.getString());void 0!==t.setLineDash?t.setLineDash(e):void 0!==t.webkitLineDash?t.webkitLineDash=e:void 0===t.mozDash||1===e.length&&0===e[0]||(t.mozDash=e);const s=c.getPixels();void 0!==t.lineDashOffset?t.lineDashOffset=s:void 0!==t.webkitLineDashOffset?t.webkitLineDashOffset=s:void 0!==t.mozDashOffset&&(t.mozDashOffset=s)}}if(this.modifiedEmSizeStack=!1,void 0!==t.font){const e=this.getStyle("font"),s=this.getStyle("font-style"),i=this.getStyle("font-variant"),r=this.getStyle("font-weight"),n=this.getStyle("font-size"),a=this.getStyle("font-family"),o=new pt(s.getString(),i.getString(),r.getString(),n.hasValue()?"".concat(n.getPixels(!0),"px"):"",a.getString(),pt.parse(e.getString(),t.font));s.setValue(o.fontStyle),i.setValue(o.fontVariant),r.setValue(o.fontWeight),n.setValue(o.fontSize),a.setValue(o.fontFamily),t.font=o.toString(),n.isPixels()&&(this.document.emSize=n.getPixels(),this.modifiedEmSizeStack=!0)}e||(this.applyEffects(t),t.globalAlpha=this.calculateOpacity())}clearContext(t){super.clearContext(t),this.modifiedEmSizeStack&&this.document.popEmSize()}constructor(...t){super(...t),this.modifiedEmSizeStack=!1}}class mt extends ft{setContext(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super.setContext(t,e);const s=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();s&&(t.textBaseline=s)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(t){if("text"!==this.type)return this.getTElementBoundingBox(t);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t);let e=null;return this.children.forEach((s,i)=>{const r=this.getChildBoundingBox(t,this,this,i);e?e.addBoundingBox(r):e=r}),e}getFontSize(){const{document:t,parent:e}=this,s=pt.parse(t.ctx.font).fontSize;return e.getStyle("font-size").getNumber(s)}getTElementBoundingBox(t){const e=this.getFontSize();return new gt(this.x,this.y-e,this.x+this.measureText(t),this.y)}getGlyph(t,e,s){const i=e[s];let r;if(t.isArabic){var n;const a=e.length,o=e[s-1],l=e[s+1];let h="isolated";(0===s||" "===o)&&s<a-1&&" "!==l&&(h="terminal"),s>0&&" "!==o&&s<a-1&&" "!==l&&(h="medial"),s>0&&" "!==o&&(s===a-1||" "===l)&&(h="initial"),r=(null===(n=t.arabicGlyphs.get(i))||void 0===n?void 0:n.get(h))||t.glyphs.get(i)}else r=t.glyphs.get(i);return r||(r=t.missingGlyph),r}getText(){return""}getTextFromNode(t){const e=t||this.node,s=Array.from(e.parentNode.childNodes),i=s.indexOf(e),r=s.length-1;let n=_(e.textContent||"");return 0===i&&(n=n.replace(/^[\n \t]+/,"")),i===r&&(n=function(t){return t.replace(/[\n \t]+$/,"")}(n)),n}renderChildren(t){if("text"!==this.type)return void this.renderTElementChildren(t);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t),this.children.forEach((e,s)=>{this.renderChild(t,this,this,s)});const{mouse:e}=this.document.screen;e.isWorking()&&e.checkBoundingBox(this,this.getBoundingBox(t))}renderTElementChildren(t){const{document:e,parent:s}=this,i=this.getText(),r=s.getStyle("font-family").getDefinition();if(r){const{unitsPerEm:n}=r.fontFace,a=pt.parse(e.ctx.font),o=s.getStyle("font-size").getNumber(a.fontSize),l=s.getStyle("font-style").getString(a.fontStyle),h=o/n,c=r.isRTL?i.split("").reverse().join(""):i,u=C(s.getAttribute("dx").getString()),d=c.length;for(let e=0;e<d;e++){const s=this.getGlyph(r,c,e);t.translate(this.x,this.y),t.scale(h,-h);const i=t.lineWidth;t.lineWidth=t.lineWidth*n/o,"italic"===l&&t.transform(1,0,.4,1,0,0),s.render(t),"italic"===l&&t.transform(1,0,-.4,1,0,0),t.lineWidth=i,t.scale(1/h,-1/h),t.translate(-this.x,-this.y),this.x+=o*(s.horizAdvX||r.horizAdvX)/n,void 0===u[e]||isNaN(u[e])||(this.x+=u[e])}return}const{x:n,y:a}=this;t.fillStyle&&t.fillText(i,n,a),t.strokeStyle&&t.strokeText(i,n,a)}applyAnchoring(){if(this.textChunkStart>=this.leafTexts.length)return;const t=this.leafTexts[this.textChunkStart],e=t.getStyle("text-anchor").getString("start");let s=0;s="start"===e?t.x-this.minX:"end"===e?t.x-this.maxX:t.x-(this.minX+this.maxX)/2;for(let i=this.textChunkStart;i<this.leafTexts.length;i++)this.leafTexts[i].x+=s;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}adjustChildCoordinatesRecursive(t){this.children.forEach((e,s)=>{this.adjustChildCoordinatesRecursiveCore(t,this,this,s)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(t,e,s,i){const r=s.children[i];r.children.length>0?r.children.forEach((s,i)=>{e.adjustChildCoordinatesRecursiveCore(t,e,r,i)}):this.adjustChildCoordinates(t,e,s,i)}adjustChildCoordinates(t,e,s,i){const r=s.children[i];if("function"!=typeof r.measureText)return r;t.save(),r.setContext(t,!0);const n=r.getAttribute("x"),a=r.getAttribute("y"),o=r.getAttribute("dx"),l=r.getAttribute("dy"),h=r.getStyle("font-family").getDefinition(),c=Boolean(null==h?void 0:h.isRTL);0===i&&(n.hasValue()||n.setValue(r.getInheritedAttribute("x")),a.hasValue()||a.setValue(r.getInheritedAttribute("y")),o.hasValue()||o.setValue(r.getInheritedAttribute("dx")),l.hasValue()||l.setValue(r.getInheritedAttribute("dy")));const u=r.measureText(t);return c&&(e.x-=u),n.hasValue()?(e.applyAnchoring(),r.x=n.getPixels("x"),o.hasValue()&&(r.x+=o.getPixels("x"))):(o.hasValue()&&(e.x+=o.getPixels("x")),r.x=e.x),e.x=r.x,c||(e.x+=u),a.hasValue()?(r.y=a.getPixels("y"),l.hasValue()&&(r.y+=l.getPixels("y"))):(l.hasValue()&&(e.y+=l.getPixels("y")),r.y=e.y),e.y=r.y,e.leafTexts.push(r),e.minX=Math.min(e.minX,r.x,r.x+u),e.maxX=Math.max(e.maxX,r.x,r.x+u),r.clearContext(t),t.restore(),r}getChildBoundingBox(t,e,s,i){const r=s.children[i];if("function"!=typeof r.getBoundingBox)return null;const n=r.getBoundingBox(t);return n&&r.children.forEach((s,i)=>{const a=e.getChildBoundingBox(t,e,r,i);n.addBoundingBox(a)}),n}renderChild(t,e,s,i){const r=s.children[i];r.render(t),r.children.forEach((s,i)=>{e.renderChild(t,e,r,i)})}measureText(t){const{measureCache:e}=this;if(~e)return e;const s=this.getText(),i=this.measureTargetText(t,s);return this.measureCache=i,i}measureTargetText(t,e){if(!e.length)return 0;const{parent:s}=this,i=s.getStyle("font-family").getDefinition();if(i){const t=this.getFontSize(),r=i.isRTL?e.split("").reverse().join(""):e,n=C(s.getAttribute("dx").getString()),a=r.length;let o=0;for(let e=0;e<a;e++){o+=(this.getGlyph(i,r,e).horizAdvX||i.horizAdvX)*t/i.fontFace.unitsPerEm,void 0===n[e]||isNaN(n[e])||(o+=n[e])}return o}if(!t.measureText)return 10*e.length;t.save(),this.setContext(t,!0);const{width:r}=t.measureText(e);return this.clearContext(t),t.restore(),r}getInheritedAttribute(t){let e=this;for(;e instanceof mt&&e.isFirstChild()&&e.parent;){const s=e.parent.getAttribute(t);if(s.hasValue(!0))return s.getString("0");e=e.parent}return null}constructor(t,e,s){super(t,e,new.target===mt||s),this.type="text",this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.measureCache=-1}}class xt extends mt{getText(){return this.text}constructor(t,e,s){super(t,e,new.target===xt||s),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}}class yt extends xt{constructor(...t){super(...t),this.type="textNode"}}class bt extends v{reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new Q(0,0),this.control=new Q(0,0),this.current=new Q(0,0),this.points=[],this.angles=[]}isEnd(){const{i:t,commands:e}=this;return t>=e.length-1}next(){const t=this.commands[++this.i];return this.previousCommand=this.command,this.command=t,t}getPoint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"x",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y";const s=new Q(this.command[t],this.command[e]);return this.makeAbsolute(s)}getAsControlPoint(t,e){const s=this.getPoint(t,e);return this.control=s,s}getAsCurrentPoint(t,e){const s=this.getPoint(t,e);return this.current=s,s}getReflectedControlPoint(){const t=this.previousCommand.type;if(t!==v.CURVE_TO&&t!==v.SMOOTH_CURVE_TO&&t!==v.QUAD_TO&&t!==v.SMOOTH_QUAD_TO)return this.current;const{current:{x:e,y:s},control:{x:i,y:r}}=this;return new Q(2*e-i,2*s-r)}makeAbsolute(t){if(this.command.relative){const{x:e,y:s}=this.current;t.x+=e,t.y+=s}return t}addMarker(t,e,s){const{points:i,angles:r}=this;s&&r.length>0&&!r[r.length-1]&&(r[r.length-1]=i[i.length-1].angleTo(s)),this.addMarkerAngle(t,e?e.angleTo(t):null)}addMarkerAngle(t,e){this.points.push(t),this.angles.push(e)}getMarkerPoints(){return this.points}getMarkerAngles(){const{angles:t}=this,e=t.length;for(let s=0;s<e;s++)if(!t[s])for(let i=s+1;i<e;i++)if(t[i]){t[s]=t[i];break}return t}constructor(t){super(t.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=new Q(0,0),this.start=new Q(0,0),this.current=new Q(0,0),this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}}class wt extends ft{path(t){const{pathParser:e}=this,s=new gt;for(e.reset(),t&&t.beginPath();!e.isEnd();)switch(e.next().type){case bt.MOVE_TO:this.pathM(t,s);break;case bt.LINE_TO:this.pathL(t,s);break;case bt.HORIZ_LINE_TO:this.pathH(t,s);break;case bt.VERT_LINE_TO:this.pathV(t,s);break;case bt.CURVE_TO:this.pathC(t,s);break;case bt.SMOOTH_CURVE_TO:this.pathS(t,s);break;case bt.QUAD_TO:this.pathQ(t,s);break;case bt.SMOOTH_QUAD_TO:this.pathT(t,s);break;case bt.ARC:this.pathA(t,s);break;case bt.CLOSE_PATH:this.pathZ(t,s)}return s}getBoundingBox(t){return this.path()}getMarkers(){const{pathParser:t}=this,e=t.getMarkerPoints(),s=t.getMarkerAngles();return e.map((t,e)=>[t,s[e]])}renderChildren(t){this.path(t),this.document.screen.mouse.checkPath(this,t);const e=this.getStyle("fill-rule");""!==t.fillStyle&&("inherit"!==e.getString("inherit")?t.fill(e.getString()):t.fill()),""!==t.strokeStyle&&("non-scaling-stroke"===this.getAttribute("vector-effect").getString()?(t.save(),t.setTransform(1,0,0,1,0,0),t.stroke(),t.restore()):t.stroke());const s=this.getMarkers();if(s){const e=s.length-1,i=this.getStyle("marker-start"),r=this.getStyle("marker-mid"),n=this.getStyle("marker-end");if(i.isUrlDefinition()){const e=i.getDefinition(),[r,n]=s[0];e.render(t,r,n)}if(r.isUrlDefinition()){const i=r.getDefinition();for(let r=1;r<e;r++){const[e,n]=s[r];i.render(t,e,n)}}if(n.isUrlDefinition()){const i=n.getDefinition(),[r,a]=s[e];i.render(t,r,a)}}}static pathM(t){const e=t.getAsCurrentPoint();return t.start=t.current,{point:e}}pathM(t,e){const{pathParser:s}=this,{point:i}=wt.pathM(s),{x:r,y:n}=i;s.addMarker(i),e.addPoint(r,n),t&&t.moveTo(r,n)}static pathL(t){const{current:e}=t;return{current:e,point:t.getAsCurrentPoint()}}pathL(t,e){const{pathParser:s}=this,{current:i,point:r}=wt.pathL(s),{x:n,y:a}=r;s.addMarker(r,i),e.addPoint(n,a),t&&t.lineTo(n,a)}static pathH(t){const{current:e,command:s}=t,i=new Q((s.relative?e.x:0)+s.x,e.y);return t.current=i,{current:e,point:i}}pathH(t,e){const{pathParser:s}=this,{current:i,point:r}=wt.pathH(s),{x:n,y:a}=r;s.addMarker(r,i),e.addPoint(n,a),t&&t.lineTo(n,a)}static pathV(t){const{current:e,command:s}=t,i=new Q(e.x,(s.relative?e.y:0)+s.y);return t.current=i,{current:e,point:i}}pathV(t,e){const{pathParser:s}=this,{current:i,point:r}=wt.pathV(s),{x:n,y:a}=r;s.addMarker(r,i),e.addPoint(n,a),t&&t.lineTo(n,a)}static pathC(t){const{current:e}=t;return{current:e,point:t.getPoint("x1","y1"),controlPoint:t.getAsControlPoint("x2","y2"),currentPoint:t.getAsCurrentPoint()}}pathC(t,e){const{pathParser:s}=this,{current:i,point:r,controlPoint:n,currentPoint:a}=wt.pathC(s);s.addMarker(a,n,r),e.addBezierCurve(i.x,i.y,r.x,r.y,n.x,n.y,a.x,a.y),t&&t.bezierCurveTo(r.x,r.y,n.x,n.y,a.x,a.y)}static pathS(t){const{current:e}=t;return{current:e,point:t.getReflectedControlPoint(),controlPoint:t.getAsControlPoint("x2","y2"),currentPoint:t.getAsCurrentPoint()}}pathS(t,e){const{pathParser:s}=this,{current:i,point:r,controlPoint:n,currentPoint:a}=wt.pathS(s);s.addMarker(a,n,r),e.addBezierCurve(i.x,i.y,r.x,r.y,n.x,n.y,a.x,a.y),t&&t.bezierCurveTo(r.x,r.y,n.x,n.y,a.x,a.y)}static pathQ(t){const{current:e}=t;return{current:e,controlPoint:t.getAsControlPoint("x1","y1"),currentPoint:t.getAsCurrentPoint()}}pathQ(t,e){const{pathParser:s}=this,{current:i,controlPoint:r,currentPoint:n}=wt.pathQ(s);s.addMarker(n,r,r),e.addQuadraticCurve(i.x,i.y,r.x,r.y,n.x,n.y),t&&t.quadraticCurveTo(r.x,r.y,n.x,n.y)}static pathT(t){const{current:e}=t,s=t.getReflectedControlPoint();t.control=s;return{current:e,controlPoint:s,currentPoint:t.getAsCurrentPoint()}}pathT(t,e){const{pathParser:s}=this,{current:i,controlPoint:r,currentPoint:n}=wt.pathT(s);s.addMarker(n,r,r),e.addQuadraticCurve(i.x,i.y,r.x,r.y,n.x,n.y),t&&t.quadraticCurveTo(r.x,r.y,n.x,n.y)}static pathA(t){const{current:e,command:s}=t;let{rX:i,rY:r,xRot:n,lArcFlag:a,sweepFlag:o}=s;const l=n*(Math.PI/180),h=t.getAsCurrentPoint(),c=new Q(Math.cos(l)*(e.x-h.x)/2+Math.sin(l)*(e.y-h.y)/2,-Math.sin(l)*(e.x-h.x)/2+Math.cos(l)*(e.y-h.y)/2),u=Math.pow(c.x,2)/Math.pow(i,2)+Math.pow(c.y,2)/Math.pow(r,2);u>1&&(i*=Math.sqrt(u),r*=Math.sqrt(u));let d=(a===o?-1:1)*Math.sqrt((Math.pow(i,2)*Math.pow(r,2)-Math.pow(i,2)*Math.pow(c.y,2)-Math.pow(r,2)*Math.pow(c.x,2))/(Math.pow(i,2)*Math.pow(c.y,2)+Math.pow(r,2)*Math.pow(c.x,2)));isNaN(d)&&(d=0);const p=new Q(d*i*c.y/r,d*-r*c.x/i),g=new Q((e.x+h.x)/2+Math.cos(l)*p.x-Math.sin(l)*p.y,(e.y+h.y)/2+Math.sin(l)*p.x+Math.cos(l)*p.y),f=F([1,0],[(c.x-p.x)/i,(c.y-p.y)/r]),m=[(c.x-p.x)/i,(c.y-p.y)/r],x=[(-c.x-p.x)/i,(-c.y-p.y)/r];let y=F(m,x);return B(m,x)<=-1&&(y=Math.PI),B(m,x)>=1&&(y=0),{currentPoint:h,rX:i,rY:r,sweepFlag:o,xAxisRotation:l,centp:g,a1:f,ad:y}}pathA(t,e){const{pathParser:s}=this,{currentPoint:i,rX:r,rY:n,sweepFlag:a,xAxisRotation:o,centp:l,a1:h,ad:c}=wt.pathA(s),u=1-a?1:-1,d=h+u*(c/2),p=new Q(l.x+r*Math.cos(d),l.y+n*Math.sin(d));if(s.addMarkerAngle(p,d-u*Math.PI/2),s.addMarkerAngle(i,d-u*Math.PI),e.addPoint(i.x,i.y),t&&!isNaN(h)&&!isNaN(c)){const e=r>n?r:n,s=r>n?1:r/n,i=r>n?n/r:1;t.translate(l.x,l.y),t.rotate(o),t.scale(s,i),t.arc(0,0,e,h,h+c,Boolean(1-a)),t.scale(1/s,1/i),t.rotate(-o),t.translate(-l.x,-l.y)}}static pathZ(t){t.current=t.start}pathZ(t,e){wt.pathZ(this.pathParser),t&&e.x1!==e.x2&&e.y1!==e.y2&&t.closePath()}constructor(t,e,s){super(t,e,s),this.type="path",this.pathParser=new bt(this.getAttribute("d").getString())}}class kt extends ft{setContext(t){var e;const{document:s}=this,{screen:i,window:r}=s,n=t.canvas;if(i.setDefaults(t),"style"in n&&void 0!==t.font&&r&&void 0!==r.getComputedStyle){t.font=r.getComputedStyle(n).getPropertyValue("font");const e=new X(s,"fontSize",pt.parse(t.font).fontSize);e.hasValue()&&(s.rootEmSize=e.getPixels("y"),s.emSize=s.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);let{width:a,height:o}=i.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");const l=this.getAttribute("refX"),h=this.getAttribute("refY"),c=this.getAttribute("viewBox"),u=c.hasValue()?C(c.getString()):null,d=!this.root&&"visible"!==this.getStyle("overflow").getValue("hidden");let p=0,g=0,f=0,m=0;u&&(p=u[0],g=u[1]),this.root||(a=this.getStyle("width").getPixels("x"),o=this.getStyle("height").getPixels("y"),"marker"===this.type&&(f=p,m=g,p=0,g=0)),i.viewPort.setCurrent(a,o),!this.node||this.parent&&"foreignObject"!==(null===(e=this.node.parentNode)||void 0===e?void 0:e.nodeName)||!this.getStyle("transform",!1,!0).hasValue()||this.getStyle("transform-origin",!1,!0).hasValue()||this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(t),t.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),u&&(a=u[2],o=u[3]),s.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:i.viewPort.width,desiredWidth:a,height:i.viewPort.height,desiredHeight:o,minX:p,minY:g,refX:l.getValue(),refY:h.getValue(),clip:d,clipX:f,clipY:m}),u&&(i.viewPort.removeCurrent(),i.viewPort.setCurrent(a,o))}clearContext(t){super.clearContext(t),this.document.screen.viewPort.removeCurrent()}resize(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this.getAttribute("width",!0),r=this.getAttribute("height",!0),n=this.getAttribute("viewBox"),a=this.getAttribute("style"),o=i.getNumber(0),l=r.getNumber(0);if(s)if("string"==typeof s)this.getAttribute("preserveAspectRatio",!0).setValue(s);else{const t=this.getAttribute("preserveAspectRatio");t.hasValue()&&t.setValue(t.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(i.setValue(t),r.setValue(e),n.hasValue()||n.setValue("0 0 ".concat(o||t," ").concat(l||e)),a.hasValue()){const s=this.getStyle("width"),i=this.getStyle("height");s.hasValue()&&s.setValue("".concat(t,"px")),i.hasValue()&&i.setValue("".concat(e,"px"))}}constructor(...t){super(...t),this.type="svg",this.root=!1}}class St extends wt{path(t){const e=this.getAttribute("x").getPixels("x"),s=this.getAttribute("y").getPixels("y"),i=this.getStyle("width",!1,!0).getPixels("x"),r=this.getStyle("height",!1,!0).getPixels("y"),n=this.getAttribute("rx"),a=this.getAttribute("ry");let o=n.getPixels("x"),l=a.getPixels("y");if(n.hasValue()&&!a.hasValue()&&(l=o),a.hasValue()&&!n.hasValue()&&(o=l),o=Math.min(o,i/2),l=Math.min(l,r/2),t){const n=(Math.sqrt(2)-1)/3*4;t.beginPath(),r>0&&i>0&&(t.moveTo(e+o,s),t.lineTo(e+i-o,s),t.bezierCurveTo(e+i-o+n*o,s,e+i,s+l-n*l,e+i,s+l),t.lineTo(e+i,s+r-l),t.bezierCurveTo(e+i,s+r-l+n*l,e+i-o+n*o,s+r,e+i-o,s+r),t.lineTo(e+o,s+r),t.bezierCurveTo(e+o-n*o,s+r,e,s+r-l+n*l,e,s+r-l),t.lineTo(e,s+l),t.bezierCurveTo(e,s+l-n*l,e+o-n*o,s,e+o,s),t.closePath())}return new gt(e,s,e+i,s+r)}getMarkers(){return null}constructor(...t){super(...t),this.type="rect"}}class vt extends wt{path(t){const{points:e}=this,[{x:s,y:i}]=e,r=new gt(s,i);return t&&(t.beginPath(),t.moveTo(s,i)),e.forEach(e=>{let{x:s,y:i}=e;r.addPoint(s,i),t&&t.lineTo(s,i)}),r}getMarkers(){const{points:t}=this,e=t.length-1,s=[];return t.forEach((i,r)=>{r!==e&&s.push([i,i.angleTo(t[r+1])])}),s.length>0&&s.push([t[t.length-1],s[s.length-1][1]]),s}constructor(t,e,s){super(t,e,s),this.type="polyline",this.points=[],this.points=Q.parsePath(this.getAttribute("points").getString())}}class Pt extends ft{getBoundingBox(t){const e=new gt;return this.children.forEach(s=>{e.addBoundingBox(s.getBoundingBox(t))}),e}constructor(...t){super(...t),this.type="g"}}class _t extends lt{getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(t,e,s){let i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(i));const{stops:r}=i,n=this.getGradient(t,e);if(!n)return this.addParentOpacity(s,r[r.length-1].color);if(r.forEach(t=>{n.addColorStop(t.offset,this.addParentOpacity(s,t.color))}),this.getAttribute("gradientTransform").hasValue()){const{document:t}=this,{MAX_VIRTUAL_PIXELS:e}=et,{viewPort:s}=t.screen,i=s.getRoot(),r=new St(t);r.attributes.set("x",new X(t,"x",-e/3)),r.attributes.set("y",new X(t,"y",-e/3)),r.attributes.set("width",new X(t,"width",e)),r.attributes.set("height",new X(t,"height",e));const a=new Pt(t);a.attributes.set("transform",new X(t,"transform",this.getAttribute("gradientTransform").getValue())),a.children=[r];const o=new kt(t);o.attributes.set("x",new X(t,"x",0)),o.attributes.set("y",new X(t,"y",0)),o.attributes.set("width",new X(t,"width",i.width)),o.attributes.set("height",new X(t,"height",i.height)),o.children=[a];const l=t.createCanvas(i.width,i.height),h=l.getContext("2d");return h.fillStyle=n,o.render(h),h.createPattern(l,"no-repeat")}return n}inheritStopContainer(t){this.attributesToInherit.forEach(e=>{!this.getAttribute(e).hasValue()&&t.getAttribute(e).hasValue()&&this.getAttribute(e,!0).setValue(t.getAttribute(e).getValue())})}addParentOpacity(t,e){if(t.hasValue()){return new X(this.document,"color",e).addOpacity(t).getColor()}return e}constructor(t,e,s){super(t,e,s),this.attributesToInherit=["gradientUnits"],this.stops=[];const{stops:i,children:r}=this;r.forEach(t=>{"stop"===t.type&&i.push(t)})}}class Ct extends lt{getProperty(){const t=this.getAttribute("attributeType").getString(),e=this.getAttribute("attributeName").getString();return"CSS"===t?this.parent.getStyle(e,!0):this.parent.getAttribute(e,!0)}calcValue(){const{initialUnits:t}=this,{progress:e,from:s,to:i}=this.getProgress();let r=s.getNumber()+(i.getNumber()-s.getNumber())*e;return"%"===t&&(r*=100),"".concat(r).concat(t)}update(t){const{parent:e}=this,s=this.getProperty();if(this.initialValue||(this.initialValue=s.getString(),this.initialUnits=s.getUnits()),this.duration>this.maxDuration){const t=this.getAttribute("fill").getString("remove");if("indefinite"===this.getAttribute("repeatCount").getString()||"indefinite"===this.getAttribute("repeatDur").getString())this.duration=0;else if("freeze"!==t||this.frozen){if("remove"===t&&!this.removed)return this.removed=!0,e&&s&&s.setValue(e.animationFrozen?e.animationFrozenValue:this.initialValue),!0}else this.frozen=!0,e&&s&&(e.animationFrozen=!0,e.animationFrozenValue=s.getString());return!1}this.duration+=t;let i=!1;if(this.begin<this.duration){let t=this.calcValue();const e=this.getAttribute("type");if(e.hasValue()){const s=e.getString();t="".concat(s,"(").concat(t,")")}s.setValue(t),i=!0}return i}getProgress(){const{document:t,values:e}=this;let s,i,r=(this.duration-this.begin)/(this.maxDuration-this.begin);if(e.hasValue()){const n=r*(e.getValue().length-1),a=Math.floor(n),o=Math.ceil(n);let l;l=e.getValue()[a],s=new X(t,"from",l?parseFloat(l):0),l=e.getValue()[o],i=new X(t,"to",l?parseFloat(l):0),r=(n-a)/(o-a)}else s=this.from,i=this.to;return{progress:r,from:s,to:i}}constructor(t,e,s){super(t,e,s),this.type="animate",this.duration=0,this.initialUnits="",this.removed=!1,this.frozen=!1,t.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new X(t,"values",null);const i=this.getAttribute("values");i.hasValue()&&this.values.setValue(i.getString().split(";"))}}class At extends lt{constructor(t,e,s){super(t,e,s),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class It extends wt{constructor(t,e,s){super(t,e,s),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class Tt extends It{constructor(...t){super(...t),this.type="missing-glyph",this.horizAdvX=0}}const Dt=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class Rt{async load(t,e){try{const{document:s}=this,i=(await s.canvg.parser.load(e)).getElementsByTagName("font");Array.from(i).forEach(e=>{const i=s.createElement(e);s.definitions.set(t,i)})}catch(s){}this.loaded=!0}constructor(t){this.document=t,this.loaded=!1,t.fonts.push(this)}}class Nt extends lt{constructor(t,e,s){super(t,e,s),this.type="style";_(Array.from(e.childNodes).map(t=>t.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")).split("}").forEach(e=>{const s=e.trim();if(!s)return;const i=s.split("{"),r=i[0].split(","),n=i[1].split(";");r.forEach(e=>{const s=e.trim();if(!s)return;const i=t.styles.get(s)||new Map;if(n.forEach(e=>{const s=e.indexOf(":"),r=e.substr(0,s).trim(),n=e.substr(s+1,e.length-s).trim();r&&n&&i.set(r,new X(t,r,n))}),t.styles.set(s,i),t.stylesSpecificity.set(s,function(t){const e=[0,0,0];let s=t.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),i=0;return[s,i]=j(s,T),e[1]+=i,[s,i]=j(s,D),e[0]+=i,[s,i]=j(s,R),e[1]+=i,[s,i]=j(s,N),e[2]+=i,[s,i]=j(s,M),e[1]+=i,[s,i]=j(s,L),e[1]+=i,s=s.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[s,i]=j(s,E),e[2]+=i,e.join("")}(s)),"@font-face"===s){const e=i.get("font-family").getString().replace(/"|'/g,"");i.get("src").getString().split(",").forEach(s=>{if(s.indexOf('format("svg")')>0){const i=I(s);i&&new Rt(t).load(e,i)}})}})})}}Nt.parseExternalUrl=I;function Mt(t,e,s,i,r,n){return t[s*i*4+4*e+n]}function Lt(t,e,s,i,r,n,a){t[s*i*4+4*e+n]=a}function Et(t,e,s){return t[e]*s}function jt(t,e,s,i){return e+Math.cos(t)*s+Math.sin(t)*i}class zt extends lt{apply(t,e,s,i,r){const{includeOpacity:n,matrix:a}=this,o=t.getImageData(0,0,i,r);for(let l=0;l<r;l++)for(let t=0;t<i;t++){const e=Mt(o.data,t,l,i,0,0),s=Mt(o.data,t,l,i,0,1),r=Mt(o.data,t,l,i,0,2),h=Mt(o.data,t,l,i,0,3);let c=Et(a,0,e)+Et(a,1,s)+Et(a,2,r)+Et(a,3,h)+Et(a,4,1),u=Et(a,5,e)+Et(a,6,s)+Et(a,7,r)+Et(a,8,h)+Et(a,9,1),d=Et(a,10,e)+Et(a,11,s)+Et(a,12,r)+Et(a,13,h)+Et(a,14,1),p=Et(a,15,e)+Et(a,16,s)+Et(a,17,r)+Et(a,18,h)+Et(a,19,1);n&&(c=0,u=0,d=0,p*=h/255),Lt(o.data,t,l,i,0,0,c),Lt(o.data,t,l,i,0,1,u),Lt(o.data,t,l,i,0,2,d),Lt(o.data,t,l,i,0,3,p)}t.clearRect(0,0,i,r),t.putImageData(o,0,0)}constructor(t,e,s){super(t,e,s),this.type="feColorMatrix";let i=C(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{const t=i[0];i=[.213+.787*t,.715-.715*t,.072-.072*t,0,0,.213-.213*t,.715+.285*t,.072-.072*t,0,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{const t=i[0]*Math.PI/180;i=[jt(t,.213,.787,-.213),jt(t,.715,-.715,-.715),jt(t,.072,-.072,.928),0,0,jt(t,.213,-.213,.143),jt(t,.715,.285,.14),jt(t,.072,-.072,-.283),0,0,jt(t,.213,-.213,-.787),jt(t,.715,-.715,.715),jt(t,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}this.matrix=i,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}}class Vt extends lt{apply(t,e){const{document:s}=this;let i=this.getAttribute("x").getPixels("x"),r=this.getAttribute("y").getPixels("y"),n=this.getStyle("width").getPixels("x"),a=this.getStyle("height").getPixels("y");if(!n&&!a){const e=new gt;this.children.forEach(s=>{e.addBoundingBox(s.getBoundingBox(t))}),i=Math.floor(e.x1),r=Math.floor(e.y1),n=Math.floor(e.width),a=Math.floor(e.height)}const o=this.removeStyles(e,Vt.ignoreStyles),l=s.createCanvas(i+n,r+a),h=l.getContext("2d");s.screen.setDefaults(h),this.renderChildren(h),new zt(s,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(h,0,0,i+n,r+a);const c=s.createCanvas(i+n,r+a),u=c.getContext("2d");s.screen.setDefaults(u),e.render(u),u.globalCompositeOperation="destination-in",u.fillStyle=h.createPattern(l,"no-repeat"),u.fillRect(0,0,i+n,r+a),t.fillStyle=u.createPattern(c,"no-repeat"),t.fillRect(0,0,i+n,r+a),this.restoreStyles(e,o)}render(t){}constructor(...t){super(...t),this.type="mask"}}Vt.ignoreStyles=["mask","transform","clip-path"];const Bt=()=>{};class Ft extends lt{apply(t,e){const{document:s,children:i}=this,r="getBoundingBox"in e?e.getBoundingBox(t):null;if(!r)return;let n=0,a=0;i.forEach(t=>{const e=t.extraFilterDistance||0;n=Math.max(n,e),a=Math.max(a,e)});const o=Math.floor(r.width),l=Math.floor(r.height),h=o+2*n,c=l+2*a;if(h<1||c<1)return;const u=Math.floor(r.x),d=Math.floor(r.y),p=this.removeStyles(e,Ft.ignoreStyles),g=s.createCanvas(h,c),f=g.getContext("2d");s.screen.setDefaults(f),f.translate(-u+n,-d+a),e.render(f),i.forEach(t=>{"function"==typeof t.apply&&t.apply(f,0,0,h,c)}),t.drawImage(g,0,0,h,c,u-n,d-a,h,c),this.restoreStyles(e,p)}render(t){}constructor(...t){super(...t),this.type="filter"}}Ft.ignoreStyles=["filter","transform","clip-path"];const Ot={svg:kt,rect:St,circle:class extends wt{path(t){const e=this.getAttribute("cx").getPixels("x"),s=this.getAttribute("cy").getPixels("y"),i=this.getAttribute("r").getPixels();return t&&i>0&&(t.beginPath(),t.arc(e,s,i,0,2*Math.PI,!1),t.closePath()),new gt(e-i,s-i,e+i,s+i)}getMarkers(){return null}constructor(...t){super(...t),this.type="circle"}},ellipse:class extends wt{path(t){const e=(Math.sqrt(2)-1)/3*4,s=this.getAttribute("rx").getPixels("x"),i=this.getAttribute("ry").getPixels("y"),r=this.getAttribute("cx").getPixels("x"),n=this.getAttribute("cy").getPixels("y");return t&&s>0&&i>0&&(t.beginPath(),t.moveTo(r+s,n),t.bezierCurveTo(r+s,n+e*i,r+e*s,n+i,r,n+i),t.bezierCurveTo(r-e*s,n+i,r-s,n+e*i,r-s,n),t.bezierCurveTo(r-s,n-e*i,r-e*s,n-i,r,n-i),t.bezierCurveTo(r+e*s,n-i,r+s,n-e*i,r+s,n),t.closePath()),new gt(r-s,n-i,r+s,n+i)}getMarkers(){return null}constructor(...t){super(...t),this.type="ellipse"}},line:class extends wt{getPoints(){return[new Q(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new Q(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(t){const[{x:e,y:s},{x:i,y:r}]=this.getPoints();return t&&(t.beginPath(),t.moveTo(e,s),t.lineTo(i,r)),new gt(e,s,i,r)}getMarkers(){const[t,e]=this.getPoints(),s=t.angleTo(e);return[[t,s],[e,s]]}constructor(...t){super(...t),this.type="line"}},polyline:vt,polygon:class extends vt{path(t){const e=super.path(t),[{x:s,y:i}]=this.points;return t&&(t.lineTo(s,i),t.closePath()),e}constructor(...t){super(...t),this.type="polygon"}},path:wt,pattern:class extends lt{createPattern(t,e,s){const i=this.getStyle("width").getPixels("x",!0),r=this.getStyle("height").getPixels("y",!0),n=new kt(this.document,null);n.attributes.set("viewBox",new X(this.document,"viewBox",this.getAttribute("viewBox").getValue())),n.attributes.set("width",new X(this.document,"width","".concat(i,"px"))),n.attributes.set("height",new X(this.document,"height","".concat(r,"px"))),n.attributes.set("transform",new X(this.document,"transform",this.getAttribute("patternTransform").getValue())),n.children=this.children;const a=this.document.createCanvas(i,r),o=a.getContext("2d"),l=this.getAttribute("x"),h=this.getAttribute("y");l.hasValue()&&h.hasValue()&&o.translate(l.getPixels("x",!0),h.getPixels("y",!0)),s.hasValue()?this.styles.set("fill-opacity",s):this.styles.delete("fill-opacity");for(let c=-1;c<=1;c++)for(let t=-1;t<=1;t++)o.save(),n.attributes.set("x",new X(this.document,"x",c*a.width)),n.attributes.set("y",new X(this.document,"y",t*a.height)),n.render(o),o.restore();return t.createPattern(a,"repeat")}constructor(...t){super(...t),this.type="pattern"}},marker:class extends lt{render(t,e,s){if(!e)return;const{x:i,y:r}=e,n=this.getAttribute("orient").getString("auto"),a=this.getAttribute("markerUnits").getString("strokeWidth");t.translate(i,r),"auto"===n&&t.rotate(s),"strokeWidth"===a&&t.scale(t.lineWidth,t.lineWidth),t.save();const o=new kt(this.document);o.type=this.type,o.attributes.set("viewBox",new X(this.document,"viewBox",this.getAttribute("viewBox").getValue())),o.attributes.set("refX",new X(this.document,"refX",this.getAttribute("refX").getValue())),o.attributes.set("refY",new X(this.document,"refY",this.getAttribute("refY").getValue())),o.attributes.set("width",new X(this.document,"width",this.getAttribute("markerWidth").getValue())),o.attributes.set("height",new X(this.document,"height",this.getAttribute("markerHeight").getValue())),o.attributes.set("overflow",new X(this.document,"overflow",this.getAttribute("overflow").getValue())),o.attributes.set("fill",new X(this.document,"fill",this.getAttribute("fill").getColor("black"))),o.attributes.set("stroke",new X(this.document,"stroke",this.getAttribute("stroke").getValue("none"))),o.children=this.children,o.render(t),t.restore(),"strokeWidth"===a&&t.scale(1/t.lineWidth,1/t.lineWidth),"auto"===n&&t.rotate(-s),t.translate(-i,-r)}constructor(...t){super(...t),this.type="marker"}},defs:class extends lt{render(){}constructor(...t){super(...t),this.type="defs"}},linearGradient:class extends _t{getGradient(t,e){const s="objectBoundingBox"===this.getGradientUnits(),i=s?e.getBoundingBox(t):null;if(s&&!i)return null;this.getAttribute("x1").hasValue()||this.getAttribute("y1").hasValue()||this.getAttribute("x2").hasValue()||this.getAttribute("y2").hasValue()||(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));const r=s?i.x+i.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),n=s?i.y+i.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),a=s?i.x+i.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),o=s?i.y+i.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return r===a&&n===o?null:t.createLinearGradient(r,n,a,o)}constructor(t,e,s){super(t,e,s),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}},radialGradient:class extends _t{getGradient(t,e){const s="objectBoundingBox"===this.getGradientUnits(),i=e.getBoundingBox(t);if(s&&!i)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");const r=s?i.x+i.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),n=s?i.y+i.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y");let a=r,o=n;this.getAttribute("fx").hasValue()&&(a=s?i.x+i.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(o=s?i.y+i.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));const l=s?(i.width+i.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),h=this.getAttribute("fr").getPixels();return t.createRadialGradient(a,o,h,r,n,l)}constructor(t,e,s){super(t,e,s),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}},stop:class extends lt{constructor(t,e,s){super(t,e,s),this.type="stop";const i=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),r=this.getStyle("stop-opacity");let n=this.getStyle("stop-color",!0);""===n.getString()&&n.setValue("#000"),r.hasValue()&&(n=n.addOpacity(r)),this.offset=i,this.color=n.getColor()}},animate:Ct,animateColor:class extends Ct{calcValue(){const{progress:t,from:e,to:s}=this.getProgress(),i=new k(e.getColor()),r=new k(s.getColor());if(i.ok&&r.ok){const e=i.r+(r.r-i.r)*t,s=i.g+(r.g-i.g)*t,n=i.b+(r.b-i.b)*t;return"rgb(".concat(Math.floor(e),", ").concat(Math.floor(s),", ").concat(Math.floor(n),")")}return this.getAttribute("from").getColor()}constructor(...t){super(...t),this.type="animateColor"}},animateTransform:class extends Ct{calcValue(){const{progress:t,from:e,to:s}=this.getProgress(),i=C(e.getString()),r=C(s.getString());return i.map((e,s)=>e+(r[s]-e)*t).join(" ")}constructor(...t){super(...t),this.type="animateTransform"}},font:class extends lt{render(){}constructor(t,e,s){super(t,e,s),this.type="font",this.isArabic=!1,this.glyphs=new Map,this.arabicGlyphs=new Map,this.isRTL=!1,this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();const{definitions:i}=t,{children:r}=this;for(const n of r)if(n instanceof At){this.fontFace=n;const t=n.getStyle("font-family");t.hasValue()&&i.set(t.getString(),this)}else if(n instanceof Tt)this.missingGlyph=n;else if(n instanceof It)if(n.arabicForm){this.isRTL=!0,this.isArabic=!0;let t=this.arabicGlyphs.get(n.unicode);void 0===t&&(t=new Map,this.arabicGlyphs.set(n.unicode,t)),t.set(n.arabicForm,n)}else this.glyphs.set(n.unicode,n)}},"font-face":At,"missing-glyph":Tt,glyph:It,text:mt,tspan:xt,tref:class extends mt{getText(){const t=this.getHrefAttribute().getDefinition();if(t){const e=t.children[0];if(e)return e.getText()}return""}constructor(...t){super(...t),this.type="tref"}},a:class extends mt{getText(){return this.text}renderChildren(t){if(this.hasText){super.renderChildren(t);const{document:e,x:s,y:i}=this,{mouse:r}=e.screen,n=new X(e,"fontSize",pt.parse(e.ctx.font).fontSize);r.isWorking()&&r.checkBoundingBox(this,new gt(s,i-n.getPixels("y"),s+this.measureText(t),i))}else if(this.children.length>0){const e=new Pt(this.document);e.children=this.children,e.parent=this,e.render(t)}}onClick(){const{window:t}=this.document;t&&t.open(this.getHrefAttribute().getString())}onMouseMove(){this.document.ctx.canvas.style.cursor="pointer"}constructor(t,e,s){super(t,e,s),this.type="a";const{childNodes:i}=e,r=i[0],n=i.length>0&&Array.from(i).every(t=>3===t.nodeType);this.hasText=n,this.text=n?this.getTextFromNode(r):""}},textPath:class extends mt{getText(){return this.text}path(t){const{dataArray:e}=this;t&&t.beginPath(),e.forEach(e=>{let{type:s,points:i}=e;switch(s){case bt.LINE_TO:t&&t.lineTo(i[0],i[1]);break;case bt.MOVE_TO:t&&t.moveTo(i[0],i[1]);break;case bt.CURVE_TO:t&&t.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]);break;case bt.QUAD_TO:t&&t.quadraticCurveTo(i[0],i[1],i[2],i[3]);break;case bt.ARC:{const[e,s,r,n,a,o,l,h]=i,c=r>n?r:n,u=r>n?1:r/n,d=r>n?n/r:1;t&&(t.translate(e,s),t.rotate(l),t.scale(u,d),t.arc(0,0,c,a,a+o,Boolean(1-h)),t.scale(1/u,1/d),t.rotate(-l),t.translate(-e,-s));break}case bt.CLOSE_PATH:t&&t.closePath()}})}renderChildren(t){this.setTextData(t),t.save();const e=this.parent.getStyle("text-decoration").getString(),s=this.getFontSize(),{glyphInfo:i}=this,r=t.fillStyle;"underline"===e&&t.beginPath(),i.forEach((i,r)=>{const{p0:n,p1:a,rotation:o,text:l}=i;t.save(),t.translate(n.x,n.y),t.rotate(o),t.fillStyle&&t.fillText(l,0,0),t.strokeStyle&&t.strokeText(l,0,0),t.restore(),"underline"===e&&(0===r&&t.moveTo(n.x,n.y+s/8),t.lineTo(a.x,a.y+s/5))}),"underline"===e&&(t.lineWidth=s/20,t.strokeStyle=r,t.stroke(),t.closePath()),t.restore()}getLetterSpacingAt(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.letterSpacingCache[t]||0}findSegmentToFitChar(t,e,s,i,r,n,a,o,l){let h=n,c=this.measureText(t,o);" "===o&&"justify"===e&&s<i&&(c+=(i-s)/r),l>-1&&(h+=this.getLetterSpacingAt(l));const u=this.textHeight/20,d=this.getEquidistantPointOnPath(h,u,0),p=this.getEquidistantPointOnPath(h+c,u,0),g={p0:d,p1:p},f=d&&p?Math.atan2(p.y-d.y,p.x-d.x):0;if(a){const t=Math.cos(Math.PI/2+f)*a,e=Math.cos(-f)*a;g.p0={...d,x:d.x+t,y:d.y+e},g.p1={...p,x:p.x+t,y:p.y+e}}return h+=c,{offset:h,segment:g,rotation:f}}measureText(t,e){const{measuresCache:s}=this,i=e||this.getText();if(s.has(i))return s.get(i);const r=this.measureTargetText(t,i);return s.set(i,r),r}setTextData(t){if(this.glyphInfo)return;const e=this.getText(),s=e.split(""),i=e.split(" ").length-1,r=this.parent.getAttribute("dx").split().map(t=>t.getPixels("x")),n=this.parent.getAttribute("dy").getPixels("y"),a=this.parent.getStyle("text-anchor").getString("start"),o=this.getStyle("letter-spacing"),l=this.parent.getStyle("letter-spacing");let h=0;o.hasValue()&&"inherit"!==o.getValue()?o.hasValue()&&"initial"!==o.getValue()&&"unset"!==o.getValue()&&(h=o.getPixels()):h=l.getPixels();const c=[],u=e.length;this.letterSpacingCache=c;for(let y=0;y<u;y++)c.push(void 0!==r[y]?r[y]:h);const d=c.reduce((t,e,s)=>0===s?0:t+e||0,0),p=this.measureText(t),g=Math.max(p+d,0);this.textWidth=p,this.textHeight=this.getFontSize(),this.glyphInfo=[];const f=this.getPathLength(),m=this.getStyle("startOffset").getNumber(0)*f;let x=0;"middle"!==a&&"center"!==a||(x=-g/2),"end"!==a&&"right"!==a||(x=-g),x+=m,s.forEach((e,r)=>{const{offset:o,segment:l,rotation:h}=this.findSegmentToFitChar(t,a,g,f,i,x,n,e,r);x=o,l.p0&&l.p1&&this.glyphInfo.push({text:s[r],p0:l.p0,p1:l.p1,rotation:h})})}parsePathData(t){if(this.pathLength=-1,!t)return[];const e=[],{pathParser:s}=t;for(s.reset();!s.isEnd();){const{current:t}=s,i=t?t.x:0,r=t?t.y:0,n=s.next();let a=n.type,o=[];switch(n.type){case bt.MOVE_TO:this.pathM(s,o);break;case bt.LINE_TO:a=this.pathL(s,o);break;case bt.HORIZ_LINE_TO:a=this.pathH(s,o);break;case bt.VERT_LINE_TO:a=this.pathV(s,o);break;case bt.CURVE_TO:this.pathC(s,o);break;case bt.SMOOTH_CURVE_TO:a=this.pathS(s,o);break;case bt.QUAD_TO:this.pathQ(s,o);break;case bt.SMOOTH_QUAD_TO:a=this.pathT(s,o);break;case bt.ARC:o=this.pathA(s);break;case bt.CLOSE_PATH:wt.pathZ(s)}n.type!==bt.CLOSE_PATH?e.push({type:a,points:o,start:{x:i,y:r},pathLength:this.calcLength(i,r,a,o)}):e.push({type:bt.CLOSE_PATH,points:[],pathLength:0})}return e}pathM(t,e){const{x:s,y:i}=wt.pathM(t).point;e.push(s,i)}pathL(t,e){const{x:s,y:i}=wt.pathL(t).point;return e.push(s,i),bt.LINE_TO}pathH(t,e){const{x:s,y:i}=wt.pathH(t).point;return e.push(s,i),bt.LINE_TO}pathV(t,e){const{x:s,y:i}=wt.pathV(t).point;return e.push(s,i),bt.LINE_TO}pathC(t,e){const{point:s,controlPoint:i,currentPoint:r}=wt.pathC(t);e.push(s.x,s.y,i.x,i.y,r.x,r.y)}pathS(t,e){const{point:s,controlPoint:i,currentPoint:r}=wt.pathS(t);return e.push(s.x,s.y,i.x,i.y,r.x,r.y),bt.CURVE_TO}pathQ(t,e){const{controlPoint:s,currentPoint:i}=wt.pathQ(t);e.push(s.x,s.y,i.x,i.y)}pathT(t,e){const{controlPoint:s,currentPoint:i}=wt.pathT(t);return e.push(s.x,s.y,i.x,i.y),bt.QUAD_TO}pathA(t){let{rX:e,rY:s,sweepFlag:i,xAxisRotation:r,centp:n,a1:a,ad:o}=wt.pathA(t);return 0===i&&o>0&&(o-=2*Math.PI),1===i&&o<0&&(o+=2*Math.PI),[n.x,n.y,e,s,a,o,r,i]}calcLength(t,e,s,i){let r=0,n=null,a=null,o=0;switch(s){case bt.LINE_TO:return this.getLineLength(t,e,i[0],i[1]);case bt.CURVE_TO:for(r=0,n=this.getPointOnCubicBezier(0,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),o=.01;o<=1;o+=.01)a=this.getPointOnCubicBezier(o,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),r+=this.getLineLength(n.x,n.y,a.x,a.y),n=a;return r;case bt.QUAD_TO:for(r=0,n=this.getPointOnQuadraticBezier(0,t,e,i[0],i[1],i[2],i[3]),o=.01;o<=1;o+=.01)a=this.getPointOnQuadraticBezier(o,t,e,i[0],i[1],i[2],i[3]),r+=this.getLineLength(n.x,n.y,a.x,a.y),n=a;return r;case bt.ARC:{r=0;const t=i[4],e=i[5],s=i[4]+e;let l=Math.PI/180;if(Math.abs(t-s)<l&&(l=Math.abs(t-s)),n=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],t,0),e<0)for(o=t-l;o>s;o-=l)a=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],o,0),r+=this.getLineLength(n.x,n.y,a.x,a.y),n=a;else for(o=t+l;o<s;o+=l)a=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],o,0),r+=this.getLineLength(n.x,n.y,a.x,a.y),n=a;return a=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],s,0),r+=this.getLineLength(n.x,n.y,a.x,a.y),r}}return 0}getPointOnLine(t,e,s,i,r){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:s;const o=(r-s)/(i-e+z);let l=Math.sqrt(t*t/(1+o*o));i<e&&(l*=-1);let h=o*l,c=null;if(i===e)c={x:n,y:a+h};else if((a-s)/(n-e+z)===o)c={x:n+l,y:a+h};else{let u=0,d=0;const p=this.getLineLength(e,s,i,r);if(p<z)return null;let g=(n-e)*(i-e)+(a-s)*(r-s);g/=p*p,u=e+g*(i-e),d=s+g*(r-s);const f=this.getLineLength(n,a,u,d),m=Math.sqrt(t*t-f*f);l=Math.sqrt(m*m/(1+o*o)),i<e&&(l*=-1),h=o*l,c={x:u+l,y:d+h}}return c}getPointOnPath(t){const e=this.getPathLength();let s=0,i=null;if(t<-5e-5||t-5e-5>e)return null;const{dataArray:r}=this;for(const n of r){if(n&&(n.pathLength<5e-5||s+n.pathLength+5e-5<t)){s+=n.pathLength;continue}const e=t-s;let r=0;switch(n.type){case bt.LINE_TO:i=this.getPointOnLine(e,n.start.x,n.start.y,n.points[0],n.points[1],n.start.x,n.start.y);break;case bt.ARC:{const t=n.points[4],s=n.points[5],a=n.points[4]+s;if(r=t+e/n.pathLength*s,s<0&&r<a||s>=0&&r>a)break;i=this.getPointOnEllipticalArc(n.points[0],n.points[1],n.points[2],n.points[3],r,n.points[6]);break}case bt.CURVE_TO:r=e/n.pathLength,r>1&&(r=1),i=this.getPointOnCubicBezier(r,n.start.x,n.start.y,n.points[0],n.points[1],n.points[2],n.points[3],n.points[4],n.points[5]);break;case bt.QUAD_TO:r=e/n.pathLength,r>1&&(r=1),i=this.getPointOnQuadraticBezier(r,n.start.x,n.start.y,n.points[0],n.points[1],n.points[2],n.points[3])}if(i)return i;break}return null}getLineLength(t,e,s,i){return Math.sqrt((s-t)*(s-t)+(i-e)*(i-e))}getPathLength(){return-1===this.pathLength&&(this.pathLength=this.dataArray.reduce((t,e)=>e.pathLength>0?t+e.pathLength:t,0)),this.pathLength}getPointOnCubicBezier(t,e,s,i,r,n,a,o,l){return{x:o*O(t)+n*$(t)+i*U(t)+e*H(t),y:l*O(t)+a*$(t)+r*U(t)+s*H(t)}}getPointOnQuadraticBezier(t,e,s,i,r,n,a){return{x:n*Z(t)+i*G(t)+e*W(t),y:a*Z(t)+r*G(t)+s*W(t)}}getPointOnEllipticalArc(t,e,s,i,r,n){const a=Math.cos(n),o=Math.sin(n),l=s*Math.cos(r),h=i*Math.sin(r);return{x:t+(l*a-h*o),y:e+(l*o+h*a)}}buildEquidistantCache(t,e){const s=this.getPathLength(),i=e||.25,r=t||s/100;if(!this.equidistantCache||this.equidistantCache.step!==r||this.equidistantCache.precision!==i){this.equidistantCache={step:r,precision:i,points:[]};let t=0;for(let e=0;e<=s;e+=i){const s=this.getPointOnPath(e),n=this.getPointOnPath(e+i);s&&n&&(t+=this.getLineLength(s.x,s.y,n.x,n.y),t>=r&&(this.equidistantCache.points.push({x:s.x,y:s.y,distance:e}),t-=r))}}}getEquidistantPointOnPath(t,e,s){if(this.buildEquidistantCache(e,s),t<0||t-this.getPathLength()>5e-5)return null;const i=Math.round(t/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[i]||null}constructor(t,e,s){super(t,e,s),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);const i=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(i)}},image:class extends ft{async loadImage(t){try{const e=await this.document.createImage(t);this.image=e}catch(e){}this.loaded=!0}async loadSvg(t){const e=Dt.exec(t);if(e){const t=e[5];t&&("base64"===e[4]?this.image=atob(t):this.image=decodeURIComponent(t))}else try{const e=await this.document.fetch(t),s=await e.text();this.image=s}catch(s){}this.loaded=!0}renderChildren(t){const{document:e,image:s,loaded:i}=this,r=this.getAttribute("x").getPixels("x"),n=this.getAttribute("y").getPixels("y"),a=this.getStyle("width").getPixels("x"),o=this.getStyle("height").getPixels("y");if(i&&s&&a&&o){if(t.save(),t.translate(r,n),"string"==typeof s){const i=e.canvg.forkString(t,s,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:a,scaleHeight:o}),{documentElement:r}=i.document;r&&(r.parent=this),i.render()}else e.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:a,desiredWidth:s.width,height:o,desiredHeight:s.height}),this.loaded&&("complete"in s&&!s.complete||t.drawImage(s,0,0));t.restore()}}getBoundingBox(){const t=this.getAttribute("x").getPixels("x"),e=this.getAttribute("y").getPixels("y"),s=this.getStyle("width").getPixels("x"),i=this.getStyle("height").getPixels("y");return new gt(t,e,t+s,e+i)}constructor(t,e,s){super(t,e,s),this.type="image",this.loaded=!1;const i=this.getHrefAttribute().getString();if(!i)return;const r=i.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(i);t.images.push(this),r?this.loadSvg(i):this.loadImage(i)}},g:Pt,symbol:class extends ft{render(t){}constructor(...t){super(...t),this.type="symbol"}},style:Nt,use:class extends ft{setContext(t){super.setContext(t);const e=this.getAttribute("x"),s=this.getAttribute("y");e.hasValue()&&t.translate(e.getPixels("x"),0),s.hasValue()&&t.translate(0,s.getPixels("y"))}path(t){const{element:e}=this;e&&e.path(t)}renderChildren(t){const{document:e,element:s}=this;if(s){let i=s;if("symbol"===s.type&&(i=new kt(e),i.attributes.set("viewBox",new X(e,"viewBox",s.getAttribute("viewBox").getString())),i.attributes.set("preserveAspectRatio",new X(e,"preserveAspectRatio",s.getAttribute("preserveAspectRatio").getString())),i.attributes.set("overflow",new X(e,"overflow",s.getAttribute("overflow").getString())),i.children=s.children,s.styles.set("opacity",new X(e,"opacity",this.calculateOpacity()))),"svg"===i.type){const t=this.getStyle("width",!1,!0),s=this.getStyle("height",!1,!0);t.hasValue()&&i.attributes.set("width",new X(e,"width",t.getString())),s.hasValue()&&i.attributes.set("height",new X(e,"height",s.getString()))}const r=i.parent;i.parent=this,i.render(t),i.parent=r}}getBoundingBox(t){const{element:e}=this;return e?e.getBoundingBox(t):null}elementTransform(){const{document:t,element:e}=this;return e?ot.fromElement(t,e):null}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}constructor(...t){super(...t),this.type="use"}},mask:Vt,clipPath:class extends lt{apply(t){const{document:e}=this,s=Reflect.getPrototypeOf(t),{beginPath:i,closePath:r}=t;s&&(s.beginPath=Bt,s.closePath=Bt),Reflect.apply(i,t,[]),this.children.forEach(i=>{if(!("path"in i))return;let n="elementTransform"in i?i.elementTransform():null;n||(n=ot.fromElement(e,i)),n&&n.apply(t),i.path(t),s&&(s.closePath=r),n&&n.unapply(t)}),Reflect.apply(r,t,[]),t.clip(),s&&(s.beginPath=i,s.closePath=r)}render(t){}constructor(...t){super(...t),this.type="clipPath"}},filter:Ft,feDropShadow:class extends lt{apply(t,e,s,i,r){}constructor(t,e,s){super(t,e,s),this.type="feDropShadow",this.addStylesFromStyleDefinition()}},feMorphology:class extends lt{apply(t,e,s,i,r){}constructor(...t){super(...t),this.type="feMorphology"}},feComposite:class extends lt{apply(t,e,s,i,r){}constructor(...t){super(...t),this.type="feComposite"}},feColorMatrix:zt,feGaussianBlur:class extends lt{apply(t,e,s,i,r){const{document:n,blurRadius:a}=this,o=n.window?n.window.document.body:null,l=t.canvas;l.id=n.getUniqueId(),o&&(l.style.display="none",o.appendChild(l)),S(l,e,s,i,r,a),o&&o.removeChild(l)}constructor(t,e,s){super(t,e,s),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}},title:class extends lt{constructor(...t){super(...t),this.type="title"}},desc:class extends lt{constructor(...t){super(...t),this.type="desc"}}};class $t{bindCreateImage(t,e){return"boolean"==typeof e?(s,i)=>t(s,"boolean"==typeof i?i:e):t}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){const{emSizeStack:t}=this;return t[t.length-1]||12}set emSize(t){const{emSizeStack:e}=this;e.push(t)}popEmSize(){const{emSizeStack:t}=this;t.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(t=>t.loaded)}isFontsLoaded(){return this.fonts.every(t=>t.loaded)}createDocumentElement(t){const e=this.createElement(t.documentElement);return e.root=!0,e.addStylesFromStyleDefinition(),this.documentElement=e,e}createElement(t){const e=t.nodeName.replace(/^[^:]+:/,""),s=$t.elementTypes[e];return s?new s(this,t):new ht(this,t)}createTextNode(t){return new yt(this,t)}setViewBox(t){this.screen.setViewBox({document:this,...t})}constructor(t,{rootEmSize:e=12,emSize:s=12,createCanvas:i=$t.createCanvas,createImage:r=$t.createImage,anonymousCrossOrigin:n}={}){this.canvg=t,this.definitions=new Map,this.styles=new Map,this.stylesSpecificity=new Map,this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=t.screen,this.rootEmSize=e,this.emSize=s,this.createCanvas=i,this.createImage=this.bindCreateImage(r,n),this.screen.wait(()=>this.isImagesLoaded()),this.screen.wait(()=>this.isFontsLoaded())}}$t.createCanvas=function(t,e){const s=document.createElement("canvas");return s.width=t,s.height=e,s},$t.createImage=async function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=document.createElement("img");return e&&(s.crossOrigin="Anonymous"),new Promise((e,i)=>{s.onload=()=>{e(s)},s.onerror=(t,e,s,r,n)=>{i(n)},s.src=t})},$t.elementTypes=Ot;class Ut{static async from(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new rt(s),r=await i.parse(e);return new Ut(t,r,s)}static fromString(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new rt(s).parseFromString(e);return new Ut(t,i,s)}fork(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Ut.from(t,e,{...this.options,...s})}forkString(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Ut.fromString(t,e,{...this.options,...s})}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}async render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.start({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0,...t}),await this.ready(),this.stop()}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{documentElement:e,screen:s,options:i}=this;s.start(e,{enableRedraw:!0,...i,...t})}stop(){this.screen.stop()}resize(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.documentElement.resize(t,e,s)}constructor(t,e,s={}){this.parser=new rt(s),this.screen=new et(t,s),this.options=s;const i=new $t(this,s),r=i.createDocumentElement(e);this.document=i,this.documentElement=r}}function Ht(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Zt={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function Gt(t){Zt=t}var Wt={exec:()=>null};function Xt(t,e=""){let s="string"==typeof t?t:t.source;const i={replace:(t,e)=>{let r="string"==typeof e?e:e.source;return r=r.replace(qt.caret,"$1"),s=s.replace(t,r),i},getRegex:()=>new RegExp(s,e)};return i}var qt={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[\t ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},Yt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Qt=/(?:[*+-]|\d{1,9}[.)])/,Kt=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Jt=Xt(Kt).replace(/bull/g,Qt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),te=Xt(Kt).replace(/bull/g,Qt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),ee=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,se=/(?!\s*\])(?:\\.|[^\[\]\\])+/,ie=Xt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",se).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),re=Xt(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Qt).getRegex(),ne="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",ae=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,oe=Xt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$))","i").replace("comment",ae).replace("tag",ne).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),le=Xt(ee).replace("hr",Yt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ne).getRegex(),he={blockquote:Xt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",le).getRegex(),code:/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,def:ie,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:Yt,html:oe,lheading:Jt,list:re,newline:/^(?:[ \t]*(?:\n|$))+/,paragraph:le,table:Wt,text:/^[^\n]+/},ce=Xt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Yt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}\t)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ne).getRegex(),ue={...he,lheading:te,table:ce,paragraph:Xt(ee).replace("hr",Yt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",ce).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ne).getRegex()},de={...he,html:Xt("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",ae).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Wt,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Xt(ee).replace("hr",Yt).replace("heading"," *#{1,6} *[^\n]").replace("lheading",Jt).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},pe=/^( {2,}|\\)\n(?!\s*$)/,ge=/[\p{P}\p{S}]/u,fe=/[\s\p{P}\p{S}]/u,me=/[^\s\p{P}\p{S}]/u,xe=Xt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,fe).getRegex(),ye=/(?!~)[\p{P}\p{S}]/u,be=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,we=Xt(be,"u").replace(/punct/g,ge).getRegex(),ke=Xt(be,"u").replace(/punct/g,ye).getRegex(),Se="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",ve=Xt(Se,"gu").replace(/notPunctSpace/g,me).replace(/punctSpace/g,fe).replace(/punct/g,ge).getRegex(),Pe=Xt(Se,"gu").replace(/notPunctSpace/g,/(?:[^\s\p{P}\p{S}]|~)/u).replace(/punctSpace/g,/(?!~)[\s\p{P}\p{S}]/u).replace(/punct/g,ye).getRegex(),_e=Xt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,me).replace(/punctSpace/g,fe).replace(/punct/g,ge).getRegex(),Ce=Xt(/\\(punct)/,"gu").replace(/punct/g,ge).getRegex(),Ae=Xt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ie=Xt(ae).replace("(?:--\x3e|$)","--\x3e").getRegex(),Te=Xt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ie).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),De=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Re=Xt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",De).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ne=Xt(/^!?\[(label)\]\[(ref)\]/).replace("label",De).replace("ref",se).getRegex(),Me=Xt(/^!?\[(ref)\](?:\[\])?/).replace("ref",se).getRegex(),Le={_backpedal:Wt,anyPunctuation:Ce,autolink:Ae,blockSkip:/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,br:pe,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:Wt,emStrongLDelim:we,emStrongRDelimAst:ve,emStrongRDelimUnd:_e,escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,link:Re,nolink:Me,punctuation:xe,reflink:Ne,reflinkSearch:Xt("reflink|nolink(?!\\()","g").replace("reflink",Ne).replace("nolink",Me).getRegex(),tag:Te,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:Wt},Ee={...Le,link:Xt(/^!?\[(label)\]\((.*?)\)/).replace("label",De).getRegex(),reflink:Xt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",De).getRegex()},je={...Le,emStrongRDelimAst:Pe,emStrongLDelim:ke,url:Xt(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},ze={...je,br:Xt(pe).replace("{2,}","*").getRegex(),text:Xt(je.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Ve={normal:he,gfm:ue,pedantic:de},Be={normal:Le,gfm:je,breaks:ze,pedantic:Ee},Fe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Oe=t=>Fe[t];function $e(t,e){if(e){if(qt.escapeTest.test(t))return t.replace(qt.escapeReplace,Oe)}else if(qt.escapeTestNoEncode.test(t))return t.replace(qt.escapeReplaceNoEncode,Oe);return t}function Ue(t){try{t=encodeURI(t).replace(qt.percentDecode,"%")}catch{return null}return t}function He(t,e){var s;const i=t.replace(qt.findPipe,(t,e,s)=>{let i=!1,r=e;for(;--r>=0&&"\\"===s[r];)i=!i;return i?"|":" |"}).split(qt.splitPipe);let r=0;if(i[0].trim()||i.shift(),i.length>0&&!(null==(s=i.at(-1))?void 0:s.trim())&&i.pop(),e)if(i.length>e)i.splice(e);else for(;i.length<e;)i.push("");for(;r<i.length;r++)i[r]=i[r].trim().replace(qt.slashPipe,"|");return i}function Ze(t,e,s){const i=t.length;if(0===i)return"";let r=0;for(;r<i;){if(t.charAt(i-r-1)!==e)break;r++}return t.slice(0,i-r)}function Ge(t,e,s,i,r){const n=e.href,a=e.title||null,o=t[1].replace(r.other.outputLinkReplace,"$1");i.state.inLink=!0;const l={type:"!"===t[0].charAt(0)?"image":"link",raw:s,href:n,title:a,text:o,tokens:i.inlineTokens(o)};return i.state.inLink=!1,l}var We=class{constructor(t){s(this,"options"),s(this,"rules"),s(this,"lexer"),this.options=t||Zt}space(t){const e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){const e=this.rules.block.code.exec(t);if(e){const t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:Ze(t,"\n")}}}fences(t){const e=this.rules.block.fences.exec(t);if(e){const t=e[0],s=function(t,e,s){const i=t.match(s.other.indentCodeCompensation);if(null===i)return e;const r=i[1];return e.split("\n").map(t=>{const e=t.match(s.other.beginningSpace);if(null===e)return t;const[i]=e;return i.length>=r.length?t.slice(r.length):t}).join("\n")}(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:s}}}heading(t){const e=this.rules.block.heading.exec(t);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){const e=Ze(t,"#");this.options.pedantic?t=e.trim():e&&!this.rules.other.endingSpaceChar.test(e)||(t=e.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(t){const e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:Ze(e[0],"\n")}}blockquote(t){const e=this.rules.block.blockquote.exec(t);if(e){let t=Ze(e[0],"\n").split("\n"),s="",i="";const r=[];for(;t.length>0;){let e=!1;const n=[];let a;for(a=0;a<t.length;a++)if(this.rules.other.blockquoteStart.test(t[a]))n.push(t[a]),e=!0;else{if(e)break;n.push(t[a])}t=t.slice(a);const o=n.join("\n"),l=o.replace(this.rules.other.blockquoteSetextReplace,"\n    $1").replace(this.rules.other.blockquoteSetextReplace2,"");s=s?`${s}\n${o}`:o,i=i?`${i}\n${l}`:l;const h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(l,r,!0),this.lexer.state.top=h,0===t.length)break;const c=r.at(-1);if("code"===(null==c?void 0:c.type))break;if("blockquote"===(null==c?void 0:c.type)){const e=c,n=e.raw+"\n"+t.join("\n"),a=this.blockquote(n);r[r.length-1]=a,s=s.substring(0,s.length-e.raw.length)+a.raw,i=i.substring(0,i.length-e.text.length)+a.text;break}if("list"===(null==c?void 0:c.type)){const e=c,n=e.raw+"\n"+t.join("\n"),a=this.list(n);r[r.length-1]=a,s=s.substring(0,s.length-c.raw.length)+a.raw,i=i.substring(0,i.length-e.raw.length)+a.raw,t=n.substring(r.at(-1).raw.length).split("\n");continue}}return{type:"blockquote",raw:s,tokens:r,text:i}}}list(t){let e=this.rules.block.list.exec(t);if(e){let s=e[1].trim();const i=s.length>1,r={type:"list",raw:"",ordered:i,start:i?+s.slice(0,-1):"",loose:!1,items:[]};s=i?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=i?s:"[*+-]");const n=this.rules.other.listItemRegex(s);let a=!1;for(;t;){let s=!1,i="",o="";if(!(e=n.exec(t)))break;if(this.rules.block.hr.test(t))break;i=e[0],t=t.substring(i.length);let l=e[2].split("\n",1)[0].replace(this.rules.other.listReplaceTabs,t=>" ".repeat(3*t.length)),h=t.split("\n",1)[0],c=!l.trim(),u=0;if(this.options.pedantic?(u=2,o=l.trimStart()):c?u=e[1].length+1:(u=e[2].search(this.rules.other.nonSpaceChar),u=u>4?1:u,o=l.slice(u),u+=e[1].length),c&&this.rules.other.blankLine.test(h)&&(i+=h+"\n",t=t.substring(h.length+1),s=!0),!s){const e=this.rules.other.nextBulletRegex(u),s=this.rules.other.hrRegex(u),r=this.rules.other.fencesBeginRegex(u),n=this.rules.other.headingBeginRegex(u),a=this.rules.other.htmlBeginRegex(u);for(;t;){const d=t.split("\n",1)[0];let p;if(h=d,this.options.pedantic?(h=h.replace(this.rules.other.listReplaceNesting,"  "),p=h):p=h.replace(this.rules.other.tabCharGlobal,"    "),r.test(h))break;if(n.test(h))break;if(a.test(h))break;if(e.test(h))break;if(s.test(h))break;if(p.search(this.rules.other.nonSpaceChar)>=u||!h.trim())o+="\n"+p.slice(u);else{if(c)break;if(l.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4)break;if(r.test(l))break;if(n.test(l))break;if(s.test(l))break;o+="\n"+h}c||h.trim()||(c=!0),i+=d+"\n",t=t.substring(d.length+1),l=p.slice(u)}}r.loose||(a?r.loose=!0:this.rules.other.doubleBlankLine.test(i)&&(a=!0));let d,p=null;this.options.gfm&&(p=this.rules.other.listIsTask.exec(o),p&&(d="[ ] "!==p[0],o=o.replace(this.rules.other.listReplaceTask,""))),r.items.push({type:"list_item",raw:i,task:!!p,checked:d,loose:!1,text:o,tokens:[]}),r.raw+=i}const o=r.items.at(-1);if(!o)return;o.raw=o.raw.trimEnd(),o.text=o.text.trimEnd(),r.raw=r.raw.trimEnd();for(let t=0;t<r.items.length;t++)if(this.lexer.state.top=!1,r.items[t].tokens=this.lexer.blockTokens(r.items[t].text,[]),!r.loose){const e=r.items[t].tokens.filter(t=>"space"===t.type),s=e.length>0&&e.some(t=>this.rules.other.anyLine.test(t.raw));r.loose=s}if(r.loose)for(let t=0;t<r.items.length;t++)r.items[t].loose=!0;return r}}html(t){const e=this.rules.block.html.exec(t);if(e){return{type:"html",block:!0,raw:e[0],pre:"pre"===e[1]||"script"===e[1]||"style"===e[1],text:e[0]}}}def(t){const e=this.rules.block.def.exec(t);if(e){const t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),s=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:s,title:i}}}table(t){var e;const s=this.rules.block.table.exec(t);if(!s)return;if(!this.rules.other.tableDelimiter.test(s[2]))return;const i=He(s[1]),r=s[2].replace(this.rules.other.tableAlignChars,"").split("|"),n=(null==(e=s[3])?void 0:e.trim())?s[3].replace(this.rules.other.tableRowBlankLine,"").split("\n"):[],a={type:"table",raw:s[0],header:[],align:[],rows:[]};if(i.length===r.length){for(const t of r)this.rules.other.tableAlignRight.test(t)?a.align.push("right"):this.rules.other.tableAlignCenter.test(t)?a.align.push("center"):this.rules.other.tableAlignLeft.test(t)?a.align.push("left"):a.align.push(null);for(let t=0;t<i.length;t++)a.header.push({text:i[t],tokens:this.lexer.inline(i[t]),header:!0,align:a.align[t]});for(const t of n)a.rows.push(He(t,a.header.length).map((t,e)=>({text:t,tokens:this.lexer.inline(t),header:!1,align:a.align[e]})));return a}}lheading(t){const e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:"="===e[2].charAt(0)?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){const e=this.rules.block.paragraph.exec(t);if(e){const t="\n"===e[1].charAt(e[1].length-1)?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(t){const e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){const e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){const e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){const e=this.rules.inline.link.exec(t);if(e){const t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;const e=Ze(t.slice(0,-1),"\\");if((t.length-e.length)%2==0)return}else{const t=function(t,e){if(-1===t.indexOf(e[1]))return-1;let s=0;for(let i=0;i<t.length;i++)if("\\"===t[i])i++;else if(t[i]===e[0])s++;else if(t[i]===e[1]&&(s--,s<0))return i;return s>0?-2:-1}(e[2],"()");if(-2===t)return;if(t>-1){const s=(0===e[0].indexOf("!")?5:4)+e[1].length+t;e[2]=e[2].substring(0,t),e[0]=e[0].substring(0,s).trim(),e[3]=""}}let s=e[2],i="";if(this.options.pedantic){const t=this.rules.other.pedanticHrefTitle.exec(s);t&&(s=t[1],i=t[3])}else i=e[3]?e[3].slice(1,-1):"";return s=s.trim(),this.rules.other.startAngleBracket.test(s)&&(s=this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?s.slice(1):s.slice(1,-1)),Ge(e,{href:s?s.replace(this.rules.inline.anyPunctuation,"$1"):s,title:i?i.replace(this.rules.inline.anyPunctuation,"$1"):i},e[0],this.lexer,this.rules)}}reflink(t,e){let s;if((s=this.rules.inline.reflink.exec(t))||(s=this.rules.inline.nolink.exec(t))){const t=e[(s[2]||s[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!t){const t=s[0].charAt(0);return{type:"text",raw:t,text:t}}return Ge(s,t,s[0],this.lexer,this.rules)}}emStrong(t,e,s=""){let i=this.rules.inline.emStrongLDelim.exec(t);if(!i)return;if(i[3]&&s.match(this.rules.other.unicodeAlphaNumeric))return;if(!(i[1]||i[2]||"")||!s||this.rules.inline.punctuation.exec(s)){const s=[...i[0]].length-1;let r,n,a=s,o=0;const l="*"===i[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,e=e.slice(-1*t.length+s);null!=(i=l.exec(e));){if(r=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!r)continue;if(n=[...r].length,i[3]||i[4]){a+=n;continue}if((i[5]||i[6])&&s%3&&!((s+n)%3)){o+=n;continue}if(a-=n,a>0)continue;n=Math.min(n,n+a+o);const e=[...i[0]][0].length,l=t.slice(0,s+i.index+e+n);if(Math.min(s,n)%2){const t=l.slice(1,-1);return{type:"em",raw:l,text:t,tokens:this.lexer.inlineTokens(t)}}const h=l.slice(2,-2);return{type:"strong",raw:l,text:h,tokens:this.lexer.inlineTokens(h)}}}}codespan(t){const e=this.rules.inline.code.exec(t);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," ");const s=this.rules.other.nonSpaceChar.test(t),i=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return s&&i&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(t){const e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){const e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){const e=this.rules.inline.autolink.exec(t);if(e){let t,s;return"@"===e[2]?(t=e[1],s="mailto:"+t):(t=e[1],s=t),{type:"link",raw:e[0],text:t,href:s,tokens:[{type:"text",raw:t,text:t}]}}}url(t){var e;let s;if(s=this.rules.inline.url.exec(t)){let t,i;if("@"===s[2])t=s[0],i="mailto:"+t;else{let r;do{r=s[0],s[0]=(null==(e=this.rules.inline._backpedal.exec(s[0]))?void 0:e[0])??""}while(r!==s[0]);t=s[0],i="www."===s[1]?"http://"+s[0]:s[0]}return{type:"link",raw:s[0],text:t,href:i,tokens:[{type:"text",raw:t,text:t}]}}}inlineText(t){const e=this.rules.inline.text.exec(t);if(e){const t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}},Xe=class t{constructor(t){s(this,"tokens"),s(this,"options"),s(this,"state"),s(this,"tokenizer"),s(this,"inlineQueue"),this.tokens=[],this.tokens.links=Object.create(null),this.options=t||Zt,this.options.tokenizer=this.options.tokenizer||new We,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const e={other:qt,block:Ve.normal,inline:Be.normal};this.options.pedantic?(e.block=Ve.pedantic,e.inline=Be.pedantic):this.options.gfm&&(e.block=Ve.gfm,this.options.breaks?e.inline=Be.breaks:e.inline=Be.gfm),this.tokenizer.rules=e}static get rules(){return{block:Ve,inline:Be}}static lex(e,s){return new t(s).lex(e)}static lexInline(e,s){return new t(s).inlineTokens(e)}lex(t){t=t.replace(qt.carriageReturn,"\n"),this.blockTokens(t,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){const t=this.inlineQueue[e];this.inlineTokens(t.src,t.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,e=[],s=!1){var i,r,n;for(this.options.pedantic&&(t=t.replace(qt.tabCharGlobal,"    ").replace(qt.spaceLine,""));t;){let a;if(null==(r=null==(i=this.options.extensions)?void 0:i.block)?void 0:r.some(s=>!!(a=s.call({lexer:this},t,e))&&(t=t.substring(a.raw.length),e.push(a),!0)))continue;if(a=this.tokenizer.space(t)){t=t.substring(a.raw.length);const s=e.at(-1);1===a.raw.length&&void 0!==s?s.raw+="\n":e.push(a);continue}if(a=this.tokenizer.code(t)){t=t.substring(a.raw.length);const s=e.at(-1);"paragraph"===(null==s?void 0:s.type)||"text"===(null==s?void 0:s.type)?(s.raw+="\n"+a.raw,s.text+="\n"+a.text,this.inlineQueue.at(-1).src=s.text):e.push(a);continue}if(a=this.tokenizer.fences(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.heading(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.hr(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.blockquote(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.list(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.html(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.def(t)){t=t.substring(a.raw.length);const s=e.at(-1);"paragraph"===(null==s?void 0:s.type)||"text"===(null==s?void 0:s.type)?(s.raw+="\n"+a.raw,s.text+="\n"+a.raw,this.inlineQueue.at(-1).src=s.text):this.tokens.links[a.tag]||(this.tokens.links[a.tag]={href:a.href,title:a.title});continue}if(a=this.tokenizer.table(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.lheading(t)){t=t.substring(a.raw.length),e.push(a);continue}let o=t;if(null==(n=this.options.extensions)?void 0:n.startBlock){let e=1/0;const s=t.slice(1);let i;this.options.extensions.startBlock.forEach(t=>{i=t.call({lexer:this},s),"number"==typeof i&&i>=0&&(e=Math.min(e,i))}),e<1/0&&e>=0&&(o=t.substring(0,e+1))}if(this.state.top&&(a=this.tokenizer.paragraph(o))){const i=e.at(-1);s&&"paragraph"===(null==i?void 0:i.type)?(i.raw+="\n"+a.raw,i.text+="\n"+a.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):e.push(a),s=o.length!==t.length,t=t.substring(a.raw.length);continue}if(a=this.tokenizer.text(t)){t=t.substring(a.raw.length);const s=e.at(-1);"text"===(null==s?void 0:s.type)?(s.raw+="\n"+a.raw,s.text+="\n"+a.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=s.text):e.push(a);continue}if(t){const e="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent)break;throw new Error(e)}}return this.state.top=!0,e}inline(t,e=[]){return this.inlineQueue.push({src:t,tokens:e}),e}inlineTokens(t,e=[]){var s,i,r;let n=t,a=null;if(this.tokens.links){const t=Object.keys(this.tokens.links);if(t.length>0)for(;null!=(a=this.tokenizer.rules.inline.reflinkSearch.exec(n));)t.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(a=this.tokenizer.rules.inline.anyPunctuation.exec(n));)n=n.slice(0,a.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;null!=(a=this.tokenizer.rules.inline.blockSkip.exec(n));)n=n.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let o=!1,l="";for(;t;){let a;if(o||(l=""),o=!1,null==(i=null==(s=this.options.extensions)?void 0:s.inline)?void 0:i.some(s=>!!(a=s.call({lexer:this},t,e))&&(t=t.substring(a.raw.length),e.push(a),!0)))continue;if(a=this.tokenizer.escape(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.tag(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.link(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(a.raw.length);const s=e.at(-1);"text"===a.type&&"text"===(null==s?void 0:s.type)?(s.raw+=a.raw,s.text+=a.text):e.push(a);continue}if(a=this.tokenizer.emStrong(t,n,l)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.codespan(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.br(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.del(t)){t=t.substring(a.raw.length),e.push(a);continue}if(a=this.tokenizer.autolink(t)){t=t.substring(a.raw.length),e.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(t))){t=t.substring(a.raw.length),e.push(a);continue}let h=t;if(null==(r=this.options.extensions)?void 0:r.startInline){let e=1/0;const s=t.slice(1);let i;this.options.extensions.startInline.forEach(t=>{i=t.call({lexer:this},s),"number"==typeof i&&i>=0&&(e=Math.min(e,i))}),e<1/0&&e>=0&&(h=t.substring(0,e+1))}if(a=this.tokenizer.inlineText(h)){t=t.substring(a.raw.length),"_"!==a.raw.slice(-1)&&(l=a.raw.slice(-1)),o=!0;const s=e.at(-1);"text"===(null==s?void 0:s.type)?(s.raw+=a.raw,s.text+=a.text):e.push(a);continue}if(t){const e="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent)break;throw new Error(e)}}return e}},qe=class{constructor(t){s(this,"options"),s(this,"parser"),this.options=t||Zt}space(t){return""}code({text:t,lang:e,escaped:s}){var i;const r=null==(i=(e||"").match(qt.notSpaceStart))?void 0:i[0],n=t.replace(qt.endingNewline,"")+"\n";return r?'<pre><code class="language-'+$e(r)+'">'+(s?n:$e(n,!0))+"</code></pre>\n":"<pre><code>"+(s?n:$e(n,!0))+"</code></pre>\n"}blockquote({tokens:t}){return`<blockquote>\n${this.parser.parse(t)}</blockquote>\n`}html({text:t}){return t}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>\n`}hr(t){return"<hr>\n"}list(t){const e=t.ordered,s=t.start;let i="";for(let n=0;n<t.items.length;n++){const e=t.items[n];i+=this.listitem(e)}const r=e?"ol":"ul";return"<"+r+(e&&1!==s?' start="'+s+'"':"")+">\n"+i+"</"+r+">\n"}listitem(t){var e;let s="";if(t.task){const i=this.checkbox({checked:!!t.checked});t.loose?"paragraph"===(null==(e=t.tokens[0])?void 0:e.type)?(t.tokens[0].text=i+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&"text"===t.tokens[0].tokens[0].type&&(t.tokens[0].tokens[0].text=i+" "+$e(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:i+" ",text:i+" ",escaped:!0}):s+=i+" "}return s+=this.parser.parse(t.tokens,!!t.loose),`<li>${s}</li>\n`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>\n`}table(t){let e="",s="";for(let r=0;r<t.header.length;r++)s+=this.tablecell(t.header[r]);e+=this.tablerow({text:s});let i="";for(let r=0;r<t.rows.length;r++){const e=t.rows[r];s="";for(let t=0;t<e.length;t++)s+=this.tablecell(e[t]);i+=this.tablerow({text:s})}return i&&(i=`<tbody>${i}</tbody>`),"<table>\n<thead>\n"+e+"</thead>\n"+i+"</table>\n"}tablerow({text:t}){return`<tr>\n${t}</tr>\n`}tablecell(t){const e=this.parser.parseInline(t.tokens),s=t.header?"th":"td";return(t.align?`<${s} align="${t.align}">`:`<${s}>`)+e+`</${s}>\n`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${$e(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:s}){const i=this.parser.parseInline(s),r=Ue(t);if(null===r)return i;let n='<a href="'+(t=r)+'"';return e&&(n+=' title="'+$e(e)+'"'),n+=">"+i+"</a>",n}image({href:t,title:e,text:s,tokens:i}){i&&(s=this.parser.parseInline(i,this.parser.textRenderer));const r=Ue(t);if(null===r)return $e(s);let n=`<img src="${t=r}" alt="${s}"`;return e&&(n+=` title="${$e(e)}"`),n+=">",n}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:$e(t.text)}},Ye=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},Qe=class t{constructor(t){s(this,"options"),s(this,"renderer"),s(this,"textRenderer"),this.options=t||Zt,this.options.renderer=this.options.renderer||new qe,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Ye}static parse(e,s){return new t(s).parse(e)}static parseInline(e,s){return new t(s).parseInline(e)}parse(t,e=!0){var s,i;let r="";for(let n=0;n<t.length;n++){const a=t[n];if(null==(i=null==(s=this.options.extensions)?void 0:s.renderers)?void 0:i[a.type]){const t=a,e=this.options.extensions.renderers[t.type].call({parser:this},t);if(!1!==e||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(t.type)){r+=e||"";continue}}const o=a;switch(o.type){case"space":r+=this.renderer.space(o);continue;case"hr":r+=this.renderer.hr(o);continue;case"heading":r+=this.renderer.heading(o);continue;case"code":r+=this.renderer.code(o);continue;case"table":r+=this.renderer.table(o);continue;case"blockquote":r+=this.renderer.blockquote(o);continue;case"list":r+=this.renderer.list(o);continue;case"html":r+=this.renderer.html(o);continue;case"paragraph":r+=this.renderer.paragraph(o);continue;case"text":{let s=o,i=this.renderer.text(s);for(;n+1<t.length&&"text"===t[n+1].type;)s=t[++n],i+="\n"+this.renderer.text(s);r+=e?this.renderer.paragraph({type:"paragraph",raw:i,text:i,tokens:[{type:"text",raw:i,text:i,escaped:!0}]}):i;continue}default:{const t='Token with "'+o.type+'" type was not found.';if(this.options.silent)return"";throw new Error(t)}}}return r}parseInline(t,e=this.renderer){var s,i;let r="";for(let n=0;n<t.length;n++){const a=t[n];if(null==(i=null==(s=this.options.extensions)?void 0:s.renderers)?void 0:i[a.type]){const t=this.options.extensions.renderers[a.type].call({parser:this},a);if(!1!==t||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(a.type)){r+=t||"";continue}}const o=a;switch(o.type){case"escape":case"text":r+=e.text(o);break;case"html":r+=e.html(o);break;case"link":r+=e.link(o);break;case"image":r+=e.image(o);break;case"strong":r+=e.strong(o);break;case"em":r+=e.em(o);break;case"codespan":r+=e.codespan(o);break;case"br":r+=e.br(o);break;case"del":r+=e.del(o);break;default:{const t='Token with "'+o.type+'" type was not found.';if(this.options.silent)return"";throw new Error(t)}}}return r}},Ke=(t=class{constructor(t){s(this,"options"),s(this,"block"),this.options=t||Zt}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}provideLexer(){return this.block?Xe.lex:Xe.lexInline}provideParser(){return this.block?Qe.parse:Qe.parseInline}},s(t,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"])),t),Je=new class{constructor(...t){s(this,"defaults",{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}),s(this,"options",this.setOptions),s(this,"parse",this.parseMarkdown(!0)),s(this,"parseInline",this.parseMarkdown(!1)),s(this,"Parser",Qe),s(this,"Renderer",qe),s(this,"TextRenderer",Ye),s(this,"Lexer",Xe),s(this,"Tokenizer",We),s(this,"Hooks",Ke),this.use(...t)}walkTokens(t,e){var s,i;let r=[];for(const n of t)switch(r=r.concat(e.call(this,n)),n.type){case"table":{const t=n;for(const s of t.header)r=r.concat(this.walkTokens(s.tokens,e));for(const s of t.rows)for(const t of s)r=r.concat(this.walkTokens(t.tokens,e));break}case"list":{const t=n;r=r.concat(this.walkTokens(t.items,e));break}default:{const t=n;(null==(i=null==(s=this.defaults.extensions)?void 0:s.childTokens)?void 0:i[t.type])?this.defaults.extensions.childTokens[t.type].forEach(s=>{const i=t[s].flat(1/0);r=r.concat(this.walkTokens(i,e))}):t.tokens&&(r=r.concat(this.walkTokens(t.tokens,e)))}}return r}use(...t){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(t=>{const s={...t};if(s.async=this.defaults.async||s.async||!1,t.extensions&&(t.extensions.forEach(t=>{if(!t.name)throw new Error("extension name required");if("renderer"in t){const s=e.renderers[t.name];e.renderers[t.name]=s?function(...e){let i=t.renderer.apply(this,e);return!1===i&&(i=s.apply(this,e)),i}:t.renderer}if("tokenizer"in t){if(!t.level||"block"!==t.level&&"inline"!==t.level)throw new Error("extension level must be 'block' or 'inline'");const s=e[t.level];s?s.unshift(t.tokenizer):e[t.level]=[t.tokenizer],t.start&&("block"===t.level?e.startBlock?e.startBlock.push(t.start):e.startBlock=[t.start]:"inline"===t.level&&(e.startInline?e.startInline.push(t.start):e.startInline=[t.start]))}"childTokens"in t&&t.childTokens&&(e.childTokens[t.name]=t.childTokens)}),s.extensions=e),t.renderer){const e=this.defaults.renderer||new qe(this.defaults);for(const s in t.renderer){if(!(s in e))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;const i=s,r=t.renderer[i],n=e[i];e[i]=(...t)=>{let s=r.apply(e,t);return!1===s&&(s=n.apply(e,t)),s||""}}s.renderer=e}if(t.tokenizer){const e=this.defaults.tokenizer||new We(this.defaults);for(const s in t.tokenizer){if(!(s in e))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;const i=s,r=t.tokenizer[i],n=e[i];e[i]=(...t)=>{let s=r.apply(e,t);return!1===s&&(s=n.apply(e,t)),s}}s.tokenizer=e}if(t.hooks){const e=this.defaults.hooks||new Ke;for(const s in t.hooks){if(!(s in e))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;const i=s,r=t.hooks[i],n=e[i];Ke.passThroughHooks.has(s)?e[i]=t=>{if(this.defaults.async)return Promise.resolve(r.call(e,t)).then(t=>n.call(e,t));const s=r.call(e,t);return n.call(e,s)}:e[i]=(...t)=>{let s=r.apply(e,t);return!1===s&&(s=n.apply(e,t)),s}}s.hooks=e}if(t.walkTokens){const e=this.defaults.walkTokens,i=t.walkTokens;s.walkTokens=function(t){let s=[];return s.push(i.call(this,t)),e&&(s=s.concat(e.call(this,t))),s}}this.defaults={...this.defaults,...s}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Xe.lex(t,e??this.defaults)}parser(t,e){return Qe.parse(t,e??this.defaults)}parseMarkdown(t){return(e,s)=>{const i={...s},r={...this.defaults,...i},n=this.onError(!!r.silent,!!r.async);if(!0===this.defaults.async&&!1===i.async)return n(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(null==e)return n(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof e)return n(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));r.hooks&&(r.hooks.options=r,r.hooks.block=t);const a=r.hooks?r.hooks.provideLexer():t?Xe.lex:Xe.lexInline,o=r.hooks?r.hooks.provideParser():t?Qe.parse:Qe.parseInline;if(r.async)return Promise.resolve(r.hooks?r.hooks.preprocess(e):e).then(t=>a(t,r)).then(t=>r.hooks?r.hooks.processAllTokens(t):t).then(t=>r.walkTokens?Promise.all(this.walkTokens(t,r.walkTokens)).then(()=>t):t).then(t=>o(t,r)).then(t=>r.hooks?r.hooks.postprocess(t):t).catch(n);try{r.hooks&&(e=r.hooks.preprocess(e));let t=a(e,r);r.hooks&&(t=r.hooks.processAllTokens(t)),r.walkTokens&&this.walkTokens(t,r.walkTokens);let s=o(t,r);return r.hooks&&(s=r.hooks.postprocess(s)),s}catch(l){return n(l)}}}onError(t,e){return s=>{if(s.message+="\nPlease report this to https://github.com/markedjs/marked.",t){const t="<p>An error occurred:</p><pre>"+$e(s.message+"",!0)+"</pre>";return e?Promise.resolve(t):t}if(e)return Promise.reject(s);throw s}}};function ts(t,e){return Je.parse(t,e)}ts.options=ts.setOptions=function(t){return Je.setOptions(t),ts.defaults=Je.defaults,Gt(ts.defaults),ts},ts.getDefaults=Ht,ts.defaults=Zt,ts.use=function(...t){return Je.use(...t),ts.defaults=Je.defaults,Gt(ts.defaults),ts},ts.walkTokens=function(t,e){return Je.walkTokens(t,e)},ts.parseInline=Je.parseInline,ts.Parser=Qe,ts.parser=Qe.parse,ts.Renderer=qe,ts.TextRenderer=Ye,ts.Lexer=Xe,ts.lexer=Xe.lex,ts.Tokenizer=We,ts.Hooks=Ke,ts.parse=ts,ts.options,ts.setOptions,ts.use,ts.walkTokens,ts.parseInline,Qe.parse,Xe.lex;var es=Object.defineProperty,ss=(t,e,s)=>(((t,e,s)=>{e in t?es(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s})(t,e+"",s),s);const is=function(t){return t+1&-2},rs=function(t){return(t+4&-4)-1},ns=function(t,e,s){return Math.min(Math.max(t,e),s)};let as={};const os={setColorConverters:function(t){Object.assign(as,t)},rgbToRgb(t,e,s){if(as.rgbToRgb){return as.rgbToRgb([t,e,s])}return[t,e,s]},cmykToRgb:function(t,e,s,i){if(as&&as.cmykToRgb)return as.cmykToRgb([t,e,s,i]);return[ns(65535-(t*(255-i)+(i<<8))>>8,0,255),ns(65535-(e*(255-i)+(i<<8))>>8,0,255),ns(65535-(s*(255-i)+(i<<8))>>8,0,255)]}},ls=new TextDecoder("utf-16be");let hs=class{constructor(t){this.data=t,this.dataView=new DataView(t.buffer),this.pos=0}tell(){return this.pos}read(t){const e=this.pos;return this.pos+=t,this.data.subarray(e,this.pos)}seek(t,e=!1){this.pos=e?this.pos+t:t}readString(t){return String.fromCharCode.apply(null,this.read(t)).replace(/\u0000/g,"")}readUnicodeString(t=null){return t||(t=this.readInt()),ls.decode(this.read(2*t)).replace(/\u0000/g,"")}readByte(){return this.read(1)[0]}readBoolean(){return 0!==this.readByte()}readSpaceColor(){let t;const e=this.readShort();for(let s=0;s<4;s++)t=this.readShort()>>8;return{colorSpace:e,components:t}}readPathNumber(){const t=this.readByte(),e=this.read(3),s=e[0]<<16|e[1]<<8|e[2];return parseFloat(t,10)+parseFloat(s/Math.pow(2,24),10)}readInt(){const t=this.dataView.getInt32(this.pos);return this.pos+=4,t}readUInt(){const t=this.dataView.getUint32(this.pos);return this.pos+=4,t}readShort(){const t=this.dataView.getInt16(this.pos);return this.pos+=2,t}readUShort(){const t=this.dataView.getUint16(this.pos);return this.pos+=2,t}readFloat(){const t=this.dataView.getFloat32(this.pos);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos);return this.pos+=8,t}readLongLong(){const t=this.read(8);let e=0;for(let s=0;s<8;s++){const i=7-s;e+=t[s]*Math.pow(256,i)}return e}};const cs=["Bitmap","GrayScale","IndexedColor","RGBColor","CMYKColor","HSLColor","HSBColor","Multichannel","Duotone","LabColor","Gray16","RGB48","Lab48","CMYK64","DeepMultichannel","Duotone16"];class us{constructor(t){this.file=t,this.sig=null,this.version=null,this.channels=null,this.height=null,this.width=null,this.depth=null,this.mode=null}parse(){if(this.sig=this.file.readString(4),"8BPS"!==this.sig)throw new Error("Invalid file signature detected. Got: "+this.sig+". Expected 8BPS.");this.version=this.file.readUShort(),this.file.seek(6,!0),this.channels=this.file.readUShort(),this.height=this.file.readUInt(),this.width=this.file.readUInt(),this.depth=this.file.readUShort(),this.mode=this.file.readUShort();const t=this.file.readUInt();this.file.seek(t,!0)}get rows(){return this.height}get cols(){return this.height}modeName(){return cs[this.mode]}export(){const t={},e=["sig","version","channels","height","width","depth","mode"],s=e.length;for(let i=0;i<s;i++){const s=e[i];t[s]=this[s]}return t}}const ds={toBase64(){const t=document.createElement("canvas");t.width=this.width(),t.height=this.height();const e=t.getContext("2d",{willReadFrequently:!0}),s=e.getImageData(0,0,this.width(),this.height()),i=s.data,r=this.pixelData.length;for(let n=0;n<r;n++)i[n]=this.pixelData[n];return e.putImageData(s,0,0),t.toDataURL("image/png")},toPng(){const t=this.toBase64(),e=new Image;return e.width=this.width(),e.height=this.height(),e.src=t,e},saveAsPng(){throw"Not available in the browser. Use toPng() instead."}};let ps=class{constructor(t,e,s){if(this.file=t,this.header=e,s&&(this.layer=s,this._width=s.width,this._height=s.height,this.width=function(){return this._width},this.height=function(){return this._height}),this.numPixels=this.width()*this.height(),16===this.depth()&&(this.numPixels*=2),this.calculateLength(),this.pixelData=new Uint8Array(4*this.channelLength),this.layer&&this.layer.mask.size){const t=this.header.width,e=this.header.height,s=this.layer.mask,i=6e6,r=(Math.min(s.right,t)-Math.max(s.left,0))*(Math.min(s.bottom,e)-Math.max(s.top,0));this.maskLength>i&&r/this.maskLength<.5?(s.width=t,s.height=e,s.isSingleChannel=!0,this.maskData=new Uint8Array(t*e)):this.maskData=new Uint8Array(4*this.maskLength)}this.channelData=new Uint8Array(this.length+this.maskLength),this.opacity=1,this.hasMask=!1,this.startPos=this.file.tell(),this.endPos=this.startPos+this.length,this.setChannelsInfo()}setChannelsInfo(){switch(this.mode()){case 1:return this.setGreyscaleChannels();case 3:return this.setRgbChannels();case 4:return this.setCmykChannels()}}_calcAreaByDepth(t){switch(t){case 1:return(this.width()+7)/8*this.height();case 16:return this.width()*this.height()*2;default:return this.width()*this.height()}}calculateLength(){var t,e,s,i;if(this.length=this._calcAreaByDepth(this.depth()),this.channelLength=this.length,this.length*=this.channels(),this.maskLength=0,(null==(e=null==(t=this.layer)?void 0:t.mask)?void 0:e.size)&&(this.maskLength+=this.layer.mask.width*this.layer.mask.height),null==(i=null==(s=this.layer)?void 0:s.mask)?void 0:i.vmask){const{width:t,height:e}=this.layer.mask.vmask;this.maskLength+=t*e}}parse(){this.compression=this.parseCompression(),2!==this.compression&&3!==this.compression?this.parseImageData():this.file.seek(this.endPos)}parseCompression(){return this.file.readShort()}parseImageData(){switch(this.compression){case 0:this.parseRaw();break;case 1:this.parseRLE();break;case 2:case 3:this.parseZip();break;default:this.file.seek(this.endPos)}this.processImageData()}processImageData(){switch(this.mode()){case 1:this.combineGreyscaleChannel();break;case 3:this.combineRgbChannel();break;case 4:this.combineCmykChannel()}this.channelData=null}parseRaw(){this.channelData.set(this.file.read(this.length))}parseRLE(){this.byteCounts=this.parseByteCounts(),this.parseChannelData()}parseByteCounts(){const t=this.channels()*this.height(),e=[];for(let s=0;s<t;s++)1===this.header.version?e.push(this.file.readShort()):e.push(this.file.readInt());return e}parseChannelData(){this.chanPos=0,this.lineIndex=0;const t=this.channels();for(let e=0;e<t;e++)this.decodeRLEChannel(),this.lineIndex+=this.height()}decodeRLEChannel(){const t=this.height();for(let e=0;e<t;e++){const t=this.byteCounts[this.lineIndex+e],s=this.file.tell()+t;for(;this.file.tell()<s;){let t=this.file.read(1)[0];if(t<128){t+=1;const e=this.file.read(t);this.channelData.set(e,this.chanPos),this.chanPos+=t}else if(t>128){t^=255,t+=2;const e=this.file.read(1)[0];this.channelData.fill(e,this.chanPos,this.chanPos+t),this.chanPos+=t}}}}setGreyscaleChannels(){if(this.channelsInfo=[{id:0}],2===this.channels())return this.channelsInfo.push({id:-1})}combineGreyscaleChannel(){for(let t=0;t<this.numPixels;t++){const e=this.channelData[t],s=2===this.channels()?this.channelData[this.channelLength+t]:25;this.pixelData.set([e,e,e,s],4*t)}}setRgbChannels(){if(this.channelsInfo=[{id:0},{id:1},{id:2}],4===this.channels())return this.channelsInfo.push({id:-1})}combineRgbChannel(){const t=this.channelsInfo.map(t=>t.id).filter(t=>t>=-1);for(let e=0;e<this.numPixels;e++){let s=0,i=0,r=0,n=255;const a=t.length;for(let c=0;c<a;c++){const a=t[c],o=this.channelData[e+this.channelLength*c];switch(a){case-1:n=o;break;case 0:s=o;break;case 1:i=o;break;case 2:r=o}}const[o,l,h]=os.rgbToRgb(s,i,r);this.pixelData.set([o,l,h,n],4*e)}return this.readMaskData(t)}readMaskData(t){if(this.hasMask){let e;const s=this.layer.mask.width*this.layer.mask.height,i=this.channelLength*t.length;if(this.layer.mask.isSingleChannel)return e=new Uint8Array(this.channelData.buffer,i,s),void this.maskData.set(e);let r=0;for(;r<s;)e=this.channelData[r+i],this.maskData.set([0,0,0,e],4*r),r++}}setCmykChannels(){if(this.channelsInfo=[{id:0},{id:1},{id:2},{id:3}],5===this.channels())return this.channelsInfo.push({id:-1})}combineCmykChannel(){const t=this.channelsInfo.map(t=>t.id).filter(t=>t>=-1);for(let e=0;e<this.numPixels;e++){let s=0,i=0,r=0,n=0,a=255;const o=t.length;for(let u=0;u<o;u++){const o=t[u],l=this.channelData[e+this.channelLength*u];switch(o){case-1:a=l;break;case 0:s=l;break;case 1:i=l;break;case 2:r=l;break;case 3:n=l}}const[l,h,c]=os.cmykToRgb(255-s,255-i,255-r,255-n);this.pixelData.set([l,h,c,a],4*e)}this.readMaskData(t)}width(){return this.header.width}height(){return this.header.height}channels(){return this.header.channels}depth(){return this.header.depth}mode(){return this.header.mode}};var gs,fs;gs=ps,fs=ds,Object.keys(fs).forEach(t=>{gs.prototype[t]=fs[t]});class ms{constructor(t,e){this.obj=t,this.file=e,this.startPos=this.file.tell(),this.loaded=!1,this.loadMethod=null,this.loadArgs=[],this.passthru=[]}now(t,...e){return this.obj[t].apply(this.obj,e),this}later(t,...e){return this.loadMethod=t,this.loadArgs=e,this}ignore(...t){return this.passthru.concat(t),this}get(){const t=function(t){const e=new Set;for(;t&&t.constructor!==Object;){const s=Reflect.ownKeys(t);for(const t of s)e.add(t);t=Reflect.getPrototypeOf(t)}return[...e]}(this.obj);for(const e of t)this[e]||Object.defineProperty(this,e,{get:function(){return this.loaded||this.passthru.includes(e)||this.load(),this.obj[e]}});return this}load(){const t=this.file.tell();this.file.seek(this.startPos),this.obj[this.loadMethod].apply(this.obj,this.loadArgs),this.file.seek(t),this.loaded=!0}}class xs{constructor(t){this.file=t,this.data={}}parse(){this.data.class=this.parseClass();const t=this.file.readInt();for(let e=0;e<t;e++){const[t,e]=this.parseKeyItem();this.data[t]=e}return this.data}parseClass(){return{name:this.file.readUnicodeString(),id:this.parseId()}}parseId(){const t=this.file.readInt();return 0===t?this.file.readString(4):this.file.readString(t)}parseKeyItem(){return[this.parseId(),this.parseItem()]}parseItem(t=null){switch(null==t&&(t=this.file.readString(4)),t){case"bool":case"uglg":return this.parseBoolean();case"type":case"GlbC":return this.parseClass();case"Objc":case"GlbO":return new xs(this.file).parse();case"doub":return this.parseDouble();case"enum":return this.parseEnum();case"alis":return this.parseAlias();case"Pth":return this.parseFilePath();case"long":return this.parseInteger();case"comp":return this.parseLargeInteger();case"VlLs":return this.parseList();case"ObAr":return this.parseObjectArray();case"tdta":return this.parseRawData();case"obj ":return this.parseReference();case"TEXT":return this.file.readUnicodeString();case"UntF":return this.parseUnitDouble();case"UnFl":return this.parseUnitFloat()}}parseBoolean(){return this.file.readBoolean()}parseDouble(){return this.file.readDouble()}parseInteger(){return this.file.readInt()}parseLargeInteger(){return this.file.readLongLong()}parseIdentifier(){return this.file.readInt()}parseIndex(){return this.file.readInt()}parseOffset(){return this.file.readInt()}parseProperty(){return{class:this.parseClass(),id:this.parseId()}}parseEnum(){return{type:this.parseId(),value:this.parseId()}}parseEnumReference(){return{class:this.parseClass(),type:this.parseId(),value:this.parseId()}}parseAlias(){const t=this.file.readInt();return this.file.readString(t)}parseFilePath(){this.file.readInt();const t=this.file.readString(4);this.file.read("<i");const e=this.file.read("<i");return{sig:t,path:this.file.readUnicodeString(e)}}parseList(){const t=this.file.readInt(),e=[];for(let s=0;s<t;s++)e.push(this.parseItem());return e}parseObjectArray(){throw`Descriptor object array not implemented yet @ ${this.file.tell()}`}parseRawData(){const t=this.file.readInt();return this.file.read(t)}_getReferenceValue(t){switch(t){case"prop":return this.parseProperty();case"Clss":return this.parseClass();case"Enmr":return this.parseEnumReference();case"Idnt":return this.parseIdentifier();case"indx":return this.parseIndex();case"name":return this.file.readUnicodeString();case"rele":return this.parseOffset()}}parseReference(){const t=this.file.readInt(),e=[];for(let s=0;s<t;s++){const t=this.file.readString(4),s=this._getReferenceValue(t);e.push({type:t,value:s})}return e}parseUnitDouble(){const t=this.file.readString(4),e=function(){switch(t){case"#Ang":return"Angle";case"#Rsl":return"Density";case"#Rlt":return"Distance";case"#Nne":return"None";case"#Prc":return"Percent";case"#Pxl":return"Pixels";case"#Mlm":return"Millimeters";case"#Pnt":return"Points"}}(),s=this.file.readDouble();return{id:t,unit:e,value:s}}parseUnitFloat(){const t=this.file.readString(4),e=function(){switch(t){case"#Ang":return"Angle";case"#Rsl":return"Density";case"#Rlt":return"Distance";case"#Nne":return"None";case"#Prc":return"Percent";case"#Pxl":return"Pixels";case"#Mlm":return"Millimeters";case"#Pnt":return"Points"}}(),s=this.file.readFloat();return{id:t,unit:e,value:s}}}class ys{constructor(t,e){this.layer=t,this.length=e,this.file=t.file,this.section_end=this.file.tell()+e,this.data={}}skip(){this.file.seek(this.section_end)}parse(){this.skip()}}const bs=new TextDecoder("utf-16be"),ws=[function(t){return{match:Cs(/^<<$/,t),parse:function(){As({})}}},function(t){return{match:Cs(/^>>$/,t),parse:function(){Is()}}},function(t){const e=/^\/(\w+) \[$/;return{match:Cs(e,t),parse:function(){Ss.push(t.match(e)[1]),As([])}}},function(t){return{match:Cs(/^]$/,t),parse:function(){Is()}}},function(t){const e=/^\/([_A-Z0-9]+)$/i;return{match:Cs(e,t),parse:function(){Ss.push(t.match(e)[1])}}},function(t){const e=/^\/([_A-Z0-9]+)\s((.|\r)*)$/i;return{match:Cs(e,t),parse:function(){const s=t.match(e);var i,r;i=s[1],r=_s(s[2]),vs[i]=r}}},function(t){const e=/^\[(.*)\]$/;return{match:Cs(e,t),parse:function(){const s=t.match(e)[1].trim().split(" "),i=[],r=s.length;for(let t=0;t<r;t++)i.push(_s(s[t]));return i}}},function(t){return{match:Cs(/^(true|false)$/,t),parse:function(){return"true"===t}}},function(t){return{match:Cs(/^-?\d+$/,t),parse:function(){return Number(t)}}},function(t){return{match:Cs(/^(-?\d*)\.(\d+)$/,t),parse:function(){return Number(t)}}},function(t){const e=/^\(((.|\r)*)\)$/;return{match:Cs(e,t),parse:function(){const s=t.match(e)[1],i=[],r=s.length;for(let t=0;t<r;t++)i.push(s.charCodeAt(t));return bs.decode(new Uint8Array(i))}}}];let ks=[],Ss=[],vs=[];const Ps=function(t){var e;return ks=Ss=vs=[],e=function(t){return String.fromCharCode.apply(null,t)}(t),e.split("\n").map(function(t){_s(t.replace(/^\t+/g,""))}),vs.shift()};function _s(t){for(const e in ws){const s=new ws[e](t);if(s.match)return s.parse()}return t}function Cs(t,e){return t.test(e)}function As(t){ks.push(vs),vs=t}function Is(){const t=ks.pop();var e;e=t,"[object Array]"===Object.prototype.toString.call(e)?t.push(vs):t[Ss.pop()]=vs,vs=t}let Ts,Ds;class Rs extends ys{static shouldParse(t){return"TySh"===t}constructor(t,e){super(t,e),this.version=null,this.transform={},this.textVersion=null,this.descriptorVersion=null,this.textData=null,this.engineData=null,this.textValue=null,this.warpVersion=null,this.descriptorVersion=null,this.warpData=null,this.coords={}}parse(){this.version=this.file.readShort(),this.parseTransformInfo(),this.textVersion=this.file.readShort(),this.descriptorVersion=this.file.readInt(),this.textData=new xs(this.file).parse(),this.textValue=this.textData["Txt "],this.engineData=Ps(this.textData.EngineData),this.warpVersion=this.file.readShort(),this.descriptorVersion=this.file.readInt(),this.warpData=new xs(this.file).parse();const t=Ts.length;for(let e=0;e<t;e++){const t=Ts[e];this.coords[t]=this.file.readInt()}}parseTransformInfo(){const t=Ds.length;for(let e=0;e<t;e++){const t=Ds[e];this.transform[t]=this.file.readDouble()}}fonts(){return null==this.engineData?[]:this.engineData.ResourceDict.FontSet.map(function(t){return t.Name})}lengthArray(){const t=this.engineData.EngineDict.StyleRun.RunLengthArray;return t.reduce((t,e)=>t+e)-this.textValue.length===1&&(t[t.length-1]=t[t.length-1]-1),t}fontStyles(){return this.engineData.EngineDict.StyleRun.RunArray.map(function(t){return t.StyleSheet.StyleSheetData}).map(function(t){let e;return e=t.FauxItalic?"italic":"normal",e})}fontWeights(){return this.engineData.EngineDict.StyleRun.RunArray.map(function(t){return t.StyleSheet.StyleSheetData}).map(function(t){let e;return e=t.FauxBold?"bold":"normal",e})}textDecoration(){return this.engineData.EngineDict.StyleRun.RunArray.map(function(t){return t.StyleSheet.StyleSheetData}).map(function(t){let e;return e=t.Underline?"underline":"none",e})}leading(){return this.engineData.EngineDict.StyleRun.RunArray.map(function(t){return t.StyleSheet.StyleSheetData}).map(function(t){let e;return e=t.Leading?t.Leading:"auto",e})}sizes(){return null==this.engineData&&null==this.styles().FontSize?[]:this.styles().FontSize}alignment(){if(null==this.engineData)return[];const t=["left","right","center","justify"];return this.engineData.EngineDict.ParagraphRun.RunArray.map(function(e){return t[Math.min(parseInt(e.ParagraphSheet.Properties.Justification,10),3)]})}colors(){return null==this.engineData||null==this.styles().FillColor?[[0,0,0,255]]:this.styles().FillColor.map(function(t){const e=t.Values.map(function(t){return Math.round(255*t)});return e.push(e.shift()),e})}fillTypes(){return this.styles().FillColor?this.styles().FillColor.map(function(t){return t.Type}):1}styles(){if(null==this.engineData)return{};if(null!=this._styles)return this._styles;const t=this.engineData.EngineDict.StyleRun.RunArray.map(function(t){return t.StyleSheet.StyleSheetData});return this._styles=t.reduce(function(t,e){for(const s in e){if(!e.hasOwnProperty(s))continue;const i=e[s];t[s]||(t[s]=[]),t[s].push(i)}return t},{})}toCSS(){const t={"font-family":this.fonts().join(", "),"font-size":`${this.sizes()[0]}pt`,color:`rgba(${this.colors()[0].join(", ")})`,"text-align":this.alignment()[0]},e=[];for(const s in t){const i=t[s];null!=i&&e.push(`${s}: ${i};`)}return e.join("\n")}export(){return{value:this.textValue,font:{lengthArray:this.lengthArray(),styles:this.fontStyles(),weights:this.fontWeights(),names:this.fonts(),sizes:this.sizes(),colors:this.colors(),alignment:this.alignment(),textDecoration:this.textDecoration(),leading:this.leading()},left:this.coords.left,top:this.coords.top,right:this.coords.right,bottom:this.coords.bottom,transform:this.transform}}}Ds=["xx","xy","yx","yy","tx","ty"],Ts=["left","top","right","bottom"];const Ns=["other","open folder","closed folder","bounding section divider"];class Ms{constructor(t){this.file=t,this.recordType=null}parse(){switch(this.recordType=this.file.readShort(),this.recordType){case 0:case 3:this._readPathRecord();break;case 1:case 2:case 4:case 5:this._readBezierPoint();break;case 7:this._readClipboardRecord();break;case 8:this._readInitialFill();break;default:this.file.seek(24,!0)}}export(){const t=(()=>{switch(this.recordType){case 0:case 3:return{numPoints:this.numPoints,operation:this.operation};case 1:case 2:case 4:case 5:return{linked:this.linked,closed:1===this.recordType||2===this.recordType,preceding:{vert:this.precedingVert,horiz:this.precedingHoriz},anchor:{vert:this.anchorVert,horiz:this.anchorHoriz},leaving:{vert:this.leavingVert,horiz:this.leavingHoriz}};case 7:return{clipboard:{top:this.clipboardTop,left:this.clipboardLeft,bottom:this.clipboardBottom,right:this.clipboardRight,resolution:this.clipboardResolution}};case 8:return{initialFill:this.initialFill};default:return{}}})();return t.recordType=this.recordType,t}isBezierPoint(){const t=this.recordType;return 1===t||2===t||4===t||5===t}_readPathRecord(){this.numPoints=this.file.readShort(),this.operation=this.file.readShort(),this.file.seek(20,!0)}_readBezierPoint(){const t=this.recordType;this.linked=1===t||4===t,this.precedingVert=this.file.readPathNumber(),this.precedingHoriz=this.file.readPathNumber(),this.anchorVert=this.file.readPathNumber(),this.anchorHoriz=this.file.readPathNumber(),this.leavingVert=this.file.readPathNumber(),this.leavingHoriz=this.file.readPathNumber()}_readClipboardRecord(){this.clipboardTop=this.file.readPathNumber(),this.clipboardLeft=this.file.readPathNumber(),this.clipboardBottom=this.file.readPathNumber(),this.clipboardRight=this.file.readPathNumber(),this.clipboardResolution=this.file.readPathNumber(),this.file.seek(4,!0)}_readInitialFill(){this.initialFill=this.file.readShort(),this.file.seek(22,!0)}}class Ls extends ys{static shouldParse(t){return"lnk2"===t}constructor(t,e){super(t,e)}parse(){const t=this.file.tell()+this.length;for(this.files=[];this.file.tell()<t;){const t={};this.file.seek(4,!0);const e=1+rs(this.file.readInt())+this.file.tell(),s=this.file.readString(4),i=this.file.readInt();t.uuid=this.file.readString(this.file.readByte()),t.fileName=this.file.readUnicodeString(),t.fileType=this.file.readString(4),t.creator=this.file.readString(4),this.file.seek(4,!0),t.datasize=this.file.readInt(),t.openFile=this.file.readBoolean(),!0===t.openFile&&(this.file.seek(4,!0),t.openFile=new xs(this.file).parse()),"liFD"===s&&(t.fileData=this.file.read(t.datasize)),i>=5&&(t.childId=this.file.readUnicodeString()),i>=6&&(t.modTime=this.file.readDouble()),i>=7&&(t.lockedState=this.file.readBoolean()),this.files.push(t),this.file.seek(e)}return this.file.seek(t),this.files}}const Es={artboard:class extends ys{static shouldParse(t){return"artb"===t}parse(){return this.file.seek(4,!0),this.data=new xs(this.file).parse(),this.data}export(){return{coords:{left:this.data.artboardRect.Left,top:this.data.artboardRect["Top "],right:this.data.artboardRect.Rght,bottom:this.data.artboardRect.Btom}}}},blendClippingElements:class extends ys{static shouldParse(t){return"clbl"===t}parse(){this.enabled=this.file.readBoolean(),this.file.seek(3,!0)}},blendInteriorElements:class extends ys{static shouldParse(t){return"infx"===t}parse(){this.enabled=this.file.readBoolean(),this.file.seek(3,!0)}},fillOpacity:class extends ys{static shouldParse(t){return"iOpa"===t}parse(){const t=this.file.readByte(),e=Math.round(100*t/255);this.data.opacity=e,this.data.unit="Percent"}},gradientFill:class extends ys{static shouldParse(t){return"GdFl"===t}parse(){return this.file.seek(4,!0),this.data=new xs(this.file).parse(),this.data}},layerId:class extends ys{constructor(t,e){super(t,e),this.pos=this.file.tell()}static shouldParse(t){return"lyid"===t}parse(){const t=this.file.tell();return this.file.seek(this.pos),this.id=this.file.readInt(),this.file.seek(t),this.id}},layerNameSource:class extends ys{static shouldParse(t){return"lnsr"===t}parse(){return this.id=this.file.readString(4),this.id}},legacyTypetool:class extends Rs{static shouldParse(t){return"tySh"===t}constructor(t,e){super(t,e),this.transform={},this.faces=[],this.styles=[],this.lines=[],this.type=0,this.scalingFactor=0,this.characterCount=0,this.horzPlace=0,this.vertPlace=0,this.selectStart=0,this.selectEnd=0,this.color=null,this.antialias=null}parse(){this.file.seek(2,!0),this.parseTransformInfo(),this.file.seek(2,!0);const t=this.file.readShort();for(let i=0;i<t;i++){const t={};t.mark=this.file.readShort(),t.fontType=this.file.readInt(),t.fontName=this.file.readString(this.file.readByte()),t.fontFamilyName=this.file.readString(this.file.readByte()),t.fontStyleName=this.file.readString(this.file.readByte()),t.script=this.file.readShort(),t.numberAxesVector=this.file.readInt(),t.vector=[];for(let e=0;e<t.numberAxesVector;e++)t.vector.push(this.file.readInt());this.faces.push(t)}const e=this.file.readShort();for(let i=0;i<e;i++){const t={};t.mark=this.file.readShort(),t.faceMark=this.file.readShort(),t.size=this.file.readInt(),t.tracking=this.file.readInt(),t.kerning=this.file.readInt(),t.leading=this.file.readInt(),t.baseShift=this.file.readInt(),t.autoKern=this.file.readBoolean(),this.file.seek(1,!0),t.rotate=this.file.readBoolean(),this.styles.push(t)}this.type=this.file.readShort(),this.scalingFactor=this.file.readInt(),this.characterCount=this.file.readInt(),this.horzPlace=this.file.readInt(),this.vertPlace=this.file.readInt(),this.selectStart=this.file.readInt(),this.selectEnd=this.file.readInt();const s=this.file.readShort();for(let i=0;i<s;i++){const t={};t.charCount=this.file.readInt(),t.orientation=this.file.readShort(),t.alignment=this.file.readShort(),t.actualChar=this.file.readShort(),t.style=this.file.readShort(),this.lines.push(t)}this.color=this.file.readSpaceColor(),this.antialias=this.file.readBoolean()}},locked:class extends ys{static shouldParse(t){return"lspf"===t}constructor(t,e){super(t,e),this.transparencyLocked=!1,this.compositeLocked=!1,this.positionLocked=!1,this.allLocked=!1}parse(){const t=this.file.readInt();this.transparencyLocked=(1&t)>0||-2147483648===t,this.compositeLocked=(2&t)>0||-2147483648===t,this.positionLocked=(4&t)>0||-2147483648===t,this.allLocked=this.transparencyLocked&&this.compositeLocked&&this.positionLocked}},metadata:class extends ys{static shouldParse(t){return"shmd"===t}parse(){this.data={};const t=this.file.readInt();for(let e=0;e<t;e++){this.file.seek(4,!0);const t=this.file.readString(4);this.file.readByte(),this.file.seek(3,!0);const e=this.file.readInt(),s=this.file.tell()+e;if(["cust","cmls","extn","mlst","tmln"].includes(t)){let e=this.file.readInt();16!==e&&(e=this.file.readInt()),16===e&&(this.data[t]=new xs(this.file).parse())}this.file.seek(s)}}},name:class extends ys{static shouldParse(t){return"luni"===t}parse(){const t=this.file.tell();return this.data=this.file.readUnicodeString(),this.file.seek(t+this.length),this}},nestedSectionDivider:class extends ys{static shouldParse(t){return"lsdk"===t}constructor(t,e){super(t,e),this.isFolder=!1,this.isHidden=!1}parse(){switch(this.file.readInt()){case 1:case 2:return this.isFolder=!0;case 3:return this.isHidden=!0}}},objectEffects:class extends ys{static shouldParse(t){return"lfx2"===t||"lmfx"===t}parse(){return this.file.seek(8,!0),this.data=new xs(this.file).parse(),this.data}},sectionDivider:class extends ys{static shouldParse(t){return"lsct"===t}constructor(t,e){super(t,e),this.isFolder=!1,this.isHidden=!1,this.layerType=null,this.blendMode=null,this.subType=null}parse(){const t=this.file.readInt();switch(this.layerType=Ns[t],t){case 1:case 2:this.isFolder=!0;break;case 3:this.isHidden=!0}this.length>=12&&(this.file.seek(4,!0),this.blendMode=this.file.readString(4),this.length>=16&&(this.subType=0===this.file.readInt()?"normal":"scene group"))}},typeTool:Rs,vectorMask:class extends ys{static shouldParse(t){return"vmsk"===t||"vsms"===t}constructor(t,e){super(t,e),this.invert=null,this.notLink=null,this.disable=null,this.paths=[]}parse(){this.file.seek(4,!0);const t=this.file.readInt();this.invert=(1&t)>0,this.notLink=(2&t)>0,this.disable=(4&t)>0;const e=(this.length-10)/26;for(let s=0;s<e;s++){const t=new Ms(this.file);t.parse(),this.paths.push(t)}}export(){return{invert:this.invert,notLink:this.notLink,disable:this.disable,paths:this.paths.map(t=>t.export())}}},vectorOrigination:class extends ys{static shouldParse(t){return"vogk"===t}parse(){return this.file.seek(8,!0),this.data=new xs(this.file).parse(),this.data}},vectorStroke:class extends ys{static shouldParse(t){return"vstk"===t}parse(){return this.file.seek(4,!0),this.data=new xs(this.file).parse(),this.data}},vectorStrokeContent:class extends ys{static shouldParse(t){return"vscg"===t}parse(){return this.file.seek(8,!0),this.data=new xs(this.file).parse(),this.data}},placedLayer:class extends ys{static shouldParse(t){return"PlLd"===t}constructor(t,e){super(t,e),this.Trnf=[]}parse(){this.identifier=this.file.readString(this.file.readByte()),this.version=this.file.readInt();const t=is(this.file.readByte());return this.Idnt=this.file.readString(t),this.PgNm=this.file.parseInt(),this.totalPages=this.file.parseInt(),this.Annt=this.file.readInt(),this.Type=this.file.readInt(),this.parseTransformInfo(),this.warpValue=this.file.readInt(),this.file.seek(4,!0),this.warpData=new xs(this.file).parse(),this}parseTransformInfo(){for(let t=0;t<8;t++)this.Trnf.push(this.file.readDouble())}},linkedLayer:Ls,smartObject:class extends ys{static shouldParse(t){return"SoLd"===t}constructor(t,e){super(t,e)}parse(){return this.identifier=this.file.readString(this.file.readByte()),this.version=this.file.readInt(),this.file.seek(4,!0),this.data=new xs(this.file).parse(),this}},exposure:class extends ys{constructor(t,e){super(t,e),this.pos=this.file.tell()}static shouldParse(t){return"expA"===t}parse(){const t=this.file.tell();return this.file.seek(this.pos),this.version=this.file.readShort(),this.exposure=this.file.readFloat(),this.offset=this.file.readFloat(),this.gamma=this.file.readFloat(),this.file.seek(t),{version:this.version,exposure:this.exposure,offset:this.offset,gamma:this.gamma}}},pattern:class extends ys{static shouldParse(t){return"PtFl"===t}parse(){this.data="调节图层:PtFl"}},brightnessContrast:class extends ys{static shouldParse(t){return"brit"===t}parse(){this.data="调节图层:brit"}},levels:class extends ys{static shouldParse(t){return"levl"===t}parse(){this.data="调节图层:levl"}},curves:class extends ys{static shouldParse(t){return"curv"===t}parse(){this.data="调节图层:curv"}},hue2:class extends ys{static shouldParse(t){return"hue2"===t}parse(){this.data="调节图层:hue2"}},colorBalance:class extends ys{static shouldParse(t){return"blnc"===t}parse(){this.data="调节图层:blnc"}},blackWhite:class extends ys{static shouldParse(t){return"blwh"===t}parse(){this.data="调节图层:blwh"}},photoFilter:class extends ys{static shouldParse(t){return"phfl"===t}parse(){this.data="调节图层:phfl"}},colorLookup:class extends ys{static shouldParse(t){return"clrL"===t}parse(){this.data="调节图层:clrL"}},invert:class extends ys{static shouldParse(t){return"nvrt"===t}parse(){this.data="调节图层:nvrt"}},threshold:class extends ys{static shouldParse(t){return"thrs"===t}parse(){this.data="调节图层:thrs"}},gradientMap:class extends ys{static shouldParse(t){return"grdm"===t}parse(){this.data="调节图层:grdm"}},selectiveColor:class extends ys{static shouldParse(t){return"selc"===t}parse(){this.data="调节图层:selc"}},solidColor:class extends ys{static shouldParse(t){return"SoCo"===t}constructor(t,e){super(t,e),this.r=this.g=this.b=0}parse(){this.file.seek(4,!0),this.data=new xs(this.file).parse(),this.r=Math.round(this.colorData()["Rd  "]),this.g=Math.round(this.colorData()["Grn "]),this.b=Math.round(this.colorData()["Bl  "])}colorData(){return this.data["Clr "]}color(){return[this.r,this.g,this.b]}},channelMixer:class extends ys{static shouldParse(t){return"mixr"===t}parse(){this.data="调节图层:mixr"}},posterize:class extends ys{static shouldParse(t){return"post"===t}parse(){this.file.seek(4,!0),this.data="调节图层:post"}},vibrance:class extends ys{static shouldParse(t){return"vibA"===t}parse(){this.data="调节图层:vibA"}}},js=["LMsk","Lr16","Lr32","Layr","Mt16","Mt32","Mtrn","Alph","FMsk","Ink2","FEid","FXid","PxSD"];function zs(){for(;this.file.tell()<this.layerEnd;){this.file.seek(4,!0);const t=this.file.readString(4);let e;if(e=2===this.header.version&&js.includes(t)?is(this.file.readLongLong()):is(this.file.readInt()),this.file.tell(),e<=0)continue;let s=!1;for(const i in Es){const r=Es[i];if(!r.shouldParse(t))continue;const n=new r(this,e);if(this.externalFiles&&"lnk2"===t){this.externalFiles.push(n.parse());break}this.adjustments[i]=new ms(n,this.file).now("skip").later("parse").get(),null==this[i]&&(this[i]=()=>this.adjustments[i]),this.infoKeys.push(t),s=!0;break}s||this.file.seek(e,!0)}}const Vs={norm:"normal",dark:"darken",lite:"lighten",hue:"hue",sat:"saturation",colr:"color",lum:"luminosity",mul:"multiply",scrn:"screen",diss:"dissolve",over:"overlay",hLit:"hard_light",sLit:"soft_light",diff:"difference",smud:"exclusion",div:"color_dodge",idiv:"color_burn",lbrn:"linear_burn",lddg:"linear_dodge",vLit:"vivid_light",lLit:"linear_light",pLit:"pin_light",hMix:"hard_mix",pass:"passthru",dkCl:"darker_color",lgCl:"lighter_color",fsub:"subtract",fdiv:"divide"};class Bs{constructor(t){this.file=t,this.blendKey=null,this.opacity=null,this.clipping=null,this.clipped=null,this.flags=null,this.blendingMode=null,this.visible=null}parse(){this.file.seek(4,!0),this.blendKey=this.file.readString(4).trim(),this.opacity=this.file.readByte(),this.clipping=this.file.readByte(),this.flags=this.file.readByte(),this.blendingMode=Vs[this.blendKey],this.clipped=1===this.clipping,this.visible=!((2&this.flags)>0),this.file.seek(1,!0)}get mode(){return this.blendingMode}opacityPercentage(){return 100*this.opacity/255}}class Fs{constructor(t,e){this.file=t,this.hasRealUserSuppliedLayerMask=e,this.top=0,this.right=0,this.bottom=0,this.left=0}parse(){if(this.size=this.file.readInt(),0===this.size)return this;const t=this.file.tell()+this.size;if(this.top=this.file.readInt(),this.left=this.file.readInt(),this.bottom=this.file.readInt(),this.right=this.file.readInt(),this.defaultColor=this.file.readByte(),this.flags=this.file.readByte(),this.relative=!(1&this.flags),this.isEnabled=!(this.flags>>1&1),this.disabled=!this.isEnabled,this.invert=1==(this.flags>>3&1),this.hasParam=this.flags>>4&1,this.external=this.hasParam,this.hasParam){let t=255,e=0,s=255,i=0;this.hasRealUserSuppliedLayerMask&&this.readRealUserSuppliedLayerMask();const r=this.file.tell(),n=this.file.readByte();1&n&&(t=this.file.readByte()),n>>1&1&&(e=this.file.readDouble()),n>>2&1&&(s=this.file.readByte()),n>>3&1&&(i=this.file.readDouble()),1==(this.file.tell()-r&1)&&this.file.readByte(),this.maskParameters=[t,e,s,i]}else 20===this.size?this.file.seek(2,!0):this.readRealUserSuppliedLayerMask();return this.width=this.right-this.left,this.height=this.bottom-this.top,this.file.seek(t),this}readRealUserSuppliedLayerMask(){const t=this.file.readByte(),e=this.file.readByte(),s=this.file.readInt(),i=this.file.readInt(),r=this.file.readInt(),n=this.file.readInt(),a=n-i,o=r-s;this.vmask={relative:!(1&t),isEnabled:!(t>>1&1),invert:1==(t>>3&1),hasParam:t>>4&1,color:e,top:s,left:i,bottom:r,right:n,width:a,height:o}}export(){return 0===this.size?{}:{top:this.top,left:this.left,bottom:this.bottom,right:this.right,width:this.width,height:this.height,defaultColor:this.defaultColor,relative:this.relative,disabled:this.disabled,invert:this.invert,padding:this.padding,external:this.external}}}class Os extends ps{constructor(t,e,s){super(t,e,s),this.layer=s,this._width=this.layer.width,this._height=this.layer.height,this.width=function(){return this._width},this.height=function(){return this._height},this.channelsInfo=this.layer.channelsInfo,this.hasMask=this.channelsInfo.some(t=>t.id<-1),this.opacity=this.layer.opacity/255}skip(){const t=this.channelsInfo,e=t.length;for(let s=0;s<e;s++){const e=t[s];this.file.seek(e.length,!0)}}channels(){return this.layer.channels}parse(){var t;this.chanPos=0;const e=this.channelsInfo,s=e.length;for(let i=0;i<s;i++){const s=e[i];if(s.length<=0){this.parseCompression();continue}if(this.chan=s,s.id<-1){if(this._width=this.layer.mask.width,this._height=this.layer.mask.height,-2===s.id){const{width:t,height:e}=this.layer.mask;if(!t||!e)throw new Error("Incorrect layer mask size");this._width=t,this._height=e}if(-3===s.id){const{width:e,height:s}=null==(t=this.layer.mask)?void 0:t.vmask;if(!e||!s)throw new Error("Incorrect vector mask size");this._width=e,this._height=s}}else this._width=this.layer.width,this._height=this.layer.height;this.length=this._width*this._height;const r=this.file.tell();this.parseImageData();this.file.tell()!==r+this.chan.length&&this.file.seek(r+this.chan.length)}this._width=this.layer.width,this._height=this.layer.height,this.processImageData()}parseImageData(){switch(this.compression=this.parseCompression(),this.compression){case 0:this.parseRaw();break;case 1:this.parseRLE();break;case 2:case 3:this.parseZip();break;default:this.file.seek(this.endPos)}}parseRaw(){const t=this.chanPos+this.chan.length-2;for(let e=this.chanPos;e<t;e++)this.channelData[e]=this.file.readByte();this.chanPos+=this.chan.length-2}parseByteCounts(){const t=this.height(),e=[];for(let s=0;s<t;s++)1===this.header.version?e.push(this.file.readShort()):e.push(this.file.readInt());return e}parseChannelData(){this.lineIndex=0,this.decodeRLEChannel()}}let $s=class{constructor(t,e){this.file=t,this.header=e,this.mask={},this.blendingRanges={},this.adjustments={},this.channelsInfo=[],this.blendMode={},this.groupLayer=null,this.infoKeys=[],Object.defineProperty(this,"name",{get:function(){return null!=this.adjustments.name?this.adjustments.name.data:this.legacyName}})}parse(){this.parsePositionAndChannels(),this.parseBlendModes();const t=this.file.readInt();return this.layerEnd=this.file.tell()+t,this.hasRealUserSuppliedLayerMask=this.channelsInfo.some(t=>-3===t.id),this.parseMaskData(),this.parseBlendingRanges(),this.parseLegacyLayerName(),this.parseLayerInfo(),this.file.seek(this.layerEnd),this}export(){return{name:this.name,top:this.top,right:this.right,bottom:this.bottom,left:this.left,width:this.width,height:this.height,opacity:this.opacity,visible:this.visible,clipped:this.clipped,mask:this.mask.export()}}parsePositionAndChannels(){this.top=this.file.readInt(),this.left=this.file.readInt(),this.bottom=this.file.readInt(),this.right=this.file.readInt(),this.channels=this.file.readShort(),this.rows=this.height=this.bottom-this.top,this.cols=this.width=this.right-this.left;for(let t=0;t<this.channels;t++){const t=this.file.readShort();let e;e=1===this.header.version?this.file.readInt():this.file.readLongLong(),this.channelsInfo.push({id:t,length:e})}}parseBlendModes(){this.blendMode=new Bs(this.file),this.blendMode.parse(),this.opacity=this.blendMode.opacity,this.visible=this.blendMode.visible,this.clipped=this.blendMode.clipped}hidden(){return!this.visible}blendingMode(){return this.blendMode.blendingMode}parseMaskData(){return this.mask=new Fs(this.file,this.hasRealUserSuppliedLayerMask),this.mask.parse(),this.mask}parseBlendingRanges(){const t=this.file.readInt();if(0===t)return;this.blendingRanges.grey={source:{black:[this.file.readByte(),this.file.readByte()],white:[this.file.readByte(),this.file.readByte()]},dest:{black:[this.file.readByte(),this.file.readByte()],white:[this.file.readByte(),this.file.readByte()]}};const e=(t-8)/8;this.blendingRanges.channels=[];for(let s=0;s<e;s++)this.blendingRanges.channels.push({source:{black:[this.file.readByte(),this.file.readByte()],white:[this.file.readByte(),this.file.readByte()]},dest:{black:[this.file.readByte(),this.file.readByte()],white:[this.file.readByte(),this.file.readByte()]}})}parseLegacyLayerName(){const t=rs(this.file.readByte());return this.legacyName=this.file.readString(t),this.legacyName}parseLayerInfo(){zs.call(this)}isFolder(){return null!=this.adjustments.sectionDivider?this.adjustments.sectionDivider.isFolder:null!=this.adjustments.nestedSectionDivider?this.adjustments.nestedSectionDivider.isFolder:"<Layer group>"===this.name}isFolderEnd(){return null!=this.adjustments.sectionDivider?this.adjustments.sectionDivider.isHidden:null!=this.adjustments.nestedSectionDivider?this.adjustments.nestedSectionDivider.isHidden:"</Layer group>"===this.name}parseChannelImage(){const t=new Os(this.file,this.header,this);this.image=new ms(t,this.file).now("skip").later("parse").get()}};function Us(t){return 9===t||10===t||32===t}function Hs(t,e,s){let i="";for(let r=0;r<s;r++)i+=String.fromCharCode(t[e+r]);return i}function Zs(t,e,s){const i=e,r={type:"",size:0,value:0};for(;Us(t[e]);)e++;if(60===t[e])r.type="Object",r.value={},e=function(t,e,s){for(;60!==t[s];)s++;return Gs(t,e,s+=2)}(t,r.value,e);else if(40===t[e])if(r.type="String",41===t[++e])r.value="e",e++;else{let s=e+=2;for(;41!==t[s]||92===t[s-1];)s+=1;r.value="s"+function(t,e,s){const i=[];let r="";for(;e<s;){const s=t[e++];92===s?i.push(t[e++]):i.push(s)}for(let n=0;n<i.length;n+=2)r+=String.fromCharCode(i[n]<<8|i[n+1]);return r}(t,e,s),e=s+2}else if(91===t[e]){for(e++,r.value=[],r.type="Array";Us(t[e]);)e++;for(;93!==t[e];){const s=Zs(t,e);if(-1===s)return-1;for(r.value.push(s.value),e+=s.size,delete s.size;Us(t[e]);)e++}e++}else{let s=e;for(;!Us(t[s]);)s++;const i=Hs(t,e,s-e),n=parseFloat(i);if(isNaN(n)||-1===i.indexOf("."))if(isNaN(n)||-1!==i.indexOf("."))if("true"===i||"false"===i)r.type="Boolean",r.value="true"===i;else if("/"===i.charAt(0))r.type="BString",r.value=i;else{if("NaN"!==i&&"undefined"!==i)throw"e";r.type="Float",r.value="f0"}else r.type="Integer",r.value="i"+parseInt(i);else r.type="Float",r.value="f"+parseFloat(i);e=s+1}return r.size=e-i,r}function Gs(t,e,s){for(;;){for(;Us(t[s])||0===t[s];)s++;if(s>=t.length)break;if(47!==t[s]){if(62===t[s]){s+=2;break}t[s];throw s++,"e"}{let i=++s;for(;!Us(t[i]);)i++;const r=Hs(t,s,i-s),n=Zs(t,s=i+1);e["_"+r]=n.value,s+=n.size}}return s}const Ws={_Color:[0,{_Type:[0],_Values:[1]}],_CAIKnownStyleID:[5],_StreamTag:[99]},Xs={_Font:[0],_FontSize:[1],_FauxBold:[2],_FauxItalic:[3],_AutoLeading:[4],_Leading:[5],_HorizontalScale:[6],_VerticalScale:[7],_Tracking:[8],_BaselineShift:[9],_CharacterRotation:[10],_AutoKern:[11],_FontCaps:[12],_FontBaseline:[13],_FontOTPosition:[14],_StrikethroughPosition:[15],_UnderlinePosition:[16],_UnderlineOffset:[17],_Ligatures:[18],_DiscretionaryLigatures:[19],_ContextualLigatures:[20],_AlternateLigatures:[21],_OldStyle:[22],_Fractions:[23],_Ordinals:[24],_Swash:[25],_Titling:[26],_ConnectionForms:[27],_StylisticAlternates:[28],_Ornaments:[29],_FigureStyle:[30],_ProportionalMetrics:[31],_Kana:[32],_Italics:[33],_Ruby:[34],_BaselineDirection:[35],_Tsume:[36],_StyleRunAlignment:[37],_Language:[38],_JapaneseAlternateFeature:[39],_EnableWariChu:[40],_WariChuLineCount:[41],_WariChuLineGap:[42],_WariChuSubLineAmount:[43,{_WariChuSubLineScale:[0]}],_WariChuWidowAmount:[44],_WariChuOrphanAmount:[45],_WariChuJustification:[46],_TCYUpDownAdjustment:[47],_TCYLeftRightAdjustment:[48],_LeftAki:[49],_RightAki:[50],_JiDori:[51],_NoBreak:[52],_FillColor:[53,Ws],_StrokeColor:[54,Ws],_Blend:[55,{_1:[1],_3:[3],_Knockout:[4],_StreamTag:[99]}],_FillFlag:[56],_StrokeFlag:[57],_FillFirst:[58],_FillOverPrint:[59],_StrokeOverPrint:[60],_LineCap:[61],_LineJoin:[62],_LineWidth:[63],_MiterLimit:[64],_LineDashOffset:[65],_LineDashArray:[66],_Type1EncodingNames:[67],_Kashidas:[68],_DirOverride:[69],_DigitSet:[70],_DiacVPos:[71],_DiacXOffset:[72],_DiacYOffset:[73],_OverlapSwash:[74],_JustificationAlternates:[75],_StretchedAlternates:[76],_FillVisibleFlag:[77],_StrokeVisibleFlag:[78],_FillBackgroundColor:[79,Ws],_FillBackgroundFlag:[80],_UnderlineStyle:[81],_DashedUnderlineGapLength:[82],_DashedUnderlineDashLength:[83],_SlashedZero:[84],_StylisticSets:[85],_CustomFeature:[86,{_StreamTag:[99]}],_MarkYDistFromBaseline:[87],_AutoMydfb:[88],_RefFontSize:[89],_FontSizeRefType:[90],_91:[91],_92:[92],_93:[93]},qs={_Justification:[0],_FirstLineIndent:[1],_StartIndent:[2],_EndIndent:[3],_SpaceBefore:[4],_SpaceAfter:[5],_DropCaps:[6],_AutoLeading:[7],_LeadingType:[8],_AutoHyphenate:[9],_HyphenatedWordSize:[10],_PreHyphen:[11],_PostHyphen:[12],_ConsecutiveHyphens:[13],_Zone:[14],_HyphenateCapitalized:[15],_HyphenationPreference:[16],_WordSpacing:[17],_LetterSpacing:[18],_GlyphSpacing:[19],_SingleWordJustification:[20],_Hanging:[21],_AutoTCY:[22],_KeepTogether:[23],_BurasagariType:[24],_KinsokuOrder:[25],_Kinsoku:[27],_KurikaeshiMojiShori:[26],_MojiKumiTable:[28],_EveryLineComposer:[29],_TabStops:[30],_DefaultTabWidth:[31],_DefaultStyle:[32,Xs],_ParagraphDirection:[33],_JustificationMethod:[34],_ComposerEngine:[35],_ListStyle:[36],_ListTier:[37],_ListSkip:[38],_ListOffset:[39],_KashidaWidth:[40]},Ys={_Name:[0],_Features:[5,qs],_Parent:[6],_UUID:[97]},Qs={_Name:[0],_Parent:[5],_Features:[6,Xs],_UUID:[97]},Ks={_98:[98,{_0:[0]}],_DocumentResources:[0,{_0:[0],_FontSet:[1,{_Resources:[0,{_Resource:[0,{_StreamTag:[99],_Identifier:[0,{_Name:[0],_ScriptType:[1],_Type:[2],_Synthetic:[3],_4:[4],_MMAxis:[5]}],_UUID:[97]}]}],_DisplayList:[1,{_Resource:[0]}]}],_MojiKumiCodeToClassSet:[2,{_Resources:[0,{_Resource:[0,{_Name:[0],_Members:[5],_UUID:[97]}]}],_DisplayList:[1,{_Resource:[0]}]}],_MojiKumiTableSet:[3,{_Resources:[0,{_Resource:[0,{_Name:[0],_Members:[5,{_CodeToClass:[0],_AutoTsume:[1,{_TsumeMappings:[0,{_Before:[0],_After:[1],_Code:[2]}]}],_Table:[2,{_DataArray:[0,{_SparseArray:[0,{_Index:[0],_Elements:[1,{_P:[0],_Data:[1,{_A:[0,{_R:[0],_P:[1]}],_B:[1,{_R:[0],_P:[1]}]}]}]}]}]}],_PredefinedTag:[3]}],_UUID:[97]}]}],_DisplayList:[1,{_Resource:[0]}]}],_KinsokuSet:[4,{_Resources:[0,{_Resource:[0,{_Name:[0],_Data:[5,{_NoStart:[0],_NoEnd:[1],_Keep:[2],_Hanging:[3],_PredefinedTag:[4]}],_UUID:[97]}]}],_DisplayList:[1,{_Resource:[0]}]}],_StyleSheetSet:[5,{_Resources:[0,{_Resource:[0,Qs]}],_DisplayList:[1,{_Resource:[0]}]}],_ParagraphSheetSet:[6,{_Resources:[0,{_Resource:[0,Ys]}],_DisplayList:[1,{_Resource:[0]}]}],_7:[7,{_Resources:[0,{_Resource:[0,{_0:[0,{_0:[0],_1:[1,{_0:[0]}]}],_1:[1]}]}]}],_TextFrameSet:[8,{_Resources:[0,{_Resource:[0,{_0:[0],_Bezier:[1,{_Points:[0]}],_Data:[2,{_Type:[0],_LineOrientation:[1],_FrameMatrix:[2],_4:[4],_TextOnPathTRange:[6],_RowGutter:[7],_ColumnGutter:[8],_9:[9],_FirstBaselineAlignment:[10,{_Flag:[0],_Min:[1]}],_PathData:[11,{_1:[1],_Reversed:[0],_2:[2],_3:[3],_Spacing:[4],_5:[5],_6:[6],_7:[7],_18:[18]}],_12:[12],_13:[13]}],_3:[3,{_0:[0]}],_UUID:[97]}]}]}],_ListStyleSet:[9,{_Resources:[0,{_Resource:[0,{_Name:[0],_LevelStyle:[5,{_IndentUnits:[0],_TextIndent:[1],_LabelIndent:[2],_LabelAlignment:[3],_SequenceGenerator:[5,{_Prefix:[0],_Postfix:[1],_2:[2],_CaseType:[3],_Bullet:[9],_StreamTag:[99]}],_Font:[6],_7:[7]}],_PredefinedTag:[6],_UUID:[97]}]}],_DisplayList:[1,{_Resource:[0]}]}]}],_DocumentObjects:[1,{_DocumentSettings:[0,{_HiddenGlyphFont:[0,{_AlternateGlyphFont:[0],_WhitespaceCharacterMapping:[1,{_WhitespaceCharacter:[0],_AlternateCharacter:[1]}]}],_NormalStyleSheet:[1],_NormalParagraphSheet:[2],_SuperscriptSize:[3],_SuperscriptPosition:[4],_SubscriptSize:[5],_SubscriptPosition:[6],_SmallCapSize:[7],_UseSmartQuotes:[8],_SmartQuoteSets:[9,{_Language:[0],_OpenDoubleQuote:[1],_CloseDoubleQuote:[2],_OpenSingleQuote:[3],_CloseSingleQuote:[4]}],_10:[10],_11:[11],_LinguisticSettings:[15,{_PreferredProvider:[0],_LinguisticProviderInfo:[1]}],_13:[13],_UseSmartLists:[16],_DefaultStoryDir:[17],_18:[18],_GreekingSize:[20]}],_TextObjects:[1,{_Model:[0,{_Text:[0],_ParagraphRun:[5,{_RunArray:[0,{_RunData:[0,{_ParagraphSheet:[0,Ys]}],_Length:[1]}]}],_StyleRun:[6,{_RunArray:[0,{_RunData:[0,{_StyleSheet:[0,Qs]}],_Length:[1]}]}],_FirstKern:[7],_8:[8],_AlternateGlyphRun:[9,{_RunArray:[0,{_RunData:[0,{_AlternateGlyphSheet:[0,{_Glyph:[0],_Name:[1],_2:[2]}]}],_Length:[1]}]}],_StorySheet:[10,{_AntiAlias:[0],_1:[1],_UseFractionalGlyphWidths:[2],_3:[3],_4:[4]}],_KernRun:[15],_HyperlinkRun:[16]}],_View:[1,{_Frames:[0,{_Resource:[0]}],_RenderedData:[1,{_RunArray:[0,{_RunData:[0,{_0:[0],_LineCount:[1]}],_Length:[1]}]}],_Strikes:[2]}],_OpticalAlignment:[2]}],_OriginalNormalStyleFeatures:[2,Xs],_OriginalNormalParagraphFeatures:[3,qs]}]},Js=function(t,e,s){let i;if("string"==typeof t)return t;if(t instanceof Array){i=[];for(let s=0;s<t.length;s++)i[s]=Js(t[s],e)}else{i={};const s={};for(const r in e){const n=e[r],a="_"+n[0];null!=t[a]&&(i[r]=n[1]?Js(t[a],n[1]):t[a],s[a]=!0)}for(const e in t)if(null==s[e]){if(e.length>3)continue;throw"e"}}return i};const ti={linkedLayer:Ls,unicodePath:class extends ys{static shouldParse(t){return"pths"===t}parse(){return this.file.seek(4),this.data=new xs(this.file).parse(),this}},textEngineData:class extends ys{static shouldParse(t){return"Txt2"===t}constructor(t,e){super(t,e),this.textEngineData=null}parse(){const t=function(t){const e={};return Gs(t,e,0),e}(this.file.read(this.length));this.textEngineData=function(t){return Js(t,Ks)}(t)}export(){return{textEngineData:this.textEngineData}}},filterMask:class extends ys{static shouldParse(t){return"FMsk"===t}constructor(t,e){super(t,e)}parse(){this.color=this.file.readSpaceColor(),this.opacity=this.file.readShort()}},patternsData:class extends ys{static shouldParse(t){return["Patt","Pat2","Pat3"].includes(t)}constructor(t,e){super(t,e),this.length=e,this.patterns={}}readVirtualMemoryArrayList(){const{file:t}=this;t.seek(4,!0);const e=t.readInt()+t.tell(),s={top:t.readInt(),left:t.readInt(),bottom:t.readInt(),right:t.readInt(),channels:t.readInt(),data:[]};s.width=s.right-s.left,s.height=s.bottom-s.top;for(let i=0;i<s.channels+2;i++){let e=0,r=0;if(!t.readInt())continue;const n=t.readInt(),a=n+t.tell();t.readInt(),t.readInt(),t.readInt(),t.readInt(),t.readInt(),t.readShort();if(t.readByte()){const n=[];s.data[i]=new Uint8Array(s.width*s.height);for(let e=0;e<s.height;e++)n.push(t.readShort());for(let a=0;a<s.height;a++){const o=t.tell()+n[e+a];for(;t.tell()<o;){let e=t.read(1)[0];if(e<128){e+=1;const n=t.read(e);s.data[i].set(n,r),r+=e}else if(e>128){e^=255,e+=2;const n=t.read(1)[0];s.data[i].fill(n,r,r+e),r+=e}}}e+=s.height}else s.data[i]=new Uint8Array(t.read(n-23));t.seek(a)}return t.seek(e),s}readPattern(){const t=this.file,e=(t.readInt()+3&-4)+t.tell();t.readInt();const s=t.readInt(),i=[t.readShort(),t.readShort()],r={name:t.readUnicodeString(),id:t.readString(t.readByte()),mode:s,palette:[],width:i[1],height:i[0]};2===s&&(r.palette=t.read(768),t.seek(4,!0)),r.data=this.readVirtualMemoryArrayList(),this.patterns[r.id]=r,t.seek(e)}parse(){const t=this.file,e=this.length+t.tell();for(;t.tell()<e;)this.readPattern();t.seek(e)}}};class ei{constructor(t,e){this.file=t,this.header=e,this.layers=[],this.mergedAlpha=!1,this.globalMask=null,this.infoKeys=[],this.adjustments={},this.obj=this}skip(){this.file.seek(this.file.readInt(),!0)}parse(){let t;t=1===this.header.version?this.file.readInt():this.file.readLongLong(),this.layerEnd=t+this.file.tell(),t<=0||(this.parseLayers(),this.parseGlobalMask(),this.layers.reverse(),this.parseAdditionalLayerInformation(),this.assignGlobalEngineData(),this.file.seek(this.layerEnd))}parseLayers(){let t;t=1===this.header.version?is(this.file.readInt()):is(this.file.readLongLong());const e=this.file.tell()+t;if(t>0){let t=this.file.readShort();t<0&&(t=Math.abs(t),this.mergedAlpha=!0);for(let s=0;s<t;s++){const t=new $s(this.file,this.header);t.parse(),this.layers.push(t)}const e=this.layers.length;for(let s=0;s<e;s++){this.layers[s].parseChannelImage()}}this.file.seek(e)}parseGlobalMask(){const t=this.file.readInt();if(t<=0)return;const e=is(this.file.tell()+t),s={};s.overlayColorSpace=this.file.readShort(),s.colorComponents=[this.file.readShort()>>8,this.file.readShort()>>8,this.file.readShort()>>8,this.file.readShort()>>8],s.opacity=this.file.readShort()/16,s.kind=this.file.readByte(),this.globalMask=s,this.file.seek(e)}parseAdditionalLayerInformation(){for(;this.file.tell()<this.layerEnd;){this.file.seek(4,!0);const t=this.file.readString(4),e=is(this.file.readInt());if(this.file.tell(),e<=0)continue;let s=!1;for(const i in ti){const r=ti[i];if(!r.shouldParse(t))continue;const n=new r(this,e);this.adjustments[i]=new ms(n,this.file).now("skip").later("parse").get(),null==this[i]&&(this[i]=()=>this.adjustments[i]),this.infoKeys.push(t),s=!0;break}s||this.file.seek(e,!0)}}assignGlobalEngineData(){var t,e,s,i;const r=null==(e=null==(t=this.adjustments)?void 0:t.textEngineData)?void 0:e.textEngineData,n=null==(i=null==(s=null==r?void 0:r._DocumentResources)?void 0:s._TextFrameSet)?void 0:i._Resources;if(!n||!this.layers.length)return;let a=n.length-1;this.layers.forEach(t=>{var e,s;const i=null==(s=null==(e=t.adjustments)?void 0:e.typeTool)?void 0:s.engineData;i&&(i.curve=n[a--])})}parseLayerInfo(){throw new Error("layerMask.parseLayerInfo is not implemented")}}class si{constructor(t){this.resource=t,this.file=this.resource.file,this.start=this.file.pos,this.end=this.start+this.resource.length}parse(){return this.data=this.file.data.subarray(this.start,this.end),this.data}}si.prototype.id=1039,si.prototype.name="icc profile";class ii{static visibilityCaptured(t){return t.capturedInfo&parseInt("001",2)>0}static positionCaptured(t){return t.positionCaptured&parseInt("010",2)>0}static appearanceCaptured(t){return t.appearanceCaptured&parseInt("100",2)>0}constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.file.seek(4,!0),this.data=new xs(this.file).parse(),this.data}names(){return this.data.list.map(t=>t["Nm  "])}export(){return this.data.list.map(t=>({id:t.compID,name:t["Nm  "],capturedInfo:t.capturedInfo}))}}ii.prototype.id=1065,ii.prototype.name="layerComps";let ri=class{constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.angle=this.file.readInt(),this.angle}};ri.prototype.id=1037,ri.prototype.name="globalLightAngle";class ni{constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.altitude=this.file.readInt(),this.altitude}}ni.prototype.id=1049,ni.prototype.name="globalLightAngle";class ai{constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.file.seek(4,!0),this.data=new xs(this.file).parse(),this.data}}ai.prototype.id=3e3,ai.prototype.name="originPathInfo";class oi{constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.file.seek(4,!0),this.data=new xs(this.file).parse(),this.data}}oi.prototype.id=1088,oi.prototype.name="pathSelection";class li{constructor(t){this.resource=t,this.file=this.resource.file,this.paths=[]}parse(){const t=this.resource.length/26;for(let e=0;e<t;e++){const t=new Ms(this.file);t.parse(),this.paths.push(t)}}export(){return this.paths}}li.prototype.id=2e3,li.prototype.name="path";class hi{constructor(t){this.resource=t,this.file=this.resource.file}parse(){this.format=this.file.readString(4),this.width=this.file.readInt(),this.height=this.file.readInt(),this.widthBytes=this.file.readInt(),this.totalSize=this.file.readInt(),this.compressedSize=this.file.readInt(),this.bitsPerPixel=this.file.readShort(),this.numberOfPlanes=this.file.readShort(),this.jfif=this.file.read(this.compressedSize),this.binaryString=String.fromCharCode.apply(null,this.jfif)}}hi.prototype.id=1036,hi.prototype.name="thumbnail";class ci{constructor(t){this.resource=t,this.file=this.resource.file,this.linkArray=[]}parse(){const t=this.file.tell()+this.resource.length;for(;t>this.file.tell();)this.linkArray.push(this.file.readShort());return this.linkArray.reverse(),this.linkArray}}ci.prototype.id=1026,ci.prototype.name="LinkLayers";class ui{constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.h_res=this.file.readUInt()/65536,this.h_res_unit=this.file.readUShort(),this.width_unit=this.file.readUShort(),this.v_res=this.file.readUInt()/65536,this.v_res_unit=this.file.readUShort(),this.height_unit=this.file.readUShort(),this.resource.data={h_res:this.h_res,h_res_unit:this.h_res_unit,width_unit:this.width_unit,v_res:this.v_res,v_res_unit:this.v_res_unit,height_unit:this.height_unit},this.resource.data}export(){const t={},e=["h_res","h_res_unit","width_unit","v_res","v_res_unit","height_unit"],s=e.length;for(let i=0;i<s;i++){const s=e[i];t[s]=this[s]}return t}}ui.prototype.id=1005,ui.prototype.name="resolutionInfo";class di{constructor(t){this.resource=t,this.file=this.resource.file,this.data=[]}parse(){this.file.seek(4,!0),this.file.seek(8,!0);const t=this.file.readInt();for(let e=0;e<t;e++){const t=(this.file.readInt()/32).toFixed(1),e=this.file.readByte()?"horizontal":"vertical";this.data.push({location:t,direction:e})}}export(){return this.data}}di.prototype.id=1032,di.prototype.name="guides";class pi{constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.xmp=this.file.read(this.resource.length),this.xmp}}pi.prototype.id=1060,pi.prototype.name="xmp";class gi{constructor(t){this.resource=t,this.file=this.resource.file}parse(){this.file.seek(4,!0),this.data=new xs(this.file).parse()}}gi.prototype.id=1075,gi.prototype.name="timeline";class fi{constructor(t){this.resource=t,this.file=this.resource.file,this.paths=[]}parse(){const t=(this.resource.length-10)/26;for(let e=0;e<t;e++){const t=new Ms(this.file);t.parse(),this.paths.push(t)}}}fi.prototype.id=1025,fi.prototype.name="WorkingPath";const mi=[si,ii,ri,ni,ai,oi,li,hi,ci,ui,di,pi,gi,fi];class xi{constructor(t){this.file=t,this.id=null,this.type=null,this.length=0}parse(){this.type=this.file.readString(4),this.id=this.file.readShort();const t=is(this.file.readByte()+1)-1;this.name=this.file.readString(t),this.length=is(this.file.readInt())}}xi.Section=class{static factory(t){const e=mi.length;for(let s=0;s<e;s++){const e=mi[s];if(e.prototype.id===t.id||t.id>=2e3&&t.id<2998&&2e3===e.prototype.id){const s=new e(t);return s.parse(),s}}return null}};class yi{constructor(t){this.file=t,this.resources={},this.typeIndex={},this.length=null}skip(){this.length=this.file.readInt(),this.file.seek(this.length,!0)}parse(){this.length=this.file.readInt();const t=this.length+this.file.tell();for(;this.file.tell()<t;){const t=new xi(this.file);t.parse();const e=this.file.tell()+t.length,s=xi.Section.factory(t);null!=s?(this.resources[s.id]=s,null!=s.name&&(this.typeIndex[s.name]=s.id),this.file.seek(e)):this.file.seek(e)}this.file.seek(t)}resource(t){return"string"==typeof t?this.byType(t):this.resources[t]}byType(t){return this.resources[this.typeIndex[t]]}load(){}}class bi{constructor(t,e){ss(this,"type","node"),this.parent=e,this.layer=t,this.layer.node=this,this._children=[],this.name=this.layer.name,this.forceVisible=null,this.coords={top:this.layer.top,bottom:this.layer.bottom,left:this.layer.left,right:this.layer.right},this.topOffset=0,this.leftOffset=0,this.createProperties()}createProperties(){return Object.defineProperty(this,"top",{get:function(){return this.coords.top+this.topOffset},set:function(t){return this.coords.top=t}}),Object.defineProperty(this,"right",{get:function(){return this.coords.right+this.leftOffset},set:function(t){return this.coords.right=t}}),Object.defineProperty(this,"bottom",{get:function(){return this.coords.bottom+this.topOffset},set:function(t){return this.coords.bottom=t}}),Object.defineProperty(this,"left",{get:function(){return this.coords.left+this.leftOffset},set:function(t){return this.coords.left=t}}),Object.defineProperty(this,"width",{get:function(){return this.right-this.left}}),Object.defineProperty(this,"height",{get:function(){return this.bottom-this.top}})}get(t){const e=null!=this[t]?this[t]:this.layer[t];return"function"==typeof e?e():e}visible(){return!(this.layer.clipped&&!this.clippingMask().visible())&&(null!=this.forceVisible?this.forceVisible:this.layer.visible)}hidden(){return!this.visible()}isLayer(){return"layer"===this.type}isGroup(){return"group"===this.type}isRoot(){return"root"===this.type}clippingMask(){if(!this.layer.clipped)return null;if(!this.clippingMaskCached){let t=this.nextSibling();for(;t.clipped;)t=t.nextSibling();this.clippingMaskCached=t}return this.clippingMaskCached}clippedBy(){return this.clippingMask()}export(){const t={type:null,visible:this.visible(),opacity:this.layer.opacity/255,blendingMode:this.layer.blendingMode()},e=bi.PROPERTIES,s=e.length;for(let i=0;i<s;i++){const s=e[i];t[s]=this[s]}return t}updateDimensions(){if(this.isLayer())return;const t=this._children,e=t.length;for(let i=0;i<e;i++){t[i].updateDimensions()}if(this.isRoot())return;const s=this._children.filter(t=>!t.isEmpty());this.left=Math.min.call(null,s.map(t=>t.left))||0,this.top=Math.min.call(null,s.map(t=>t.top))||0,this.bottom=Math.max.call(null,s.map(t=>t.bottom))||0,this.right=Math.max.call(null,s.map(t=>t.right))||0}root(){return this.isRoot()?this:this.parent.root()}children(){return this._children}ancestors(){return null==this.parent||this.parent.isRoot()?[]:this.parent.ancestors().concat([this.parent])}hasChildren(){return this._children.length>0}childless(){return!this.hasChildren()}siblings(){return null==this.parent?[]:this.parent.children()}nextSibling(){if(null==this.parent)return null;const t=this.siblings().indexOf(this);return this.siblings()[t+1]}prevSibling(){if(null==this.parent)return null;const t=this.siblings().indexOf(this);return this.siblings()[t-1]}hasSiblings(){return this.siblings().length>1}onlyChild(){return!this.hasSiblings()}descendants(){return this._children.map(t=>t.subtree()).flat()}subtree(){return[this].concat(this.descendants())}depth(){return this.ancestors().length+1}path(t=!1){const e=this.ancestors().map(function(t){return t.name}).concat([this.name]);return t?e:e.join("/")}toPng(){return this.layer.image.toPng()}saveAsPng(t){return this.layer.image.saveAsPng(t)}childrenAtPath(t,e={}){Array.isArray(t)||(t=t.split("/").filter(t=>t.length>0));const s=(t=[...t]).shift(),i=this.children().filter(function(t){return e.caseSensitive?t.name===s:t.name.toLowerCase()===s.toLowerCase()});return 0===t.length?i:i.map(s=>s.childrenAtPath([...t],e)).flat()}}bi.PROPERTIES=["name","left","right","top","bottom","height","width"];class wi extends bi{constructor(){super(...arguments),ss(this,"type","group")}passthruBlending(){return"passthru"===this.get("blendingMode")}isEmpty(){const t=this._children,e=t.length;for(let s=0;s<e;s++){if(!t[s].isEmpty())return!1}return!0}export(){const t=super.export();return t.type="group",t.children=this._children.map(function(t){return t.export()}),t}}class ki extends bi{constructor(){super(...arguments),ss(this,"type","layer")}hasMask(){if(!this.layer.adjustments)return!1;const t=this.layer.adjustments.vectorMask,e=this.layer.adjustments.vectorStroke;return t||e}isEmpty(){return(0===this.width||0===this.height)&&!this.hasMask()}export(){const t=this.get("typeTool"),e=super.export();return e.type="layer",e.mask=this.layer.mask.export(),e.text=t?t.export():void 0,e.image={},e}}class Si extends bi{constructor(t){super(Si.layerForPsd(t)),ss(this,"type","root"),this.psd=t,this.buildHierarchy()}static layerForPsd(t){const e={},s=bi.PROPERTIES,i=s.length;for(let r=0;r<i;r++){e[s[r]]=null}return e.top=0,e.left=0,e.right=t.header.width,e.bottom=t.header.height,e}documentDimensions(){return[this.width,this.height]}depth(){return 0}opacity(){return 255}fillOpacity(){return 255}export(){const t=this.psd.resources.resource("layerComps"),e=this.psd.resources.resource("resolutionInfo"),s=this.psd.resources.resource("guides");return{children:this._children.map(t=>t.export()),document:{width:this.width,height:this.height,resources:{layerComps:t?t.export():[],resolutionInfo:e?e.export():[],guides:s?s.export():null,slices:[]}}}}buildHierarchy(){let t=this;const e=[],s=this.psd.layers,i=s.length;for(let r=0;r<i;r++){const i=s[r];if(i.isFolder()){e.push(t);const s=e[e.length-1];t=new wi(i,s)}else if(i.isFolderEnd()&&e.length){const s=e.pop();s.children().push(t),t=s}else t.children().push(new ki(i,t))}this.updateDimensions()}}const vi=function(t){t.fromURL=function(e){return new Promise(function(s,i){const r=new XMLHttpRequest;return r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){const e=new Uint8Array(r.response||r.mozResponseArrayBuffer);try{const i=new t(e);i.parse(),s(i)}catch(n){return i(n)}},r.send(null)})},t.fromEvent=function(e){return new Promise(function(s,i){const r=e.dataTransfer.files[0],n=new FileReader;return n.onload=function(e){try{const i=new t(new Uint8Array(e.target.result));i.parse(),s(i)}catch(r){i(r)}},n.onerror=i,n.readAsArrayBuffer(r)})},t.fromDroppedFile=function(e){return new Promise(function(s,i){const r=new FileReader;r.onload=function(e){try{const i=new t(new Uint8Array(e.target.result));i.parse(),s(i)}catch(r){i(r)}},r.onerror=i,r.readAsArrayBuffer(e)})}};class Pi{constructor(t){this.file=new hs(t),this.parsed=!1,this.header=null,Object.defineProperty(this,"layers",{get:function(){return this.layerMask.layers}})}parse(){this.parsed||(this.parseHeader(),this.parseResources(),this.parseLayerMask(),this.parseImage(),this.parsed=!0)}parseHeader(){this.header=new us(this.file),this.header.parse()}parseResources(){const t=new yi(this.file);t.parse(),this.resources=t}parseLayerMask(){const t=new ei(this.file,this.header);t.parse(),this.layerMask=t}parseImage(){const t=new ps(this.file,this.header);t.parse(),this.image=t}tree(){return new Pi.Node.Root(this)}setColorConverters(){os.setColorConverters(...arguments)}}Pi.Node={Root:Si},vi(Pi),y.GlobalWorkerOptions.workerSrc=b;const _i=()=>{const[t,e]=o.useState([]),[s,b]=o.useState([]),[w,k]=o.useState(!1),[S,v]=o.useState(null),[_,C]=o.useState(null),[A,I]=o.useState(!1),[T,D]=o.useState(!0),[R,N]=o.useState(!0),[M,L]=o.useState([]),E=o.useRef(null),j=o.useRef(null),z=o.useRef(null),[V,B]=o.useState(!1),[F,O]=o.useState(0),[$,U]=o.useState("A4"),[H,Z]=o.useState("portrait"),[G,W]=o.useState(595.28),[X,q]=o.useState(841.89),[Y,Q]=o.useState([]),[K,J]=o.useState(null),tt=s=>{const i=[...t],r=[];for(const t of s)"application/zip"===t.type?t.size>104857600?r.push(`File ${t.name} exceeds 100MB limit.`):i.some(e=>e.name===t.name&&e.size===t.size)?r.push(`Duplicate file skipped: ${t.name}`):i.push(t):r.push(`File ${t.name} is not a ZIP archive.`);e(i),r.length&&v({message:r.join(" "),type:"error"})};o.useEffect(()=>{(async()=>{if(0===t.length)return void L([]);const e=[];for(const s of t)try{const t=await s.arrayBuffer(),i=await n.loadAsync(t),r=[];i.forEach((t,e)=>{r.push({name:e.name,type:e.dir?"folder":e.name.split(".").pop()||""})}),e.push(r.filter(t=>!t.name.endsWith("/")))}catch{e.push([])}L(e)})()},[t]),o.useEffect(()=>{let t=!1;return(async()=>{if(0!==s.length){I(!0);try{const e=s[0],i=await e.arrayBuffer(),r=await y.getDocument({data:i}).promise,n=await r.getPage(1),a=n.getViewport({scale:1.2}),o=document.createElement("canvas");o.width=a.width,o.height=a.height;const l=o.getContext("2d");if(!l)throw new Error("Could not get canvas context");await n.render({canvasContext:l,viewport:a}).promise;const h=o.toDataURL("image/png");t||C(h)}catch{C(null)}finally{I(!1)}}else C(null)})(),()=>{t=!0}},[s]),o.useEffect(()=>{S&&z.current&&z.current.focus()},[S]),o.useEffect(()=>()=>{_&&URL.revokeObjectURL(_)},[_]),o.useEffect(()=>{if(0===t.length)return void Q([]);(async()=>{const e=[];for(const s of t){let t=function(e,s=[]){let i=[];for(const r in e)e[r]?i=i.concat(t(e[r],[...s,r])):i.push({path:s,name:r});return i};const i=await s.arrayBuffer(),r=await n.loadAsync(i),a={};r.forEach((t,e)=>{if(e.dir)return;const s=t.split("/");let i=a;for(let r=0;r<s.length;r++){const t=s[r];r===s.length-1?i[t]=null:(i[t]=i[t]||{},i=i[t])}});const o=t(a);for(const s of o)e.push({...s,included:!0})}Q(e)})()},[t]);const et=async()=>{var e;if(0!==t.length){k(!0),B(!0),v(null),b([]),O(0),J(null);try{const{PDFDocument:i,rgb:r,StandardFonts:o}=await a(async()=>{const{PDFDocument:t,rgb:e,StandardFonts:s}=await import("./index-GpLGME15.js");return{PDFDocument:t,rgb:e,StandardFonts:s}},__vite__mapDeps([0,1,2])),l=[];let h=0,c=0;const u=[],d=[];for(let a=0;a<t.length;a++){let p=function(t,e=[]){let s=[];for(const i in t)t[i]?s=s.concat(p(t[i],[...e,i])):s.push({path:e,name:i});return s};const g=t[a],f=await g.arrayBuffer(),m=await n.loadAsync(f),x=await i.create();let y;y=await x.embedFont(o.Helvetica);const b={};m.forEach((t,e)=>{if(e.dir)return;const s=t.split("/");let i=b;for(let r=0;r<s.length;r++){const t=s[r];r===s.length-1?i[t]=null:(i[t]=i[t]||{},i=i[t])}});const w=p(b);let k=[];for(const t of w){const i=t.path;if(i.join("/")!==k.join("/")){if(i.length>0){const t=x.addPage(Ci($,H,G,X)),{height:e}=t.getSize();t.drawText(i.join(" / "),{x:50,y:e-100,size:18,font:y,color:r(.3,.3,.7)})}k=i}const n=[...i,t.name].join("/"),a=m.file(n);if(!a){c++,d.push({name:t.name,status:"Skipped (not found)"});continue}const o=(null==(e=t.name.split(".").pop())?void 0:e.toLowerCase())||"",l=["jpg","jpeg","png","gif","bmp","webp","svg","psd"],p=["txt","md","csv","log","dxf"],g=[];if((T&&l.includes(o)||R&&p.includes(o))&&g.push({name:t.name,ext:o,file:a}),0!==g.length)for(const{name:t,ext:e,file:f}of g)try{if(["svg"].includes(e)){const e=await f.async("text"),s=document.createElement("canvas");s.width=800,s.height=600;const i=s.getContext("2d");if(i){const n=Ut.fromString(i,e);await n.render();const a=s.toDataURL("image/png"),o=await fetch(a).then(t=>t.arrayBuffer()),l=await x.embedPng(o),c=x.addPage(Ci($,H,G,X));c.drawImage(l,{x:0,y:0,width:l.width,height:l.height}),c.drawText(t,{x:10,y:10,size:10,font:y,color:r(.5,.5,.5)}),h++,d.push({name:t,status:"Processed (SVG)"})}}else if(["md"].includes(e)){const e=ts(await f.async("text")),s=("string"==typeof e?e:await e).replace(/<[^>]+>/g,"").split(/\r?\n/),i=50,n=14,a=50;let o=0;for(let l=0;l<s.length;l+=a){const e=x.addPage(Ci($,H,G,X)),{width:h,height:c}=e.getSize();0===o&&e.drawText(t,{x:i,y:c-i,size:12,font:y,color:r(0,0,0)});let u=c-i-(0===o?20:0)-n;const d=s.slice(l,l+a);for(const t of d)e.drawText(t.slice(0,100),{x:i,y:u,size:10,font:y,color:r(0,0,0)}),u-=n;o++}h++,d.push({name:t,status:"Processed (Markdown)"})}else if(["psd"].includes(e)){const e=await f.async("arraybuffer"),s=await Pi.fromArrayBuffer(e),i=await s.image.toPng().toBuffer(),n=await x.embedPng(i),a=x.addPage(Ci($,H,G,X));a.drawImage(n,{x:0,y:0,width:n.width,height:n.height}),a.drawText(t,{x:10,y:10,size:10,font:y,color:r(.5,.5,.5)}),h++,d.push({name:t,status:"Processed (PSD)"})}else if(["dxf"].includes(e)){const e=await f.async("text"),i=new P;try{i.parseSync(e);const s=e.split(/\r?\n/),n=50,a=14,o=50;let l=0;for(let e=0;e<s.length;e+=o){const i=x.addPage(Ci($,H,G,X)),{width:h,height:c}=i.getSize();0===l&&i.drawText(t,{x:n,y:c-n,size:12,font:y,color:r(0,0,0)});let u=c-n-(0===l?20:0)-a;const d=s.slice(e,e+o);for(const t of d)i.drawText(t.slice(0,100),{x:n,y:u,size:10,font:y,color:r(0,0,0)}),u-=a;l++}h++,d.push({name:t,status:"Processed (DXF as text)"})}catch(s){c++,d.push({name:t,status:"Skipped (DXF parse error)"})}}else if(l.includes(e)){const s=await f.async("uint8array");let i;i="png"===e?await x.embedPng(s):await x.embedJpg(s);const n=x.addPage(Ci($,H,G,X));n.drawImage(i,{x:0,y:0,width:i.width,height:i.height}),n.drawText(t,{x:10,y:10,size:10,font:y,color:r(.5,.5,.5)}),h++,d.push({name:t,status:"Processed (image)"})}else if(p.includes(e)){const e=(await f.async("text")).split(/\r?\n/),s=841.89,i=50,n=14,a=Math.floor((s-2*i-20)/n);let o=0;for(let l=0;l<e.length;l+=a){const s=x.addPage(Ci($,H,G,X)),{width:h,height:c}=s.getSize();0===o&&s.drawText(t,{x:i,y:c-i,size:12,font:y,color:r(0,0,0)});let u=c-i-(0===o?20:0)-n;const d=e.slice(l,l+a);for(const t of d)s.drawText(t.slice(0,100),{x:i,y:u,size:10,font:y,color:r(0,0,0)}),u-=n;o++}h++,d.push({name:t,status:"Processed (text)"})}else c++,d.push({name:t,status:"Skipped (unsupported type)"})}catch(s){u.push({name:t,error:(null==s?void 0:s.message)||"Unknown error"}),d.push({name:t,status:"Error"})}else c++,d.push({name:t.name,status:"Skipped (unsupported type)"})}const S=await x.save();l.push(new Blob([S],{type:"application/pdf"})),O(Math.round((a+1)/t.length*100))}b(l),J({processed:h,skipped:c,errors:u,log:d}),v({message:"ZIP(s) successfully converted to PDF(s)!",type:"success"})}catch(i){v({message:"Error converting ZIP(s) to PDF(s). Please try again.",type:"error"}),J(null)}finally{k(!1),B(!1),O(0)}}else v({message:"Please upload at least one ZIP file.",type:"error"})},st=[{icon:i.jsx(l,{className:"h-6 w-6"}),title:"ZIP to PDF",description:"Convert ZIP archives to organized PDF documents"},{icon:i.jsx(x,{className:"h-6 w-6"}),title:"Content Filtering",description:"Choose which content types to include in the PDF"},{icon:i.jsx(m,{className:"h-6 w-6"}),title:"Secure Processing",description:"Your files are processed securely and never stored permanently"},{icon:i.jsx(c,{className:"h-6 w-6"}),title:"Organized Output",description:"Create well-structured PDFs from archive contents"}],it=[{icon:i.jsx(f,{className:"h-5 w-5"}),value:"200K+",label:"Archives Converted"},{icon:i.jsx(l,{className:"h-5 w-5"}),value:"< 10s",label:"Processing Time"},{icon:i.jsx(m,{className:"h-5 w-5"}),value:"100%",label:"Secure & Private"},{icon:i.jsx(x,{className:"h-5 w-5"}),value:"Free",label:"No Registration"}];return i.jsxs(i.Fragment,{children:[i.jsx(r,{title:"ZIP to PDF Converter | Convert ZIP Archives to PDF Online ",description:"Convert ZIP archives to organized PDF documents with content filtering. Extract and organize files from ZIP archives into professional PDF format. Free ZIP to PDF converter.",keywords:"ZIP to PDF, convert ZIP to PDF, archive to PDF, ZIP converter, archive converter, online ZIP tool, free converter, document conversion",canonical:"zip-to-pdf",ogImage:"/images/zip-to-pdf-og.jpg"}),i.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-100",children:i.jsx("section",{className:"pt-20 pb-16 px-4 sm:px-6 lg:px-8",children:i.jsxs("div",{className:"max-w-7xl mx-auto",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsxs("div",{className:"inline-flex items-center space-x-2 bg-gradient-to-r from-violet-600 to-blue-600 text-white px-4 py-2 rounded-full text-sm font-medium mb-6",children:[i.jsx(l,{className:"h-4 w-4"}),i.jsx("span",{children:"ZIP to PDF Converter"})]}),i.jsxs("h1",{className:"text-4xl sm:text-5xl lg:text-6xl font-bold text-gray-900 mb-6",children:["Convert ZIP to",i.jsx("span",{className:"bg-gradient-to-r from-violet-600 to-blue-600 bg-clip-text text-transparent",children:" PDF"})]}),i.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto mb-8 leading-relaxed",children:"Convert your ZIP archives to organized PDF documents with content filtering options. Perfect for creating documentation from archived files."}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 mb-12",children:it.map((t,e)=>i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[i.jsx("div",{className:"text-violet-600",children:t.icon}),i.jsx("div",{className:"text-2xl font-bold text-gray-900",children:t.value})]}),i.jsx("div",{className:"text-sm text-gray-600",children:t.label})]},e))})]}),S&&i.jsxs("div",{ref:z,tabIndex:-1,"aria-live":"assertive",className:"mb-6 rounded-lg px-4 py-3 flex items-center gap-3 "+("error"===S.type?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:["error"===S.type?i.jsx(h,{className:"h-5 w-5"}):i.jsx(c,{className:"h-5 w-5"}),i.jsx("span",{children:S.message}),i.jsx("button",{onClick:()=>v(null),className:"ml-auto text-gray-400 hover:text-gray-700 focus:outline-none","aria-label":"Close banner",children:i.jsx(u,{className:"h-5 w-5"})})]}),i.jsxs("div",{ref:j,onDrop:async t=>{t.preventDefault();const e=t.dataTransfer.items,s=[];if(e&&e.length>0)for(let i=0;i<e.length;i++){const t=e[i];if("file"===t.kind){const e=t.webkitGetAsEntry&&t.webkitGetAsEntry();if(e&&e.isDirectory){const t=new n;await Ai(e,t,"");const i=await t.generateAsync({type:"blob"}),r=new File([i],e.name+".zip",{type:"application/zip"});s.push(r)}else{const e=t.getAsFile();e&&s.push(e)}}}else{const e=Array.from(t.dataTransfer.files);s.push(...e)}tt(s)},onDragOver:t=>{t.preventDefault()},tabIndex:0,"aria-label":"ZIP upload area",className:"bg-white/90 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 p-8 mb-16 focus:ring-2 focus:ring-violet-500 outline-none",style:{cursor:"pointer"},children:[i.jsxs("div",{className:"mb-8",children:[i.jsxs("div",{className:"border-2 border-dashed rounded-2xl p-12 text-center transition-all duration-300 cursor-pointer",onClick:t=>{var e;t.stopPropagation(),null==(e=E.current)||e.click()},role:"button",tabIndex:0,"aria-label":"Upload ZIP files. Click or press Enter to open file dialog.",onKeyDown:t=>{var e;"Enter"!==t.key&&" "!==t.key||null==(e=E.current)||e.click()},children:[i.jsx(d,{className:"h-12 w-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),i.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Drop your ZIP archive(s) here for PDF conversion"}),i.jsx("p",{className:"text-gray-600 mb-6",children:"or click to browse files from your computer"}),i.jsx("input",{type:"file",accept:".zip,application/zip",multiple:!0,onChange:t=>{const e=Array.from(t.target.files||[]);tt(e),E.current&&(E.current.value="")},className:"hidden",ref:E,"aria-label":"Choose ZIP files to upload"}),i.jsx("label",{htmlFor:"file-upload",className:"bg-gradient-to-r from-violet-600 to-blue-600 text-white px-8 py-3 rounded-xl font-semibold hover:shadow-lg transition-all duration-200 cursor-pointer",tabIndex:0,"aria-label":"Choose ZIP File(s)",onKeyDown:t=>{var e;"Enter"!==t.key&&" "!==t.key||null==(e=E.current)||e.click()},children:"Choose ZIP File(s)"})]}),t.length>0&&i.jsx("div",{className:"mt-4 space-y-2",children:t.map((t,s)=>i.jsxs("div",{className:"flex items-center bg-green-50 rounded-lg p-2 text-green-800 text-sm justify-between",children:[i.jsx("span",{children:t.name}),i.jsx("button",{onClick:t=>{var i;t.stopPropagation(),i=s,e(t=>t.filter((t,e)=>e!==i)),L(t=>t.filter((t,e)=>e!==i))},"aria-label":`Remove ${t.name}`,className:"ml-2 text-red-400 hover:text-red-700",children:i.jsx(u,{className:"h-4 w-4"})})]},s))})]}),Y.length>0&&i.jsxs("div",{className:"mb-8","aria-label":"Preview and reorder files before conversion",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Preview & Reorder Files"}),i.jsx("ul",{className:"bg-white rounded-xl shadow p-4 divide-y divide-gray-200",role:"listbox","aria-label":"File order list",children:Y.map((t,e)=>i.jsxs("li",{className:"flex items-center justify-between py-2",role:"option","aria-selected":t.included,tabIndex:0,children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-gray-500 text-xs",children:t.path.length>0?t.path.join(" / ")+" / ":""}),i.jsx("span",{className:"text-gray-800 font-mono",children:t.name})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>Q(t=>e>0?[...t.slice(0,e-1),t[e],t[e-1],...t.slice(e+1)]:t),disabled:0===e,className:"px-2 py-1 rounded bg-gray-100 text-gray-500 hover:bg-gray-200 disabled:opacity-50",title:"Move Up","aria-label":`Move ${t.name} up in order`,children:"↑"}),i.jsx("button",{onClick:()=>Q(t=>e<t.length-1?[...t.slice(0,e),t[e+1],t[e],...t.slice(e+2)]:t),disabled:e===Y.length-1,className:"px-2 py-1 rounded bg-gray-100 text-gray-500 hover:bg-gray-200 disabled:opacity-50",title:"Move Down","aria-label":`Move ${t.name} down in order`,children:"↓"}),i.jsxs("label",{className:"flex items-center gap-1 text-xs","aria-label":`Include ${t.name} in conversion`,children:[i.jsx("input",{type:"checkbox",checked:t.included,onChange:t=>Q(s=>s.map((s,i)=>i===e?{...s,included:t.target.checked}:s)),tabIndex:0}),"Include"]})]})]},e))})]}),i.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 mb-8",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[i.jsx(p,{className:"h-5 w-5 text-gray-600"}),i.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Content Settings"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"checkbox",id:"include-images",checked:T,onChange:t=>D(t.target.checked),className:"rounded border-gray-300 text-violet-600 focus:ring-violet-500"}),i.jsx("label",{htmlFor:"include-images",className:"ml-2 text-sm text-gray-700",children:"Include images in the PDF(s)"})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"checkbox",id:"include-text",checked:R,onChange:t=>N(t.target.checked),className:"rounded border-gray-300 text-violet-600 focus:ring-violet-500"}),i.jsx("label",{htmlFor:"include-text",className:"ml-2 text-sm text-gray-700",children:"Include text files in the PDF(s)"})]}),i.jsxs("div",{className:"flex flex-wrap gap-4 mt-4",children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"page-size",className:"block text-sm text-gray-700 font-medium mb-1",children:"Page Size"}),i.jsxs("select",{id:"page-size",value:$,onChange:t=>U(t.target.value),className:"rounded border-gray-300 text-gray-700 focus:ring-violet-500 px-2 py-1",children:[i.jsx("option",{value:"A4",children:"A4"}),i.jsx("option",{value:"Letter",children:"Letter"}),i.jsx("option",{value:"Legal",children:"Legal"}),i.jsx("option",{value:"Tabloid",children:"Tabloid"}),i.jsx("option",{value:"Executive",children:"Executive"}),i.jsx("option",{value:"Custom",children:"Custom"})]}),"Custom"===$&&i.jsxs("div",{className:"flex gap-2 mt-2",children:[i.jsx("input",{type:"number",min:100,max:2e3,value:G,onChange:t=>W(Number(t.target.value)),className:"w-24 rounded border-gray-300 text-gray-700 focus:ring-violet-500 px-2 py-1",placeholder:"Width (pt)"}),i.jsx("input",{type:"number",min:100,max:2e3,value:X,onChange:t=>q(Number(t.target.value)),className:"w-24 rounded border-gray-300 text-gray-700 focus:ring-violet-500 px-2 py-1",placeholder:"Height (pt)"})]})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"orientation",className:"block text-sm text-gray-700 font-medium mb-1",children:"Orientation"}),i.jsxs("select",{id:"orientation",value:H,onChange:t=>Z(t.target.value),className:"rounded border-gray-300 text-gray-700 focus:ring-violet-500 px-2 py-1",children:[i.jsx("option",{value:"portrait",children:"Portrait"}),i.jsx("option",{value:"landscape",children:"Landscape"})]})]})]})]})]}),s.length>0?i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mt-8","aria-label":"Conversion actions",children:[i.jsxs("button",{onClick:et,disabled:w||0===t.length,className:"flex-1 bg-gradient-to-r from-violet-600 to-blue-600 text-white px-8 py-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-200 flex items-center justify-center space-x-2 text-lg","aria-label":"Convert ZIP to PDF",children:[i.jsx(l,{className:"h-5 w-5","aria-hidden":"true"}),i.jsx("span",{children:"Convert ZIP to PDF"})]}),i.jsxs("button",{onClick:()=>{0!==s.length&&(s.forEach((e,s)=>{var i;const r=URL.createObjectURL(e),n=document.createElement("a");n.href=r,n.download=(null==(i=t[s])?void 0:i.name.replace(/\.zip$/i,""))+".pdf"||"converted.pdf",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}),v({message:"Download started.",type:"success"}))},className:"bg-green-600 text-white px-8 py-4 rounded-xl font-semibold hover:bg-green-700 transition-all duration-200 flex items-center justify-center space-x-2 text-lg","aria-label":"Download Converted PDFs",children:[i.jsx(g,{className:"h-5 w-5","aria-hidden":"true"}),i.jsx("span",{children:"Download Converted PDFs"})]})]}):i.jsx("div",{className:"flex flex-col sm:flex-row gap-4 mt-8","aria-label":"Conversion actions",children:i.jsxs("button",{onClick:et,disabled:w||0===t.length,className:"flex-1 bg-gradient-to-r from-violet-600 to-blue-600 text-white px-8 py-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-200 flex items-center justify-center space-x-2 text-lg","aria-label":"Convert ZIP to PDF",children:[i.jsx(l,{className:"h-5 w-5","aria-hidden":"true"}),i.jsx("span",{children:"Convert ZIP to PDF"})]})}),w&&i.jsxs("div",{className:"w-full mt-4",children:[i.jsx("div",{className:"h-3 bg-gray-200 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-3 bg-gradient-to-r from-violet-600 to-blue-600 transition-all duration-300",style:{width:`${F}%`}})}),i.jsxs("div",{className:"text-sm text-gray-600 mt-1 text-center",children:[F,"%"]})]}),i.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-8",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"PDF Preview"}),i.jsx("div",{className:"border rounded-lg overflow-hidden min-h-[16rem] flex items-center justify-center bg-gray-50 relative",children:A?null:_?i.jsx("img",{src:_,alt:"PDF preview",className:"w-full h-64 object-contain"}):i.jsx("span",{className:"text-gray-400",children:"No PDF generated yet"})})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ZIP Contents"}),i.jsx("div",{className:"border rounded-lg overflow-hidden min-h-[16rem] flex flex-col bg-gray-50 p-4 max-h-64 overflow-y-auto",children:M.length>0&&t.length>0?M[0].map((t,e)=>i.jsx("span",{className:"text-gray-700 text-sm",children:t.name},e)):i.jsx("span",{className:"text-gray-400",children:"No ZIP selected"})})]})]}),K&&i.jsxs("div",{className:"mt-8 bg-white rounded-xl shadow p-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Conversion Report"}),i.jsxs("div",{className:"mb-2 text-sm text-gray-700",children:["Processed: ",K.processed," | Skipped: ",K.skipped," | Errors: ",K.errors.length]}),i.jsx("ul",{className:"mb-2 text-xs text-gray-700",children:K.log.map((t,e)=>i.jsxs("li",{children:[i.jsx("span",{className:"font-mono",children:t.name}),": ",t.status]},e))}),K.errors.length>0&&i.jsxs("div",{className:"mt-2 text-xs text-red-600",children:[i.jsx("div",{className:"font-semibold",children:"Errors:"}),i.jsx("ul",{children:K.errors.map((t,e)=>i.jsxs("li",{children:[i.jsx("span",{className:"font-mono",children:t.name}),": ",t.error]},e))})]})]})]}),i.jsxs("div",{className:"mb-16",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Why Choose Our ZIP to PDF Converter?"}),i.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Professional ZIP to PDF conversion with content filtering and organized output"})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:st.map((t,e)=>i.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20 text-center",children:[i.jsx("div",{className:"inline-flex p-3 bg-gradient-to-br from-violet-500 to-blue-500 rounded-xl text-white mb-4",children:t.icon}),i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t.title}),i.jsx("p",{className:"text-gray-600 text-sm",children:t.description})]},e))})]}),i.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-3xl shadow-xl p-8 mb-16",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"How to Convert ZIP to PDF"}),i.jsx("p",{className:"text-lg text-gray-600",children:"Follow these simple steps to convert your ZIP archives to PDF"})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[{step:"1",title:"Upload ZIP(s)",description:"Select one or more ZIP archive files from your device"},{step:"2",title:"Choose Content",description:"Select which content types to include in the PDF(s)"},{step:"3",title:"Convert & Download",description:"Convert to PDF(s) and download the result"}].map((t,e)=>i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-violet-500 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx("span",{className:"text-white font-bold text-xl",children:t.step})}),i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t.title}),i.jsx("p",{className:"text-gray-600",children:t.description})]},e))})]}),i.jsx("div",{className:"text-center",children:i.jsxs("div",{className:"bg-gradient-to-r from-violet-600 via-purple-600 to-blue-600 rounded-3xl p-8 sm:p-12 text-white relative overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-black/10 rounded-3xl"}),i.jsxs("div",{className:"relative z-10",children:[i.jsx("h3",{className:"text-2xl sm:text-3xl font-bold mb-4",children:"Ready to Convert ZIP to PDF?"}),i.jsx("p",{className:"text-violet-100 mb-8 text-lg max-w-2xl mx-auto",children:"Transform your ZIP archives into organized PDF documents. Join thousands of users who trust our converter for archive to PDF conversion."}),i.jsxs("button",{onClick:()=>{var t;return null==(t=document.getElementById("file-upload"))?void 0:t.click()},className:"bg-white text-violet-600 px-8 py-4 rounded-xl font-bold hover:bg-gray-100 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 mx-auto",children:[i.jsx(l,{className:"h-5 w-5"}),i.jsx("span",{children:"Start Converting Now"})]})]}),i.jsx("div",{className:"absolute top-0 left-0 w-32 h-32 bg-white/10 rounded-full blur-3xl"}),i.jsx("div",{className:"absolute bottom-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-3xl"})]})})]})})})]})};function Ci(t,e,s,i){let r;switch(t){case"A4":default:r=[595.28,841.89];break;case"Letter":r=[612,792];break;case"Legal":r=[612,1008];break;case"Tabloid":r=[792,1224];break;case"Executive":r=[522,756];break;case"Custom":r=[s||595.28,i||841.89]}return"landscape"===e&&(r=[r[1],r[0]]),r}async function Ai(t,e,s){return new Promise((i,r)=>{t.createReader().readEntries(async t=>{for(const i of t)i.isDirectory?await Ai(i,e,s+i.name+"/"):i.isFile&&await new Promise((t,r)=>{i.file(i=>{const n=new FileReader;n.onload=()=>{e.file(s+i.name,n.result),t()},n.onerror=r,n.readAsArrayBuffer(i)},r)});i()},r)})}export{_i as default};
